---
title: "Ejercicio Salvavidas/Evaluación final"
author: "AGREGA TU NOMBRE"
output:
  html_document:
    toc: yes
    df_print: paged
  html_notebook:
    toc: yes
---

## Descripción y carga de los datos:

En este ejercicio final (salvavidas) el objetivo será responder a una serie de preguntas utilizando la base de datos `heart.csv`, la cual consiste en 14 columnas:

- edad: edad del individuo
- sexo: 1: hombre, 0: mujer
- tipo_dolor: 1: angina típica; 2: angina atípica, 3: dolor sin angina, 4: sin síntoma
- p_sang_reposo: Presión sanguínea en reposo (mmHg)
- col_suero: Concentración de colesterol en el suero sanguíneo (mg/dl)
- gluc_ayuno: 0 si es menor a 120 mg/dl, 1 si es mayor
- ecg_reposo: 0: normal; 1: anormalidad en la onda ST-T, 2: hipertrofia ventricular izquierda
- frec_card_max: máxima frecuencia cardiaca alcanzada por el individuo. Valor numérico
- angina_induc: ¿El ejercicio indujo angina? 0: no, 1: sí
- depresion_ST: 0: Bajada del segmento T (ST) en ejercicio vs. reposo. Valor numérico
- max_ST_ejercicio: 1: amplitud positiva, 2: plana, 3: amplitud negativa
- vasos_color: número de vasos sanguíneos mayores coloreados por fluoroscopía (1-3)
- thal: Talasemia. 3: normal, 6: defecto corregido, 7 defecto reversible.
- enfermedad: Describe la ausencia (0) o presencia de enfermedades cardiacas (1,2,3,4)

```{r}
col_names = c('edad', 'sexo', 'tipo_dolor', 'p_sang_reposo', 'col_suero', 'gluc_ayuno', 'ecg_reposo', 'frec_card_max', 'angina_induc', 'depresion_ST', 'max_ST_ejercicio', 'vasos_color', 'thal', 'enfermedad')
heart <- read.csv("heart.csv", col.names = col_names)
head(heart)
```


A lo largo de las siguientes secciones encontrarás una serie de preguntas relacionadas con las temáticas vistas a lo largo del curso. De manera general, todas las respuestas deberán contenidas en céldas de código (salvo los casos en los que se solicite una interpretación de los resultados). Además de las celdas incluidas en esta libreta, puedes agregar las que consideres necesarias (una para el procesamiento de los datos y otra para el graficado, por ejemplo.)

## Criterios de evaluación
1. Se deberán de **entregar** ambas versiones de la libreta; es decir, tanto el **archivo .Rmd** (deberá ejecutarse sin errores) como el **archivo .html** (correctamente renderizado). Entregar cada uno representa el 25% de la calificación final (ambos suman el 50%)
2. Las salidas finales del código de cada respuesta deberán a) mostrarse en cada celda (ver ejemplo), b) tener el tipo de objeto indicado y c) contar con las características solicitadas. La falta de cada uno de estos tres criterios implica una penalización del 1/3 respecto a la ponderación de cada pregunta, asumiendo que el resultado sea correcto; es decir, si la conclusión de la pregunta es la correcta, se almacenó en el tipo de objeto solititado (*e.g.* un data.frame), pero no se muestra la salida en la libreta, esa respuesta valdrá 2/3 de su puntuación correspondiente.
3. En los casos en los que apliques una prueba de hipótesis de nulidad se espera que se incluya a) el juego de hipótesis ($H_0$ y $H_A$) y b) la verificación de sus supuestos.
4. Siguiendo con el punto anterior, los resultados de la prueba deberán de **reportarse** en la descripción de manera adecuada (estadístico de prueba(grados de libertad) = X, p = xxx; *e.g.* ANOVA de una vía: $F_{(2,18)} = 13.082$, p = 0.003), con máximo 3 decimales.
5. En los casos en los que apliques una Regresión Lineal (Simple o Múltiple) o un Análisis Discriminante, deberás de verificar si el modelo está o no sobre o infra ajustado, de lo contrario el reactivo será dado por incorrecto.
6. **La nota aprobatoria será 80/100**, lo cual representa el criterio para la obtención de la **constancia**.
7. **Puedes solicitar asesorías** para la resolución de dudas u orientación sobre alguna de las preguntas; SIN EMBARGO, las preguntas deberán de estar bien estructuradas (*i.e.*, no solicitar la clase completa nuevamente). Al igual que en las tareas anteriores, esperamos que tengas la iniciativa de recabar información adicional a la vista en el curso para lograr resolver las distintas preguntas de la manera que mejor consideres posible.
8. Debido a que se establecerá una fecha límite de entrega entre todos, **NO habrá posibilidad de entrega a destiempo** (a menos de que exista un justificante).
9. El modo de entrega será Google Classroom, en el cual se incluirá una copia de estos comentarios. Además, se incluirá una rúbrica en la que se indicará, al igual que aquí, la ponderación de cada pregunta.

#### Diagrama de flujo con respecto a la evaluación de los reactivos:

## Ejemplo:

0. ¿Cuál es el tipo de las variables sexo, angina_inducida, vasos_color, frec_card_max, enfermedad? La respuesta debe de ser un **vector nombrado** cuyos valores son los tipos de la variable. De estas, menciona AL MENOS dos variables que tengan tipo numeric o integer y que en realidad sean variables categóricas (justifica tu respuesta).
```{r}
# INCORRECTO:
#str(heart)

# CORRECTO:
tipos <- c(sexo = typeof(heart$sexo), angina_inducida = typeof(heart$angina_inducida), vasos_color = typeof(heart$vasos_color), frec_card_max = typeof(heart$frec_card_max), enfermedad = typeof(heart$enfermedad))
print(tipos)
```

- Las variables que deberían ser categóricas son a) sexo, ya que son hombres o mujeres; b) angina_inducida, ya que es verdadero (1) o falso (2); c) enfermedad, ya que indica la presencia (1, 2, 3, 4) o ausencia (0) de enfermedades cardicas.

## Sección 1: Fundamentos

1. ¿Cuántas observaciones (instancias) hay en la base de datos? La salida deberá de ser un solo número.
```{r}
# Tu código va aquí

```

2. Estima las medias e intervalos de confianza de las variables para las que tenga sentido hacerlo. Preséntalas en un **DataFrame** cuyas columnas sean: variable, media, IC_i, IC_s
```{r}
# Tu código va aquí

```

3. Realiza un gráfico de **densidad** (KDE) de la variable `presion_sangre_reposo`. Sigue las heurísticas vistas en el tema de representaciones de la realidad. ¿Observas alguna tendencia/patrón?
```{r}
# Tu código va aquí

```

4. Realiza un gráfico de *distribución de frecuencias* de la variable thal. Sigue las heurísticas vistas en el tema de representaciones de la realidad. ¿Observas alguna tendencia/patrón?¿La cantidad de individuos en cada nivel es similar? 
```{r}
# Tu código va aquí

```

5. ¿Cuál es la diferencia entre los gráficos de distribución de frecuencias y los histogramas? ¿Cuál es la diferencia entre los gráficos de distribución de frecuencias y los gráficos de densidad? 

6. ¿Cuál es la ventaja de utilizar un gráfico KDE con respecto a uno de distribución de frecuencias al tratarse de una variable continua?

## Sección 2: Herramientas básicas para el análisis de datos

1. Aplica una prueba t de Student para comparar el colesterol en suero (`colesterol_suero`) entre hombres (sexo = 1) y mujeres (sexo = 0). Integra los resultados en un *vector nombrado* cuyos valores sean `valor de t`, `grados de libertad`, `p`. ¿Qué concluyes? ¿Hay algún sesgo en la inferencia? ¿Qué representa el IC que nos muestra la salida del análisis?
```{r}
# Tu código va aquí

```

2. Aplica un ANOVA de una vía para comparar `frec_card_max` entre los niveles de `tipo_dolor`. ¿Qué concluyes? ¿Dadas las descripciones de los datos, es coherente realizar esta comparación? ¿Es adecuada la prueba según la naturaleza de los datos? ¿Es necesario aplicar alguna corrección al valor de p?
```{r}
# Tu código va aquí

```

3. Selecciona tres variables de la base de datos heart y desarrolla un ANOVA FACTORIAL. Indica la interacción entre variables (Pista; use "*"). Justifique su análisis y explique por qué decidió utilizar las variables elegidas.  

```{r}
# Tu código va aquí

```

## Sección 3: Modelación lineal y GLMs
1. Muestra gráficamente las correlaciones de *PEARSON* entre las variables **no categóricas**. ¿Qué observas? ¿Hay algún par de variables para los cuales sería mejor realizar una correlación de *SPEARMAN*?
```{r}
# Tu código va aquí

```

2. Considerando los resultados del punto anterior, realiza una regresión lineal simple entre las *dos variables MÁS correlacionadas*. ¿Cuáles son los coeficientes de la regresión? ¿Qué concluyes a partir de la pendiente? ¿El modelo describe de manera aceptable la relación entre estas variables? Realiza *al menos* un gráfico diagnóstico de la regresión. 
```{r}
# Tu código va aquí

```
3. Considerando los resultados del punto 1 de esta sección, realiza un gráfico de dispersión entre las *dos variables MENOS correlacionadas*. De existir una relación, ¿de qué tipo es (monótona o no monótona)? Incluye en el gráfico el valor de la covarianza. ¿Qué concluyes a partir de él? ¿En qué difiere respecto a la correlación?

```{r}
# Tu código va aquí

```

4. De la base de datos heart, elija dos variables; dos X de tipo discreta (Ejm; 63, 37, 41) y una Y de tipo binaria  (Ejm; 1,1,0). Con esas variables genere un GLM de tipo Binomial. Argumente sus resultados. 

```{r}
# Tu código va aquí

```

## Sección 4: Estadística no paramétrica y modelación no lineal
1. Realiza la misma comparación que en la pregunta 1 de la sección 2 mediante una prueba U de Mann-Whitney. ¿Cambian los resultados? ¿Con cuál de las dos aproximaciones te quedas? ¿Por qué?
```{r}
 # Tu código va aquí

```

2. Realiza la misma comparación que en la pregunta 2 de la sección 2 utilizando una aproximación no paramétrica. ¿Cuál de los dos ANOVAs no paramétricos aplicas y por qué? ¿Cambia la conclusión a la que llegas después de aplicar la prueba? ¿Cuál de las dos consideras como la mejor de las dos aproximaciones (paramétrica o no paramétrica)?
```{r}
# Tu código va aquí

```

3. Explica el porqué no es posible ajustar un modelo no lineal convencional con cualquier par de variables contenidas en la base de datos heart.

```{r}
# Tu código va aquí

```

## Sección 5: Análisis Multivariado
1. Genera un nuevo `data.frame` con cada variable *NO CATEGÓRICA* centrada y escalada. Grafica las distribuciones utilizando un gráfico de densidad (KDE) para cada una. ¿Qué representan los valores del eje x? Si realizaras el mismo gráfico sin las variables sin transformar, ¿esperarías ver alguna diferencia en la forma de la distribución?
```{r}
# Código

```

2. Realiza una comparación multivariada en la que incluyas todas las variables **NO CATEGÓRICAS**, considerando a los grupos como los niveles de la variable enfermedad. ¿existen diferencias en las mediciones multivariadas de estos grupos? ¿Cuáles son las dos variables en las que existen mayores diferencias/explican mejor la repartición del espacio multivariado?
```{r}
# Código

```

3. Acompaña el análisis del punto anterior con a) un gráfico de coordenadas paralelas *O* b) un gráfico de NMDS. ¿Concuerda la visualización con los resultados de la prueba del punto anterior?
```{r}
# Código

```

4. Realiza una regresión lineal múltiple SIN regularizar en la que la variable de respuesta sea el p_sang_reposo y los predictores sean las variables **NO CATEGÓRICAS** restantes. ¿Cuántas y cuáles variables incluyes en el análisis? ¿Aplicarías un modelo regularizado (Lasso o Ridge)? ¿Cuáles serían las diferencias entre los efectos de ambas regularizaciones? ¿
```{r}
# Código

```

5. Partiendo de la regresión del punto anterior, guarda en un *data frame* los coeficientes de la regresión (columna coef) y los niveles de significancia de sus pruebas t (columna p). ¿Qué representan estos valores de p? Tomando ese criterio, ¿qué variables fueron las mejores predictoras? ¿existe alguna relación con el gráfico de correlaciones de la sección 3?
```{r}
# Código

```

6. Reporta los resultados del ANOVA de la regresión. ¿Qué representa esta prueba de hipótesis? Tomando eso en cuenta, ¿Cómo interpretas estos resultados?


7. Realiza un Análisis de Funciones Discriminantes considerando todas las variables **NO CATEGÓRICAS** en el que predigas las categorías de la variable enfermedad. A partir de la matriz de confusión, ¿el modelo funciona adecuadamente?

```{r}
# Código

```

8. Codifica la variable enfermedad de modo que solamente tengas dos categorías: 0 (ausencia) y 1 (presencia) y realiza un análisis de Funciones Discriminantes (solo variables no categóricas). ¿Hay mejorías en el desempeño del modelo? ¿Por qué? (toma en consideración los resultados de la comparación multivariada)

## Sección 6: BONUS: Clasificación utilizando una regresión logística
Resuelve este ejercicio por 3 (TRES) puntos extra en el examen. De estos 3 puntos, cada pregunta conceptual tiene un valor del 10% y cada pregunta con código tiene un valor del 20%.

1. Explica, en tus propias palabras, en qué consiste la regresión logística. Agrega dos fuentes bibliográficas.

2. ¿Qué similitudes/diferencias tiene frente al análisis de funciones discriminantes? ¿Tiene algún supuesto sobre la distribución/naturaleza de los datos? (De no haber citado fuentes en la pregunta anterior incluye dos)

3. ¿Podemos utilizar algún tipo de regularización (L1 o L2)? (De no haber citado fuentes en las preguntas anteriores incluye dos)

4. ¿Hay parámetros a modificar si queremos optimizar el modelo? ¿Cuáles? (De no haber citado fuentes en las preguntas anteriores incluye dos)

5. Realiza una regresión logística binaria para predecir la presencia (1) o ausencia (0) de enfermedades cardiacas. ¿Cuál es la precisión alcanzada por el modelo? (OJO con el sobreajuste).
```{r}
# Código
```


6. Realiza la regresión logística multinomial para predecir todos los niveles de la variable enfermedad (sin codificar). ¿Qué precisión alcanza el modelo? (OJO con el sobreajuste).s

```{r}
# Código
```

7. Presenta los resultados de la clasificación binaria de manera gráfica. ¿Qué tan pronunciada es la separación entre las clases?
```{r}
# Código
```

