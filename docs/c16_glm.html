<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
  <title>Bioestadística con R: Modelos Lineales Generalizados</title>



  <meta name="article:author" content="M. en C. Arturo Bell Enríquez García"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Bioestadística con R: Modelos Lineales Generalizados"/>
  <meta property="og:type" content="article"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:site_name" content="Bioestadística con R"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Bioestadística con R: Modelos Lineales Generalizados"/>

  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","author","output"]}},"value":[{"type":"character","attributes":{},"value":["Modelos Lineales Generalizados"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["M. en C. Arturo Bell Enríquez García"]}]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["toc","toc_float","code_download"]}},"value":[{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[true]}]}]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  <!--radix_placeholder_navigation_in_header-->
  <meta name="distill:offset" content=""/>

  <script type="application/javascript">

    window.headroom_prevent_pin = false;

    window.document.addEventListener("DOMContentLoaded", function (event) {

      // initialize headroom for banner
      var header = $('header').get(0);
      var headerHeight = header.offsetHeight;
      var headroom = new Headroom(header, {
        tolerance: 5,
        onPin : function() {
          if (window.headroom_prevent_pin) {
            window.headroom_prevent_pin = false;
            headroom.unpin();
          }
        }
      });
      headroom.init();
      if(window.location.hash)
        headroom.unpin();
      $(header).addClass('headroom--transition');

      // offset scroll location for banner on hash change
      // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
      window.addEventListener("hashchange", function(event) {
        window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
      });

      // responsive menu
      $('.distill-site-header').each(function(i, val) {
        var topnav = $(this);
        var toggle = topnav.find('.nav-toggle');
        toggle.on('click', function() {
          topnav.toggleClass('responsive');
        });
      });

      // nav dropdowns
      $('.nav-dropbtn').click(function(e) {
        $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
        $(this).parent().siblings('.nav-dropdown')
           .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $("body").click(function(e){
        $('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $(".nav-dropdown").click(function(e){
        e.stopPropagation();
      });
    });
  </script>

  <style type="text/css">

  /* Theme (user-documented overrideables for nav appearance) */

  .distill-site-nav {
    color: rgba(255, 255, 255, 0.8);
    background-color: #0F2E3D;
    font-size: 15px;
    font-weight: 300;
  }

  .distill-site-nav a {
    color: inherit;
    text-decoration: none;
  }

  .distill-site-nav a:hover {
    color: white;
  }

  @media print {
    .distill-site-nav {
      display: none;
    }
  }

  .distill-site-header {

  }

  .distill-site-footer {

  }


  /* Site Header */

  .distill-site-header {
    width: 100%;
    box-sizing: border-box;
    z-index: 3;
  }

  .distill-site-header .nav-left {
    display: inline-block;
    margin-left: 8px;
  }

  @media screen and (max-width: 768px) {
    .distill-site-header .nav-left {
      margin-left: 0;
    }
  }


  .distill-site-header .nav-right {
    float: right;
    margin-right: 8px;
  }

  .distill-site-header a,
  .distill-site-header .title {
    display: inline-block;
    text-align: center;
    padding: 14px 10px 14px 10px;
  }

  .distill-site-header .title {
    font-size: 18px;
    min-width: 150px;
  }

  .distill-site-header .logo {
    padding: 0;
  }

  .distill-site-header .logo img {
    display: none;
    max-height: 20px;
    width: auto;
    margin-bottom: -4px;
  }

  .distill-site-header .nav-image img {
    max-height: 18px;
    width: auto;
    display: inline-block;
    margin-bottom: -3px;
  }



  @media screen and (min-width: 1000px) {
    .distill-site-header .logo img {
      display: inline-block;
    }
    .distill-site-header .nav-left {
      margin-left: 20px;
    }
    .distill-site-header .nav-right {
      margin-right: 20px;
    }
    .distill-site-header .title {
      padding-left: 12px;
    }
  }


  .distill-site-header .nav-toggle {
    display: none;
  }

  .nav-dropdown {
    display: inline-block;
    position: relative;
  }

  .nav-dropdown .nav-dropbtn {
    border: none;
    outline: none;
    color: rgba(255, 255, 255, 0.8);
    padding: 16px 10px;
    background-color: transparent;
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    margin: 0;
    margin-top: 1px;
    z-index: 2;
  }

  .nav-dropdown-content {
    display: none;
    position: absolute;
    background-color: white;
    min-width: 200px;
    border: 1px solid rgba(0,0,0,0.15);
    border-radius: 4px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
    z-index: 1;
    margin-top: 2px;
    white-space: nowrap;
    padding-top: 4px;
    padding-bottom: 4px;
  }

  .nav-dropdown-content hr {
    margin-top: 4px;
    margin-bottom: 4px;
    border: none;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .nav-dropdown-active {
    display: block;
  }

  .nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
    color: black;
    padding: 6px 24px;
    text-decoration: none;
    display: block;
    text-align: left;
  }

  .nav-dropdown-content .nav-dropdown-header {
    display: block;
    padding: 5px 24px;
    padding-bottom: 0;
    text-transform: uppercase;
    font-size: 14px;
    color: #999999;
    white-space: nowrap;
  }

  .nav-dropdown:hover .nav-dropbtn {
    color: white;
  }

  .nav-dropdown-content a:hover {
    background-color: #ddd;
    color: black;
  }

  .nav-right .nav-dropdown-content {
    margin-left: -45%;
    right: 0;
  }

  @media screen and (max-width: 768px) {
    .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
    .distill-site-header a.nav-toggle {
      float: right;
      display: block;
    }
    .distill-site-header .title {
      margin-left: 0;
    }
    .distill-site-header .nav-right {
      margin-right: 0;
    }
    .distill-site-header {
      overflow: hidden;
    }
    .nav-right .nav-dropdown-content {
      margin-left: 0;
    }
  }


  @media screen and (max-width: 768px) {
    .distill-site-header.responsive {position: relative; min-height: 500px; }
    .distill-site-header.responsive a.nav-toggle {
      position: absolute;
      right: 0;
      top: 0;
    }
    .distill-site-header.responsive a,
    .distill-site-header.responsive .nav-dropdown {
      display: block;
      text-align: left;
    }
    .distill-site-header.responsive .nav-left,
    .distill-site-header.responsive .nav-right {
      width: 100%;
    }
    .distill-site-header.responsive .nav-dropdown {float: none;}
    .distill-site-header.responsive .nav-dropdown-content {position: relative;}
    .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
      display: block;
      width: 100%;
      text-align: left;
    }
  }

  /* Site Footer */

  .distill-site-footer {
    width: 100%;
    overflow: hidden;
    box-sizing: border-box;
    z-index: 3;
    margin-top: 30px;
    padding-top: 30px;
    padding-bottom: 30px;
    text-align: center;
  }

  /* Headroom */

  d-title {
    padding-top: 6rem;
  }

  @media print {
    d-title {
      padding-top: 4rem;
    }
  }

  .headroom {
    z-index: 1000;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
  }

  .headroom--transition {
    transition: all .4s ease-in-out;
  }

  .headroom--unpinned {
    top: -100px;
  }

  .headroom--pinned {
    top: 0;
  }

  /* adjust viewport for navbar height */
  /* helps vertically center bootstrap (non-distill) content */
  .min-vh-100 {
    min-height: calc(100vh - 100px) !important;
  }

  </style>

  <script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
  <link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
  <script src="site_libs/headroom-0.9.4/headroom.min.js"></script>
  <script src="site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
  <script src="site_libs/fuse-6.4.1/fuse.min.js"></script>

  <script type="application/javascript">

  function getMeta(metaName) {
    var metas = document.getElementsByTagName('meta');
    for (let i = 0; i < metas.length; i++) {
      if (metas[i].getAttribute('name') === metaName) {
        return metas[i].getAttribute('content');
      }
    }
    return '';
  }

  function offsetURL(url) {
    var offset = getMeta('distill:offset');
    return offset ? offset + '/' + url : url;
  }

  function createFuseIndex() {

    // create fuse index
    var options = {
      keys: [
        { name: 'title', weight: 20 },
        { name: 'categories', weight: 15 },
        { name: 'description', weight: 10 },
        { name: 'contents', weight: 5 },
      ],
      ignoreLocation: true,
      threshold: 0
    };
    var fuse = new window.Fuse([], options);

    // fetch the main search.json
    return fetch(offsetURL('search.json'))
      .then(function(response) {
        if (response.status == 200) {
          return response.json().then(function(json) {
            // index main articles
            json.articles.forEach(function(article) {
              fuse.add(article);
            });
            // download collections and index their articles
            return Promise.all(json.collections.map(function(collection) {
              return fetch(offsetURL(collection)).then(function(response) {
                if (response.status === 200) {
                  return response.json().then(function(articles) {
                    articles.forEach(function(article) {
                      fuse.add(article);
                    });
                  })
                } else {
                  return Promise.reject(
                    new Error('Unexpected status from search index request: ' +
                              response.status)
                  );
                }
              });
            })).then(function() {
              return fuse;
            });
          });

        } else {
          return Promise.reject(
            new Error('Unexpected status from search index request: ' +
                        response.status)
          );
        }
      });
  }

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // get search element (bail if we don't have one)
    var searchEl = window.document.getElementById('distill-search');
    if (!searchEl)
      return;

    createFuseIndex()
      .then(function(fuse) {

        // make search box visible
        searchEl.classList.remove('hidden');

        // initialize autocomplete
        var options = {
          autoselect: true,
          hint: false,
          minLength: 2,
        };
        window.autocomplete(searchEl, options, [{
          source: function(query, callback) {
            const searchOptions = {
              isCaseSensitive: false,
              shouldSort: true,
              minMatchCharLength: 2,
              limit: 10,
            };
            var results = fuse.search(query, searchOptions);
            callback(results
              .map(function(result) { return result.item; })
            );
          },
          templates: {
            suggestion: function(suggestion) {
              var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
                ? `<img src="${offsetURL(suggestion.preview)}"</img>`
                : '';
              var html = `
                <div class="search-item">
                  <h3>${suggestion.title}</h3>
                  <div class="search-item-description">
                    ${suggestion.description || ''}
                  </div>
                  <div class="search-item-preview">
                    ${img}
                  </div>
                </div>
              `;
              return html;
            }
          }
        }]).on('autocomplete:selected', function(event, suggestion) {
          window.location.href = offsetURL(suggestion.path);
        });
        // remove inline display style on autocompleter (we want to
        // manage responsive display via css)
        $('.algolia-autocomplete').css("display", "");
      })
      .catch(function(error) {
        console.log(error);
      });

  });

  </script>

  <style type="text/css">

  .nav-search {
    font-size: x-small;
  }

  /* Algolioa Autocomplete */

  .algolia-autocomplete {
    display: inline-block;
    margin-left: 10px;
    vertical-align: sub;
    background-color: white;
    color: black;
    padding: 6px;
    padding-top: 8px;
    padding-bottom: 0;
    border-radius: 6px;
    border: 1px #0F2E3D solid;
    width: 180px;
  }


  @media screen and (max-width: 768px) {
    .distill-site-nav .algolia-autocomplete {
      display: none;
      visibility: hidden;
    }
    .distill-site-nav.responsive .algolia-autocomplete {
      display: inline-block;
      visibility: visible;
    }
    .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
      margin-left: 0;
      width: 400px;
      max-height: 400px;
    }
  }

  .algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
    width: 90%;
    outline: none;
    border: none;
  }

  .algolia-autocomplete .aa-hint {
    color: #999;
  }
  .algolia-autocomplete .aa-dropdown-menu {
    width: 550px;
    max-height: 70vh;
    overflow-x: visible;
    overflow-y: scroll;
    padding: 5px;
    margin-top: 3px;
    margin-left: -150px;
    background-color: #fff;
    border-radius: 5px;
    border: 1px solid #999;
    border-top: none;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
    cursor: pointer;
    padding: 5px 4px;
    border-bottom: 1px solid #eee;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
    border-bottom: none;
    margin-bottom: 2px;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
    overflow: hidden;
    font-size: 0.8em;
    line-height: 1.4em;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
    font-size: 1rem;
    margin-block-start: 0;
    margin-block-end: 5px;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
    display: inline-block;
    overflow: hidden;
    height: 2.8em;
    width: 80%;
    margin-right: 4%;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
    display: inline-block;
    width: 15%;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
    height: 3em;
    width: auto;
    display: none;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
    display: initial;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
    background-color: #eee;
  }
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
    font-weight: bold;
    font-style: normal;
  }

  </style>


  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        var refs = $(this).attr('data-cites').split(" ");
        var refHtml = refs.map(function(ref) {
          return "<p>" + $('#ref-' + ref).html() + "</p>";
        }).join("\n");
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
  <script src="site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Modelos Lineales Generalizados","authors":[{"author":"M. en C. Arturo Bell Enríquez García","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}]}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo" href="https://drplancton.com">
<img src="logo.png" alt="Logo"/>
</a>
<a href="index.html" class="title">Bioestadística con R</a>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Temas
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="s1_biolcdatos.html">S1 - Biología como Ciencia de Datos</a>
<a href="s2_herrbasic.html">S2 - Herramientas Básicas</a>
<a href="c08_rls.html">S3 - Modelo Lineal Simple</a>
<a href="s4_noparnolin.html">S4 - No Paramétrico y No Lineal</a>
<a href="s5_mv.html">S5 - Técnicas Multivariadas</a>
</div>
</div>
</div>
<div class="nav-right">
<a href="about.html">Acerca de</a>
<a href="https://github.com/ArturoBell/Bioestadistica_R">
<i class="fab fa-github" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Modelos Lineales Generalizados</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->

</div>

<div class="d-byline">
  
  M. en C. Arturo Bell Enríquez García
  

</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#librerías">Librerías</a></li>
<li><a href="#funciones-personalizadas">Funciones
personalizadas</a></li>
<li><a href="#problemas-familiares">Problemas familiares</a></li>
<li><a href="#regresiones-robustas">Regresiones robustas</a></li>
<li><a href="#funciones-de-enlace">Funciones de enlace</a></li>
<li><a href="#regresiones-para-conteos">Regresiones para conteos</a>
<ul>
<li><a href="#regresión-poisson">Regresión Poisson</a></li>
<li><a href="#exceso-de-ceros-regresión-poisson-inflada-en-cero">Exceso
de ceros: Regresión Poisson Inflada en Cero</a></li>
<li><a
href="#sobre-dispersión-regresión-binomial-negativa">Sobre-dispersión:
Regresión Binomial Negativa</a></li>
<li><a
href="#exceso-de-ceros-y-sobre-dispersión-regresión-binomial-negativa-inflada-en-cero">Exceso
de ceros y sobre dispersión: Regresión Binomial Negativa Inflada en
Cero</a></li>
<li><a href="#interpretación">Interpretación</a></li>
</ul></li>
<li><a href="#selección-de-modelos">Selección de modelos</a>
<ul>
<li><a href="#criterio-de-información-de-akaike">Criterio de Información
de Akaike</a></li>
</ul></li>
<li><a href="#regresiones-para-clases">Regresiones para clases</a>
<ul>
<li><a href="#regresión-logística-binaria">Regresión logística
binaria</a></li>
<li><a href="#regresión-logística-multinomial">Regresión logística
multinomial</a></li>
</ul></li>
<li><a href="#despedida">Despedida</a></li>
</ul>
</nav>
</div>
<h2 id="librerías">Librerías</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ggplot2.tidyverse.org'>ggplot2</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>stats4</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/paul-buerkner/brms'>brms</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://pbreheny.github.io/visreg'>visreg</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://github.com/atahk/pscl'>pscl</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://www.stats.ox.ac.uk/pub/MASS4/'>MASS</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>MuMIn</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="funciones-personalizadas">Funciones personalizadas</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Tema personalizado</span>
<span class='va'>blank_theme</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span><span class='op'>{</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>panel.grid.minor <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,
        panel.grid.major <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,
        panel.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,
        axis.line <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,
        aspect.ratio <span class='op'>=</span> <span class='fl'>1</span><span class='op'>/</span><span class='fl'>1.61</span>,
        axis.ticks <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,
        text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>colour <span class='op'>=</span> <span class='st'>"gray50"</span><span class='op'>)</span>,
        legend.position <span class='op'>=</span> <span class='st'>"none"</span>
        <span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<h2 id="problemas-familiares">Problemas familiares</h2>
<p>En la sesión <a
href="https://arturobell.github.io/Bioestadistica_R/c15_regs_mv.html">anterior</a>
mencionamos cómo utilizar combinaciones lineales de variables para
predecir una variable continua, pero también recordarás que en la sesión
de <a
href="https://arturobell.github.io/Bioestadistica_R/c08_rls.html">RLS</a>
hablamos de modificar el supuesto de la distribución de nuestros errores
para obtener una mejor estimación, lo cual conforma una parte
fundamental de los <strong>modelos lineales generalizados</strong>
(GLMs).</p>
<p>La modificación puede ser tan “simple” (al menos en términos de
intuición) como relajar el supuesto de normalidad, pero podemos también
utilizar otras distribuciones que nos permitan modelar otro tipo de
información. Bueno, hoy aterrizaremos esa última idea: <strong>La
estructura principal de un GLM sigue siendo un modelo lineal, aunque
nuestro supuesto de la distribución de errores no será exclusivamente
normal, sino que puede tomar alguna otra <em>familia</em> de
distribuciones, enlazada a nuestros datos con alguna función</strong>.
En la sesión de hoy revisaremos:</p>
<ul>
<li><strong>Regresiones robustas</strong>, expandiendo un poco la
distribución <em>t</em> como distribución de errores y revisando una
alternativa.</li>
<li><strong>Funciones de enlace</strong> y enlace inverso.</li>
<li><strong>Regresiones para conteos</strong>: Poisson, Binomial
Negativa y sus variantes infladas en zeros.</li>
<li><strong>Selección de modelos</strong>; <em>i.e.</em>, cómo
seleccionar el mejor de un conjunto de modelos candidatos.</li>
<li><strong>Regresiones para clases</strong>: Regresión logística
binomial y multinomial.</li>
</ul>
<p><strong>OJO: Por practicidad obviaré la división datos de
entrenamiento-prueba; sin embargo, es algo que SIEMPRE se debe de tener
en cuenta</strong></p>
<h2 id="regresiones-robustas">Regresiones robustas</h2>
<p>La idea de una regresión robusta la revisamos en la sesión de <a
href="https://arturobell.github.io/Bioestadistica_R/c08_rls.html">RLS</a>;
es decir, utilizar una distribución con colas más altas que una
distribución normal para poder contender con el efecto de puntos
extremos, pero expandamos esa idea. ¿Qué significa el “peso” de las
colas de una distribución? Qué tanta densidad (o masa, para
distribuciones discretas) de probabilidad está acumulada lejos de la
tendencia central. En palabras más sencillas, una distribución con colas
ligeras como la normal <em>piensa</em> que la
<strong>probabilidad</strong> de tener <strong>valores lejos</strong> de
la tendencia <strong>central</strong> es <strong>muy baja</strong>; por
lo tanto, <strong>consiidera “todos” los datos</strong> como
<strong>igual</strong> de importantes y <em>reacciona</em> moviendo la
estimación. ¿No me crees? Veamos un caso extremo, utilizando el tercer
conjunto de datos de el <a href=""><em>cuarteto de
Anscombe</em></a>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Almacenados en R como anscombe</span>
<span class='va'>ansc</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/read.table.html'>read.csv</a></span><span class='op'>(</span><span class='st'>"data/anscombe.csv"</span><span class='op'>)</span>
<span class='va'>ansc</span><span class='op'>$</span><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/scale.html'>scale</a></span><span class='op'>(</span><span class='va'>ansc</span><span class='op'>$</span><span class='va'>x</span>, center <span class='op'>=</span> <span class='cn'>TRUE</span>, scale <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>ansc</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span>, color <span class='op'>=</span> <span class='va'>conjunto</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span><span class='op'>~</span><span class='va'>conjunto</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>blank_theme</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Cuarteto de Anscombe"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_color_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"gray70"</span>, <span class='st'>"gray70"</span>, <span class='st'>"#1f77b4"</span>, <span class='st'>"gray70"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="c16_glm_files/figure-html5/unnamed-chunk-3-1.png" width="624" /></p>
</div>
<p>Si vemos su distribución de <code>y</code> notaremos que no es
<em>exactamente</em> normal, debido a ese punto extremo en 12.5:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>ansc_iii</span> <span class='op'>=</span> <span class='va'>ansc</span><span class='op'>[</span><span class='va'>ansc</span><span class='op'>$</span><span class='va'>conjunto</span> <span class='op'>==</span> <span class='st'>"III"</span>,<span class='op'>]</span>
<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>ansc_iii</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_density.html'>geom_density</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"#1f77b4"</span>, fill <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>blank_theme</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Densidad de y del conjunto III de Anscombe"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="c16_glm_files/figure-html5/unnamed-chunk-4-1.png" width="624" /></p>
</div>
<p>Ajustemos entonces nuestra regresión lineal simple:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>ansciii_lm</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>~</span><span class='va'>x</span>, data <span class='op'>=</span> <span class='va'>ansc_iii</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>ansciii_lm</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
Call:
lm(formula = y ~ x, data = ansc_iii)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.1586 -0.6146 -0.2303  0.1540  3.2411 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   7.5000     0.3728  20.120 8.61e-09 ***
x             0.4997     0.1179   4.239  0.00218 ** 
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 1.236 on 9 degrees of freedom
Multiple R-squared:  0.6663,    Adjusted R-squared:  0.6292 
F-statistic: 17.97 on 1 and 9 DF,  p-value: 0.002176</code></pre>
</div>
<p>Gráficamente:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>ansc_iii</span>,
       <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"#1f77b4"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_smooth.html'>geom_smooth</a></span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>"lm"</span>,
              color <span class='op'>=</span> <span class='st'>"gray50"</span>,
              fill <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>blank_theme</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"RLS con supuesto de normalidad"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="c16_glm_files/figure-html5/unnamed-chunk-6-1.png" width="624" /></p>
</div>
<p>No se ve mal; sin embargo, es claro que el punto extremo está
influenciando la estimación.Podemos aplicar algún criterio de detección
de valores extremos (o deformar nuestros datos) para cumplir con el
supuesto de normalidad; sin embargo, <strong>más que parchar nuestros
datos, es preferible modificar nuestro modelo</strong>. Cambiemos
entonces a una regresión con una verosimilitud <em>t</em> de
Student:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>LLt</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>b0</span>, <span class='va'>b1</span>, <span class='va'>df</span>, <span class='va'>sigma</span><span class='op'>)</span><span class='op'>{</span>
  <span class='co'># Encontrar los residuales. Modelo a ajustar (lineal)</span>
  <span class='va'>R</span> <span class='op'>=</span> <span class='va'>ansc_iii</span><span class='op'>$</span><span class='va'>y</span> <span class='op'>-</span> <span class='va'>ansc_iii</span><span class='op'>$</span><span class='va'>x</span><span class='op'>*</span><span class='va'>b1</span> <span class='op'>-</span> <span class='va'>b0</span>
  
  <span class='co'># Calcular la verosimilitud. Residuales con distribución t de student</span>
  
  <span class='va'>R</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/warning.html'>suppressWarnings</a></span><span class='op'>(</span><span class='fu'>brms</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/brms/man/StudentT.html'>dstudent_t</a></span><span class='op'>(</span><span class='va'>R</span>, df <span class='op'>=</span> <span class='va'>df</span>,
                                        mu <span class='op'>=</span> <span class='fl'>0</span>, sigma <span class='op'>=</span> <span class='va'>sigma</span><span class='op'>)</span><span class='op'>)</span>
  
  <span class='co'># Sumar el logaritmo de las verosimilitudes</span>
  <span class='co'># para todos los puntos de datos.</span>
  <span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>R</span>, log <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>mlet_fit</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats4/mle.html'>mle</a></span><span class='op'>(</span><span class='va'>LLt</span>, 
                start <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>b0 <span class='op'>=</span> <span class='fl'>0</span>, b1 <span class='op'>=</span> <span class='fl'>0</span>, df <span class='op'>=</span> <span class='fl'>2</span>, sigma <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>,
                nobs <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>ansc_iii</span><span class='op'>$</span><span class='va'>y</span><span class='op'>)</span>,
                lower <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>b0 <span class='op'>=</span> <span class='op'>-</span><span class='fl'>20</span>, b1 <span class='op'>=</span> <span class='op'>-</span><span class='fl'>12</span>, df <span class='op'>=</span> <span class='fl'>1</span>, sigma <span class='op'>=</span> <span class='fl'>0.1</span><span class='op'>)</span>,
                upper <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>b0 <span class='op'>=</span> <span class='fl'>20</span>, b1 <span class='op'>=</span> <span class='fl'>12</span>, df <span class='op'>=</span> <span class='fl'>30</span>, sigma <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>mlet_fit</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Maximum likelihood estimation

Call:
mle(minuslogl = LLt, start = list(b0 = 0, b1 = 0, df = 2, sigma = 1), 
    nobs = length(ansc_iii$y), lower = list(b0 = -20, b1 = -12, 
        df = 1, sigma = 0.1), upper = list(b0 = 20, b1 = 12, 
        df = 30, sigma = 10))

Coefficients:
        Estimate   Std. Error
b0     7.1141555  0.015785311
b1     0.3453896  0.005152567
df    30.0000000 36.983300378
sigma  0.1000000          NaN

-2 log L: -81.09539 </code></pre>
</div>
<p>Ahora empatemos ambas regresiones en un mismo gráfico:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>coefs_t</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span><span class='op'>(</span><span class='va'>mlet_fit</span><span class='op'>)</span>
<span class='va'>fitted</span> <span class='op'>&lt;-</span> <span class='va'>coefs_t</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>+</span> <span class='va'>coefs_t</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>*</span><span class='va'>ansc_iii</span><span class='op'>$</span><span class='va'>x</span>
<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>ansc_iii</span>,
       <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>fitted</span><span class='op'>)</span>,
            color <span class='op'>=</span> <span class='st'>"#ff7f0e"</span>,
            size <span class='op'>=</span> <span class='fl'>1</span>, alpha <span class='op'>=</span> <span class='fl'>0.7</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_smooth.html'>geom_smooth</a></span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>"lm"</span>,
              color <span class='op'>=</span> <span class='st'>"gray50"</span>,
              fill <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"#1f77b4"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Regresión robusta"</span>,
       subtitle <span class='op'>=</span> <span class='st'>"OLS (gris) vs. t de Student (naranja)"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="c16_glm_files/figure-html5/unnamed-chunk-8-1.png" width="624" /></p>
</div>
<p>En este caso el punto extremo ya no influenció la estimación de la
regresión, lo cual en la mayoría de los casos es algo deseable. Aunque
esta es una forma de realizar una regresión robusta, existen otras. Una
de ellas es modificar la función de pérdida, como por ejemplo con la
Regresión con pérdida Huber. Los detalles matemáticos los dejaré para tu
investigación, lo realmente importante es entender que los errores
(residuales) son ponderados diferencialmente en función de su magnitud;
es decir, se resta importancia a aquellos residuales que sean grandes y,
de hecho, si están por encima de cierto límite, son descartados por
completo. Su implementación es sumamente sencilla, pues lo único que
tenemos que hacer es modificar <code>lm</code> por la función
<code>rlm</code> de la librería <code>MASS</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>rr.huber</span> <span class='op'>&lt;-</span> <span class='fu'>MASS</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/MASS/man/rlm.html'>rlm</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>~</span><span class='va'>x</span>, data <span class='op'>=</span> <span class='va'>ansc_iii</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>rr.huber</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
Call: rlm(formula = y ~ x, data = ansc_iii)
Residuals:
       Min         1Q     Median         3Q        Max 
-0.0049962 -0.0028591 -0.0007219  0.0028667  4.2421008 

Coefficients:
            Value     Std. Error t value  
(Intercept)    7.1150    0.0013  5309.3547
x              0.3457    0.0004   815.8284

Residual standard error: 0.005248 on 9 degrees of freedom</code></pre>
</div>
<p>¿Notas algo interesante? Los resultados son los mismos que en la
regresión t de Student, aunque aquí podemos ver la ponderación dada a
cada punto:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>hweights</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>ansc_iii</span><span class='op'>$</span><span class='va'>x</span>,
                       resid <span class='op'>=</span> <span class='va'>rr.huber</span><span class='op'>$</span><span class='va'>residuals</span>,
                       weight <span class='op'>=</span> <span class='va'>rr.huber</span><span class='op'>$</span><span class='va'>w</span><span class='op'>)</span>
<span class='va'>hweights</span>
</code></pre>
</div>
<pre><code>    x         resid      weight
23  1 -0.0007219353 1.000000000
24 -1  0.0007295602 1.000000000
25  4  4.2421008214 0.001664007
26  0 -0.0049961876 1.000000000
27  2  0.0035523169 1.000000000
28  5 -0.0036249263 1.000000000
29 -3  0.0021810557 1.000000000
30 -5  0.0036325512 1.000000000
31  3 -0.0021734308 1.000000000
32 -2 -0.0035446921 1.000000000
33 -4 -0.0020931966 1.000000000</code></pre>
</div>
<p>Gráficamente:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>ansc_iii</span>,
       <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_smooth.html'>geom_smooth</a></span><span class='op'>(</span>method <span class='op'>=</span> <span class='fu'>MASS</span><span class='fu'>::</span><span class='va'><a href='https://rdrr.io/pkg/MASS/man/rlm.html'>rlm</a></span>,
             color <span class='op'>=</span> <span class='st'>"#ff7f0e"</span>,
             size <span class='op'>=</span> <span class='fl'>1</span>, alpha <span class='op'>=</span> <span class='fl'>0.7</span>,
             fill <span class='op'>=</span> <span class='st'>"blue"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_smooth.html'>geom_smooth</a></span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>"lm"</span>,
              color <span class='op'>=</span> <span class='st'>"gray50"</span>,
              fill <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='va'>hweights</span><span class='op'>$</span><span class='va'>weight</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Regresión robusta"</span>,
       subtitle <span class='op'>=</span> <span class='st'>"OLS (gris) vs. Huber (naranja)"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_gradient.html'>scale_color_gradient</a></span><span class='op'>(</span>name <span class='op'>=</span> <span class='st'>"Peso"</span>,
                       low <span class='op'>=</span> <span class='st'>"firebrick"</span>,
                       high <span class='op'>=</span> <span class='st'>"#1f77b4"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="c16_glm_files/figure-html5/unnamed-chunk-11-1.png" width="624" /></p>
</div>
<p>Como era de esperarse, los resultados son los mismos que los de la
regresión <em>t</em> de Student. En la definición de un GLM tenemos tres
elementos importantes:</p>
<ol type="1">
<li>El modelo lineal, que es el mismo en ambos casos.</li>
<li>Una familia para el error, que no modificamos en la regresión Huber;
sin embargo la familia sería Gaussiana (Normal).</li>
<li>Una función de enlace (o enlace inverso), que en ambos casos sería
una función de identidad; es decir, ninguna modificación para pasar de
nuestros datos a la distribución del error.</li>
</ol>
<p>Es decir, que en un sentido amplio, ambas aproximaciones son GLMs,
aunque usualmente nos referimos a GLMs cuando la distribución del error
es diferente a una distribución normal. ¿Cuál aplicar? Ya que el
resultado es el mismo, puedes escoger una u otra, solo ten en cuenta que
la implementación por máxima verosimilitud de un modelo <em>t</em> de
Student puede tener muchos bemoles al momento de optimizarse, además de
que su salida es incompatible con algunas otras funciones, incluyendo el
cálculo de los intervalos de confianza (para los coeficientes de la
regresión Huber puedes utilizar la función
<code>confint.default(rr.huber)</code>).</p>
<h2 id="funciones-de-enlace">Funciones de enlace</h2>
<p>Este es un buen momento para hablar de un tema que a veces causa
bastante confusión: las funciones de enlace o las funciones de enlace
inverso. Estas son funciones “arbitrarias” (ojo a las comillas) que
tienen una sola función (valga la redundancia): poner la salida de
nuestro modelo lineal en los “requerimientos” de la familia de nuestro
error. En el caso anterior, la distribución <em>t</em> es una
distribución continua de probabilidad que está centrada en 0, como
esperaríamos de nuestros residuales, por lo que la función de enlace es
una <strong>función de identidad</strong>; es decir, no hacemos nada a
la salida del modelo para poder obtener residuales continuos centrados
en 0. Pero este no siempre es el caso; de hecho, las aplicaciones más
comunes de GLM siempre requieren de algún enlace. ¿Y los enlaces
inversos? Son simple y sencillamente el inverso de la función de enlace
aplicados al lado contrario de la igualdad. Matemáticamente es más
claro:</p>
<p>En un GLM con una función de enlace tendríamos la siguiente
estructura para nuestro modelo lineal:</p>
<p><span class="math display">\[
f(y) = \beta_0 + \beta_1*x
\]</span> Es decir, modificamos la salida (<span
class="math inline">\(y\)</span>) de nuestro modelo lineal utilizando
una función <span class="math inline">\(y\)</span>. Si es una función
logarítmica, por ejemplo, se vería de la siguiente manera:</p>
<p><span class="math display">\[
log(y) = \beta_0 + \beta_1*x
\]</span></p>
<p>Pero obtendríamos exactamente lo mismo si utilizamos un poco de
álgebra y resolvemos para <span class="math inline">\(y\)</span>,
aplicando un exponencial a ambos lados de la igualdad:</p>
<p><span class="math display">\[
e^{log(y))} = e^{(\beta_0 + \beta_1*x)} \\
\therefore \\
y = e^{(\beta_0 + \beta_1 *x)}
\]</span></p>
<p>El apelativo “inversa” es simplemente para indicar el lado dónde se
está aplicando el enlace. Habiendo dicho esto, vayamos a una de las
aplicaciones más comunes para GLM: la regresión para conteos.</p>
<h2 id="regresiones-para-conteos">Regresiones para conteos</h2>
<p>Te preguntarás qué tienen de especial los conteos, y la respuesta es
muy simple: son valores enteros mayores o iguales a 0. Esto quiere decir
que una distribución normal (<em>t</em>, o cualquier otra distribución
continua) NO es adecuada para modelar los datos. ¿Qué hacemos?
Utilizamos alguna distribución discreta que nos permita tratar con el
número de veces en que algo sucede.</p>
<h3 id="regresión-poisson">Regresión Poisson</h3>
<p>Muy posiblemente esto te suene a <strong>ensayos de
Bernoulli</strong> o ejercicios con distribuciones
<strong>Poisson</strong> (¿cuántos autos rojos pasan en una hora por un
punto determinado?, por ejemplo). Pues justamente podemos utilizar esa
misma distribución (Poisson). Esta distribución tiene un par de
peculiaridades. La primera es que asume que los eventos ocurren de
manera independiente entre sí, a un intervalo fijo de espacio o tiempo.
La segunda es que su único parámetro (<span
class="math inline">\(\lambda\)</span>) representa tanto la media como
la varianza de la distribución (más adelante hablaremos de las
implicaciones de esto), por lo que DEBE ser positivo. ¿El problema?
Nuestros residuales pueden ser negativos. ¿Qué podemos hacer? Aplicar
una función de enlace inverso que nos permita restringir nuestro
predictor a valores positivos, justo como la función exponencial, por lo
que nuestro modelo se expresaría de la siguiente forma:</p>
<p><span class="math display">\[
\lambda = e^{(\beta_0 + \beta_1*x)} \\
y \sim Poisson(\lambda)
\]</span></p>
<p>Para aplicarlo resolvamos un problema en el cuál trataremos de
<strong>predecir</strong> el número de peces capturados en un lago por
un pescador, considerando el número de hijos y si llevan o no un
camper:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>csvurl</span> <span class='op'>&lt;-</span> <span class='st'>"https://stats.idre.ucla.edu/stat/data/fish.csv"</span>
<span class='va'>fish</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/read.table.html'>read.csv</a></span><span class='op'>(</span><span class='va'>csvurl</span><span class='op'>)</span><span class='op'>[</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"child"</span>, <span class='st'>"camper"</span>, <span class='st'>"count"</span><span class='op'>)</span><span class='op'>]</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>fish</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>  child camper count
1     0      0     0
2     0      1     0
3     0      0     0
4     1      1     0
5     0      0     1
6     2      1     0</code></pre>
</div>
<p>Exploremos nuestros datos. Al tratarse de una variable categórica
podemos, sin ningún problema, utilizar un gráfico de frecuencias:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>count</span><span class='op'>)</span>, data <span class='op'>=</span> <span class='va'>fish</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_bar.html'>geom_bar</a></span><span class='op'>(</span>stat <span class='op'>=</span> <span class='st'>"count"</span>, color <span class='op'>=</span> <span class='cn'>NA</span>, fill <span class='op'>=</span> <span class='st'>"dodgerblue4"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>blank_theme</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Frecuencia de peces capturados en un lago"</span>,
       x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,
       y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="c16_glm_files/figure-html5/unnamed-chunk-13-1.png" width="624" /></p>
</div>
<p>¿Qué otro gráfico utilizarías? Por otra parte, habrás notado un par
de cosas: a) hay una gran cantidad de ceros y b) tenemos algunos puntos
“extremos”; <em>i.e.</em>, algunos pescadores que tuvieron demasiada
suerte y que capturaron demasiados peces en comparación con el resto.
Este tipo de distribuciones no son extrañas en la naturaleza, y tienen
un par de bemoles de los cuales hablaremos después. Por lo pronto,
construyamos nuestro GLM. Para ello utilizaremos la función
<code>glm</code> de R base, cuyo uso es sumamente similar al de la
función <code>lm</code>, salvo que indicaremos la familia como un
argumento adicional:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>poiss</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span><span class='op'>(</span><span class='va'>count</span><span class='op'>~</span><span class='va'>.</span>, data <span class='op'>=</span> <span class='va'>fish</span>, family <span class='op'>=</span> <span class='st'>"poisson"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>poiss</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
Call:
glm(formula = count ~ ., family = &quot;poisson&quot;, data = fish)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.7736  -2.2293  -1.2024  -0.3498  24.9492  

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  0.91026    0.08119   11.21   &lt;2e-16 ***
child       -1.23476    0.08029  -15.38   &lt;2e-16 ***
camper       1.05267    0.08871   11.87   &lt;2e-16 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 2958.4  on 249  degrees of freedom
Residual deviance: 2380.1  on 247  degrees of freedom
AIC: 2723.2

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<p>La salida es muy similar a otras que hemos visto. Cómo llamamos a la
función glm, un descriptor de los residuales, los coeficientes con sus
respectivas pruebas de nulidad (después hablaremos de su
interpretación), seguidas de algunos elementos propios de la función
<code>GLM</code>. Primero tenemos una nota sobre un parámetro de
dispersión, que se asumió como 1. Esto quiere decir que estamos
asumiendo que la media es igual a la varianza, lo cual podemos tomar
solo como un recordatorio para que revisemos dicho supuesto. Después
tenemos información sobre la devianza del modelo. Podemos utilizar la
devianza residual para realizar una prueba de bondad de ajuste para el
modelo global. Esta es la diferencia entre la devianza del modelo y la
máxima devianza de un modelo ideal, donde los valores predichos son
idénticos a los observados (devianza nula). Por lo tanto, buscamos
valores pequeños de la devianza residual. Dicha prueba podemos
realizarla de la siguiente manera:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/with.html'>with</a></span><span class='op'>(</span><span class='va'>poiss</span>, <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span>res.deviance <span class='op'>=</span> <span class='va'>deviance</span>,
                  df <span class='op'>=</span> <span class='va'>df.residual</span>,
                  p <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Chisquare.html'>pchisq</a></span><span class='op'>(</span><span class='va'>deviance</span>, <span class='va'>df.residual</span>,
                             lower.tail <span class='op'>=</span> <span class='cn'>F</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>     res.deviance  df p
[1,]      2380.12 247 0</code></pre>
</div>
<p>Tenemos un valor de p sumamente pequeño, lo cual sugiere que el
modelo no se encuentra bien ajustado. ¿Alguna idea de por qué? Como te
imaginarás, tiene que ver con la distribución de nuestros datos, eso que
mencionamos sobre muchos ceros y algunos pescadores con mucha suerte. De
hecho, cada una de estas características es un problema en sí mismo, así
que abordemoslos uno por uno. Una pregunta que puedes estarte haciendo
es ¿y la función de enlace? Va implícita en la familia. En este caso, es
una función de enlace logarítmica, que es el equivalente a la función de
enlace inverso que revisamos antes.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/family.html'>poisson</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>5</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>List of 5
 $ family  : chr &quot;poisson&quot;
 $ link    : chr &quot;log&quot;
 $ linkfun :function (mu)  
 $ linkinv :function (eta)  
 $ variance:function (mu)  </code></pre>
</div>
<h3 id="exceso-de-ceros-regresión-poisson-inflada-en-cero">Exceso de
ceros: Regresión Poisson Inflada en Cero</h3>
<p>La primera peculiaridad de nuestros datos es que hay una cantidad
enorme de ceros. Aunque esto puede suceder de manera natural, la
distribución Poisson no es capaz de contender adecuadamente con estos
casos. Afortunadamente, hay una manera de extender el modelo Poisson
para permitirnos arreglar esto. En su forma más fundamental, asumiremos
que tenemos dos procesos:</p>
<ol type="1">
<li>Uno modelado con una distribución Poisson.</li>
<li>Uno generando ceros adicionales.</li>
</ol>
<p>Es decir, cuando hablemos de modelos “inflados en cero” estamos
hablando de una situación en la que tenemos ceros “falsos” o, mejor
dicho, extras a los ceros verdaderos que nos podemos encontrar. Veamos
qué pasa al ajustar este modelo a nuestros datos. Para este modelo
necesitaremos de la función <code>zeroinfl()</code> de la librería
<code>pscl</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>zi_poiss</span> <span class='op'>&lt;-</span> <span class='fu'>pscl</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/pscl/man/zeroinfl.html'>zeroinfl</a></span><span class='op'>(</span><span class='va'>count</span><span class='op'>~</span><span class='va'>child</span><span class='op'>+</span><span class='va'>camper</span>, data <span class='op'>=</span> <span class='va'>fish</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>zi_poiss</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
Call:
pscl::zeroinfl(formula = count ~ child + camper, data = fish)

Pearson residuals:
    Min      1Q  Median      3Q     Max 
-1.2395 -0.8340 -0.4694 -0.1764 24.1051 

Count model coefficients (poisson with log link):
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  1.64535    0.08278  19.877   &lt;2e-16 ***
child       -0.77272    0.09103  -8.489   &lt;2e-16 ***
camper       0.75526    0.09112   8.289   &lt;2e-16 ***

Zero-inflation model coefficients (binomial with logit link):
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)   0.0424     0.2426   0.175   0.8613    
child         1.0244     0.2200   4.656 3.22e-06 ***
camper       -0.7085     0.2926  -2.422   0.0155 *  
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 

Number of iterations in BFGS optimization: 10 
Log-likelihood: -1025 on 6 Df</code></pre>
</div>
<p>La salida es similar al caso anterior, solo tenemos coeficientes para
la regresión logística para clasificar ceros verdaderos de falsos y los
coeficientes del modelo Poisson sin el exceso de ceros; sin embargo,
notarás que no hay ningún indicativo sobre si este modelo es mejor a
nuestro modelo Poisson, por lo que podemos compararlos. Para ello
podemos utilizar distintas alternativas: una prueba de Vuong (función
<code>vuong(mod_1, mod_2)</code> de <code>pscl</code>) o utilizar una
aproximación multi-modelo para la selección de modelos. Optaremos por
esa última vía, la cual exploraremos a detalle más adelante. Por lo
pronto, es suficiente que sepas que utilizaremos una medida llamada
Criterio de Información de Akaike (AIC), y el mejor modelo será aquel
que tenga el menor valor de AIC:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/stats/AIC.html'>AIC</a></span><span class='op'>(</span><span class='va'>poiss</span>, <span class='va'>zi_poiss</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>         df      AIC
poiss     3 2723.186
zi_poiss  6 2062.199</code></pre>
</div>
<p>Como era de esperarse, el modelo inflado en cero es un mejor
candidato; sin embargo, tenemos un problema pendiente: nuestros
pescadores muy suertudos.</p>
<h3 id="sobre-dispersión-regresión-binomial-negativa">Sobre-dispersión:
Regresión Binomial Negativa</h3>
<p>Esos pescadores muy suertudos pueden hacer lo mismo que nuestro punto
extremo en el ejemplo de regresión robusta; es decir, jalar nuestras
estimaciones hacia ellas y alejarlas de la estimación “real”, solo que
aquí es un tanto diferente y tiene que ver con el supuesto de nuestra
distribución Poisson: la media y la varianza son iguales. Este supuesto,
evidentemente, no se sostiene cuando tenemos una dispersión muy grande
de nuestros datos (varianza &gt; media), lo cual genera el problema de
la <strong>sobre dispersión</strong> de nuestro <strong>modelo</strong>
(no de los datos). Una estrategia es cambiar nuestra verosimilitud a una
distribución Binomial Negativa, la cual tiene un parámetro adicional a
la distribución Poisson. Este parámetro modela, justamente, la
dispersión de nuestros datos. Apliquemos entonces nuestra regresión
binomial negativa:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>bineg</span> <span class='op'>&lt;-</span> <span class='fu'>MASS</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/MASS/man/glm.nb.html'>glm.nb</a></span><span class='op'>(</span><span class='va'>count</span><span class='op'>~</span><span class='va'>.</span>, data <span class='op'>=</span> <span class='va'>fish</span>, trace <span class='op'>=</span> <span class='cn'>F</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>bineg</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
Call:
MASS::glm.nb(formula = count ~ ., data = fish, trace = F, init.theta = 0.2552931119, 
    link = log)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.3141  -1.0361  -0.7266  -0.1720   4.0163  

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)   1.0727     0.2425   4.424 9.69e-06 ***
child        -1.3753     0.1958  -7.025 2.14e-12 ***
camper        0.9094     0.2836   3.206  0.00135 ** 
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

(Dispersion parameter for Negative Binomial(0.2553) family taken to be 1)

    Null deviance: 258.93  on 249  degrees of freedom
Residual deviance: 201.89  on 247  degrees of freedom
AIC: 887.42

Number of Fisher Scoring iterations: 1

              Theta:  0.2553 
          Std. Err.:  0.0329 

 2 x log-likelihood:  -879.4210 </code></pre>
</div>
<p>Notarás que esta salida es prácticamente la misma que la que tuvimos
en nuestro GLM Poisson, salvo que ahora nos da el valor del parámetro de
sobredispersión. Te estarás preguntando: ¿Cómo sé si, en efecto, mis
datos están sobre-dispersos? Para eso podemos utilizar una prueba de
razón de verosimilitud, en la cual compararemos la verosimilitud de
ambos modelos (binomial negativa y Poisson) y veremos si se ajustan a la
misma distribución; es decir, la prueba de razón de verosimilitud es una
prueba de bondad de ajuste, con distribución <span
class="math inline">\(\chi^2\)</span>. ¿Qué es lo que estamos
comparando? Si el parámetro adicional ayuda a que el ajuste del modelo
mejore significativamente. Para aplicarla podemos utilizar la función
<code>odTest(mod_bn)</code> de la librería <code>pscl</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>pscl</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/pscl/man/odTest.html'>odTest</a></span><span class='op'>(</span><span class='va'>bineg</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Likelihood ratio test of H0: Poisson, as restricted NB model:
n.b., the distribution of the test-statistic under H0 is non-standard
e.g., see help(odTest) for details/references

Critical value of test statistic at the alpha= 0.05 level: 2.7055 
Chi-Square Test Statistic =  1837.7652 p-value = &lt; 2.2e-16 </code></pre>
</div>
<p>A ojo de buen cubero era más que evidente que nuestros datos estaban
sobre dispersos, por lo que estos resultados no son sorprendentes. Algo
que puedes pensar es “si estoy comparando qué modelo está mejor
ajustado, ¿puedo entonces utilizar el AIC?” Y la respuesta es, por
supuesto:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/stats/AIC.html'>AIC</a></span><span class='op'>(</span><span class='va'>poiss</span>, <span class='va'>zi_poiss</span>, <span class='va'>bineg</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>         df       AIC
poiss     3 2723.1858
zi_poiss  6 2062.1989
bineg     4  887.4206</code></pre>
</div>
<p>Y los resultados son, como debe de ser, consistentes. Llegados a este
punto podrías preguntarme: “Ok, Arturo, ya corregimos para el exceso de
ceros y para la sobre dispersión, pero lo hicimos de manera
independiente. ¿Hay alguna manera de hacer ambas cosas al mismo tiempo?”
En efecto, y es justo lo siguiente que vamos a revisar.</p>
<h3
id="exceso-de-ceros-y-sobre-dispersión-regresión-binomial-negativa-inflada-en-cero">Exceso
de ceros y sobre dispersión: Regresión Binomial Negativa Inflada en
Cero</h3>
<p>Y, justamente, es una combinación de ambas; es decir, utilizaremos
una distribución de error binomial negativa inflada en cero. La lógica
es, entonces, una combinación de ambas aproximaciones; es decir,
modelaremos a los ceros verdaderos y luego construiremos el modelo de
regresión binomial negativa. Para hacerlo utilizaremos la función
<code>zeroinfl()</code> que vimos antes, solo que cambiaremos la familia
a <code>negbin</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>zi_bineg</span> <span class='op'>&lt;-</span> <span class='fu'>pscl</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/pscl/man/zeroinfl.html'>zeroinfl</a></span><span class='op'>(</span><span class='va'>count</span><span class='op'>~</span><span class='va'>.</span>, data <span class='op'>=</span> <span class='va'>fish</span>, dist <span class='op'>=</span> <span class='st'>"negbin"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>zi_bineg</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
Call:
pscl::zeroinfl(formula = count ~ ., data = fish, dist = &quot;negbin&quot;)

Pearson residuals:
      Min        1Q    Median        3Q       Max 
-0.512182 -0.497136 -0.325130 -0.003367 13.978082 

Count model coefficients (negbin with log link):
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)   1.0515     0.2700   3.895 9.84e-05 ***
child        -0.9113     0.2851  -3.196  0.00139 ** 
camper        0.7976     0.3054   2.611  0.00902 ** 
Log(theta)   -1.2960     0.1316  -9.849  &lt; 2e-16 ***

Zero-inflation model coefficients (binomial with logit link):
            Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)  -11.499     55.699  -0.206    0.836
child         10.483     55.659   0.188    0.851
camper        -9.501     55.663  -0.171    0.864
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 

Theta = 0.2736 
Number of iterations in BFGS optimization: 84 
Log-likelihood: -434.9 on 7 Df</code></pre>
</div>
<p>Finalmente, podemos comparar nuestros cuatro modelos candidatos para
encontrar el más adecuado:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/stats/AIC.html'>AIC</a></span><span class='op'>(</span><span class='va'>poiss</span>, <span class='va'>zi_poiss</span>, <span class='va'>bineg</span>, <span class='va'>zi_bineg</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>         df       AIC
poiss     3 2723.1858
zi_poiss  6 2062.1989
bineg     4  887.4206
zi_bineg  7  883.8127</code></pre>
</div>
<p>Vemos que los AIC de los modelos con distribución de error binomial
negativa tienen los menores valores; por lo tanto seleccionaremos a
alguno de los dos. ¿Cuál? En la siguiente sección hablaremos de las
peculiaridades. Por lo pronto, sigamos con nuestro criterio de
seleccionar el que tenga el menor AIC, que corresponde a la distribución
binomial negativa inflada en cero. Ahora sí, podemos interpretar
nuestros coeficientes.</p>
<h3 id="interpretación">Interpretación</h3>
<p>Desafortunadamente, la interpretación no es tan simple como en la RLM
o RLS, debido a la función de enlace que utilizamos.</p>
<p>Para facilitarnos la existencia, planteemos un modelo Poisson con un
solo predictor, y la función de enlace logarítmica:</p>
<p><span class="math display">\[
Y \sim Poisson(\theta) \\
log(\theta) = \alpha + \beta x \\
\therefore \\
\theta = e^{\alpha + \beta x}
\]</span></p>
<p>Pero, por las leyes de los exponentes, podemos reescribir la última
ecuación como:</p>
<p><span class="math display">\[
\theta = e^{a}e^{\beta x}
\]</span> Esto quiere decir que los coeficientes no son aditivos, sino
multiplicativos:</p>
<ol type="1">
<li>Intercepto: <span class="math inline">\(e^\alpha\)</span>, valor de
<span class="math inline">\(\theta\)</span> cuando <span
class="math inline">\(x = 0\)</span>. Si este parámetro es o no de
interés depende totalmente del problema.</li>
<li>Pendiente(s): <span class="math inline">\(e^\beta\)</span>.</li>
</ol>
<ul>
<li>Si <span class="math inline">\(\beta = 0\)</span>, entonces <span
class="math inline">\(e^\beta = 1\)</span>; es decir, no hay un efecto
del predictor.</li>
<li>Si <span class="math inline">\(\beta &gt; 0\)</span>, entonces <span
class="math inline">\(e^\beta &gt; 1\)</span>; es decir, el predictor
incrementa el valor de <span class="math inline">\(\theta\)</span> a una
<strong>tasa</strong> de <span class="math inline">\(e^\beta\)</span>
por cada incremento unitario en <span
class="math inline">\(x\)</span></li>
<li>Si <span class="math inline">\(\beta &lt; 0\)</span>, entonces <span
class="math inline">\(e^\beta &lt; 1\)</span>; es decir, el predictor
disminuye el valor de <span class="math inline">\(\theta\)</span> a una
<strong>tasa</strong> de <span class="math inline">\(e^\beta\)</span>
por cada incremento unitario en <span
class="math inline">\(x\)</span>.</li>
</ul>
<p>Recuperemos los coeficientes de nuestra regresión binomial negativa
inflada en cero y exponenciémoslos:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span><span class='op'>(</span><span class='va'>zi_bineg</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>count_(Intercept)       count_child      count_camper 
        2.8620079         0.4019951         2.2202680 </code></pre>
</div>
<p>Pongamos atención solo a aquellos coeficientes con
<code>count_</code>, pues son los que realmente nos interesan. La
interpretación entonces sería:</p>
<ol type="1">
<li>Intercepto: Cuando el pescador no tiene hijos y no lleva un camper,
el promedio de peces capturados es de 2.86</li>
<li>Pendientes:</li>
</ol>
<ul>
<li>Child: El promedio de peces capturados disminuye 0.4 veces por cada
hijo adicional.</li>
<li>Camper: Si el pescador tiene un camper, el promedio de peces
capturados incrementa 2.2 veces.</li>
</ul>
<p><strong>Corolario: La interpretación depende totalmente de la función
de enlace que utilicemos, y siempre es necesario aplicar el enlace para
poder interpretarlos.</strong></p>
<p>Para construir un gráfico podemos generar una línea con valores
predichos o, mejor dicho, dos líneas: una para cada nivel de
<code>camper</code> (en la sección de <a href="">Extras</a> encontrarás
cómo funcionan los predictores categóricos en modelos de regresión).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>fish</span><span class='op'>$</span><span class='va'>pred</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>zi_bineg</span>, type <span class='op'>=</span> <span class='st'>"response"</span><span class='op'>)</span>

<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>fish</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>child</span>, y <span class='op'>=</span> <span class='va'>count</span>,
                        color <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>camper</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>pred</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"GLM Binomial negativo"</span>,
       x <span class='op'>=</span> <span class='st'>"Número de hijos"</span>,
       y <span class='op'>=</span> <span class='st'>"Peces capturados"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_hue.html'>scale_color_discrete</a></span><span class='op'>(</span>name <span class='op'>=</span> <span class='st'>"Camper"</span>,
                       labels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"NO"</span>, <span class='st'>"SI"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>12</span><span class='op'>)</span>,
                     label <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/label_number.html'>label_comma</a></span><span class='op'>(</span>accuracy <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="c16_glm_files/figure-html5/unnamed-chunk-25-1.png" width="624" /></p>
</div>
<p>O utilizando <code>visreg</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>partial_plots</span> <span class='op'>&lt;-</span> <span class='fu'>visreg</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/visreg/man/visreg.html'>visreg</a></span><span class='op'>(</span><span class='va'>bineg</span>,
                                scale <span class='op'>=</span> <span class='st'>"response"</span>,
                                ylab <span class='op'>=</span> <span class='st'>"Capturas"</span>,
                                gg <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='kw'>for</span> <span class='op'>(</span><span class='va'>plt</span> <span class='kw'>in</span> <span class='va'>partial_plots</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/pkg/pROC/man/plot.roc.html'>plot</a></span><span class='op'>(</span><span class='va'>plt</span> <span class='op'>+</span> <span class='fu'>blank_theme</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
         <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>12</span><span class='op'>)</span>,
                            label <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/label_number.html'>label_comma</a></span><span class='op'>(</span>accuracy <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
         <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_x_discrete</a></span><span class='op'>(</span>limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>plt</span><span class='op'>$</span><span class='va'>data</span><span class='op'>$</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
         <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>plt</span><span class='op'>$</span><span class='va'>labels</span><span class='op'>$</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
<p><img src="c16_glm_files/figure-html5/unnamed-chunk-26-1.png" width="624" /><img src="c16_glm_files/figure-html5/unnamed-chunk-26-2.png" width="624" /></p>
</div>
<p>Antes de cambiar la hoja, es necesario aclarar que aquí NO hay
supuesto de normalidad. ¿Cuál es el punto de cambiar la distribución del
error si vamos a seguir casados buscando normalidad estadística?</p>
<p>Y ahora podemos hablar de la selección de modelos.</p>
<h2 id="selección-de-modelos">Selección de modelos</h2>
<p>El tener varios varios modelos candidatos no es algo extraño,
entonces es necesario tener algún tipo de criterio que nos permita
comparar entre ellos. Una aproximación es la que hemos utilizado hasta
el momento; es decir, utilizar el Criterio de Información de Akaike
(AIC) y seleccionar el menor. ¿Qué es el AIC y con qué se come?</p>
<h3 id="criterio-de-información-de-akaike">Criterio de Información de
Akaike</h3>
<p>El AIC es un criterio basado en <strong>teoría de la
información</strong>, particularmente en la <strong>divergencia
Kullback-Leibler</strong>. Ese detalle matemático va más allá del
alcance de este curso; sin embargo, podemos entender que está basado en
la verosimilitud de un modelo dado; es decir, qué tan verosímil es que
ese modelo haya generado los datos. Un detalle es que, como hemos visto
en sesiones anteriores, el “ajuste” de un modelo es directamente
proporcional a su complejidad (al menos vs. los datos de entrenamiento).
Es, entonces, necesario penalizar de alguna manera el número de
parámetros en el modelo, para no comernos un “gol” con un modelo
excesivamente complejo. Puesto en una ecuación, el AIC queda de la
siguiente manera:</p>
<p><span class="math display">\[
AIC = -2ln(L) + 2k
\]</span></p>
<p>Donde <span class="math inline">\(L\)</span> es la verosimilitud del
modelo y <span class="math inline">\(k\)</span> el número de parámetros.
Si nuestro modelo tiene un gran número de parámetros, el valor de AIC se
hará más grande, mientras que, si tiene un menor número, se hará más
pequeño. ¿Qué nos dice un AIC en sí mismo? NADA, absolutamente nada. Si
yo te digo que un modelo tiene un AIC de 800 no puedes saber si es bueno
o malo, pues no hay una referencia. Esto nos lleva a hablar sobre
algunas consideraciones que debemos de tener al utilizar el AIC:</p>
<ol type="1">
<li>Valores más bajos indican modelos más parsimoniosos.</li>
<li>Es una <strong>medida relativa</strong> de la parsimonia de un
modelo, por lo que solo tiene sentido cuando comparamos AIC para
hipótesis (modelos) alternativas.</li>
<li>Podemos comparar modelos no anidados. De hecho, podríamos comparar
un modelo lineal con uno no lineal.</li>
<li>Las comparaciones son válidas <strong>SOLO</strong> para modelos
ajustados con los mismos valores de respuesta; <em>i.e.</em>, mismos
valores de <span class="math inline">\(y\)</span>.</li>
<li>Comparar muchos modelos con AIC es una mala idea, pues caemos en el
mismo problema de las comparaciones múltiples, donde podemos encontrar
por azar un modelo con el valor más bajo de AIC, cuando en realidad no
es el modelo más apropiado.</li>
<li>Para variar, cuando tratamos con tamaños de muestra pequeños (n/k
&lt; 40) el AIC pierde confiabilidad, por lo que hay que aplicar una
corrección:</li>
</ol>
<ul>
<li><span class="math inline">\(AIC_c = AIC +
\frac{2k(k+1)}{n-k-1}\)</span></li>
<li>Dado que conforme incrementa n, el <span
class="math inline">\(AIC_c\)</span> se aproxima al <span
class="math inline">\(AIC\)</span>, es una buena idea utilizar <span
class="math inline">\(AIC_c\)</span>.</li>
</ul>
<ol start="6" type="1">
<li>Podemos encontrar múltiples modelos que tengan AICs similares, esto
solo sugiere que estas hipótesis alternativas tienen soportes similares.
¿Qué tanto es tantito? Esa respuesta es un poco más compleja, y requiere
que presentemos el <span class="math inline">\(\Delta{AIC}\)</span>
(también lo puedes encontrar como <span
class="math inline">\(\Delta_i\)</span>):</li>
</ol>
<ul>
<li><span class="math inline">\(\Delta AIC = AIC_i - AIC_{min}\)</span>;
es decir, la diferencia de cada AIC respecto al valor mínimo de AIC
entre los modelos candidatos. Esta transformación forza al “mejor”
modelo a tener un <span class="math inline">\(\Delta AIC = 0\)</span>, y
representa la pérdida de información si utilizamos un modelo candidato
<span class="math inline">\(m_i\)</span> en vez de <span
class="math inline">\(m_{min}\)</span>.</li>
<li>Modelos con un <span class="math inline">\(\Delta_i \leq 2\)</span>
tienen soporte substancial (evidencia),</li>
<li>Modelos con un <span class="math inline">\(4 \leq \Delta_i \leq
7\)</span> tienen considerablemente menos soporte y</li>
<li>Modelos con <span class="math inline">\(\Delta_i &gt; 10\)</span>
carecen, escencialmente, de soporte.</li>
</ul>
<p>Recuperemos nuestra comparación anterior, calculemos los <span
class="math inline">\(AIC_c\)</span> (con la función <code>AICc</code>
de la librería <code>MuMIn</code>) y calculemos los <span
class="math inline">\(\Delta_i\)</span>. Como mencionábamos antes, los
modelos con distribuciones binomial negativas son los que tienen el
mayor soporte, mientras que los Poisson carecen de cualquier soporte
(dados estos datos y modelos candidatos). También podemos ver que pesa
más la sobredispersión que el exceso de ceros, pues el modelo inflado en
cero es marginalmente mejor que aquel no inflado.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>AICs</span> <span class='op'>&lt;-</span> <span class='fu'>MuMIn</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/MuMIn/man/AICc.html'>AICc</a></span><span class='op'>(</span><span class='va'>poiss</span>, <span class='va'>zi_poiss</span>, <span class='va'>bineg</span>, <span class='va'>zi_bineg</span><span class='op'>)</span>
<span class='va'>AICs</span><span class='op'>$</span><span class='va'>Delta</span> <span class='op'>&lt;-</span> <span class='va'>AICs</span><span class='op'>$</span><span class='va'>AIC</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>AICs</span><span class='op'>$</span><span class='va'>AIC</span><span class='op'>)</span>
<span class='va'>AICs</span>
</code></pre>
</div>
<pre><code>         df      AICc       Delta
poiss     3 2723.2834 1839.007840
zi_poiss  6 2062.5446 1178.269082
bineg     4  887.5839    3.308338
zi_bineg  7  884.2755    0.000000</code></pre>
</div>
<h2 id="regresiones-para-clases">Regresiones para clases</h2>
<p>En la sesión de <a
href="https://arturobell.github.io/Bioestadistica_R/c14_clasificacion.html">clasificación</a>
hablamos sobre los problemas de clasificación, y aplicamos una
<strong>regresión logística</strong>; sin embargo, no entramos en
detalles. Aprovechemos, entonces, para revisar un poco más a profundidad
la intuición detrás de ella.</p>
<h3 id="regresión-logística-binaria">Regresión logística binaria</h3>
<p>Cuando la revisamos anteriormente, definimos a la regresión logística
como un modelo de RL al cual aplicaríamos una función logística, lo que
nos permite restringir nuestra salida al intervalo <span
class="math inline">\([0,1]\)</span> y, por lo tanto, predecir la
probabilidad de pertenencia a una clase dada. Esa definición es correcta
para resumir lo más posible la técnica; sin embargo, los detalles son un
poco más complejos.</p>
<p>La regresión logística forma parte de los GLMs; por lo tanto, consta
de un predictor lineal, una familia de distribución del error y una
función de enlace. La familia de distribución del error es
<strong>binomial</strong>; es decir, está en términos de la
<strong>probabilidad de éxitos</strong> vs. la probabilidad de fracasos.
Es por esto que la regresión logística tradicional solo nos permite
clasificar entre dos clases. Esto ya lo sabíamos, simplemente lo estamos
formalizando, lo que tiene un poco más de detalles es la función de
enlace: la <strong>función logística</strong>:</p>
<p><span class="math display">\[
logit(z) = \frac{1}{1 + e^{-z}}
\]</span></p>
<p>Esta función tiene la peculiaridad de que, independientemente de los
valores de <span class="math inline">\(z\)</span> (el predictor lineal),
el resultado siempre estará contenido entre 0 y 1, el cual es,
convenientemente, el mismo que el dominio del parámetro <span
class="math inline">\(p\)</span> de la distribución binomial (la
probabilidad de éxito). Expresado matemáticamente:</p>
<p><span class="math display">\[
\theta = logit(\alpha + \beta x)\\
y = Binom(\theta)
\]</span></p>
<p>Apliquemos entonces una regresión logística para clasificar entre
<code>versicolor</code> y <code>virginica</code> de la base
<code>iris</code>, solo para ilustrar cómo interpretar los coeficientes.
Primero, filtremos los datos:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>iris_dat</span> <span class='op'>&lt;-</span> <span class='va'>iris</span>
<span class='va'>iris_dat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>iris</span>,
                   <span class='va'>Species</span> <span class='op'>==</span> <span class='st'>"versicolor"</span> <span class='op'>|</span> <span class='va'>Species</span> <span class='op'>==</span> <span class='st'>"virginica"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Ahora ajustemos el modelo. No te olvides de dividir en
entrenamiento-prueba (o, mejor aún, realizar validación cruzada),
considerar si es necesario escalar los datos, y que puedes también
puedes entrenar los glm utilizando la función
<code>caret::train()</code>. Por practicidad, hagámoslo
directamente.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>logit_reg</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span><span class='op'>(</span><span class='va'>Species</span><span class='op'>~</span><span class='va'>.</span>, data <span class='op'>=</span> <span class='va'>iris_dat</span>, family <span class='op'>=</span> <span class='st'>"binomial"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>logit_reg</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
Call:
glm(formula = Species ~ ., family = &quot;binomial&quot;, data = iris_dat)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-2.01105  -0.00541  -0.00001   0.00677   1.78065  

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)  
(Intercept)   -42.638     25.707  -1.659   0.0972 .
Sepal.Length   -2.465      2.394  -1.030   0.3032  
Sepal.Width    -6.681      4.480  -1.491   0.1359  
Petal.Length    9.429      4.737   1.991   0.0465 *
Petal.Width    18.286      9.743   1.877   0.0605 .
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 138.629  on 99  degrees of freedom
Residual deviance:  11.899  on 95  degrees of freedom
AIC: 21.899

Number of Fisher Scoring iterations: 10</code></pre>
</div>
<p>Y obtengámos los gráficos parciales, utilizando la función
<code>visreg(mod, scale = "response")</code>, donde <code>mod</code> es
el modelo aujustado:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>partial_plots</span> <span class='op'>&lt;-</span> <span class='fu'>visreg</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/visreg/man/visreg.html'>visreg</a></span><span class='op'>(</span><span class='va'>logit_reg</span>, scale <span class='op'>=</span> <span class='st'>"response"</span>,
                                ylab <span class='op'>=</span> <span class='st'>"P(Especie)"</span>,
                                line.par <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>col <span class='op'>=</span> <span class='st'>"dodgerblue4"</span><span class='op'>)</span>,
                                fill.par <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"gray90"</span><span class='op'>)</span>,
                                gg <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='kw'>for</span> <span class='op'>(</span><span class='va'>plt</span> <span class='kw'>in</span> <span class='va'>partial_plots</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/pkg/pROC/man/plot.roc.html'>plot</a></span><span class='op'>(</span><span class='va'>plt</span> <span class='op'>+</span>
         <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>n.breaks <span class='op'>=</span> <span class='fl'>3</span>,
                            labels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"versicolor"</span>, <span class='fl'>0.5</span>, <span class='st'>"virginica"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
         <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
<p><img src="c16_glm_files/figure-html5/unnamed-chunk-30-1.png" width="624" /><img src="c16_glm_files/figure-html5/unnamed-chunk-30-2.png" width="624" /><img src="c16_glm_files/figure-html5/unnamed-chunk-30-3.png" width="624" /><img src="c16_glm_files/figure-html5/unnamed-chunk-30-4.png" width="624" /></p>
</div>
<p>Esto ya lo conocíamos, pero ¿cómo interpretamos los coeficientes?
Antes de pasar a eso, es necesario que pongamos atención al argumento
<code>scale</code> de <code>visreg</code>, el cual indicamos como
<code>response</code>. Esto lo que hizo fue poner nuestra salida en lo
que nos interesa: la probabilidad de pertenencia a una especie, dadas
las medidas de cada variable. Veamos qué pasa si retiramos ese
argumento:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>partial_plots</span> <span class='op'>&lt;-</span> <span class='fu'>visreg</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/visreg/man/visreg.html'>visreg</a></span><span class='op'>(</span><span class='va'>logit_reg</span>, ylab <span class='op'>=</span> <span class='st'>"log-odds(Especie)"</span>, gg <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='kw'>for</span> <span class='op'>(</span><span class='va'>plt</span> <span class='kw'>in</span> <span class='va'>partial_plots</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/pkg/pROC/man/plot.roc.html'>plot</a></span><span class='op'>(</span><span class='va'>plt</span> <span class='op'>+</span> <span class='fu'>blank_theme</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
<p><img src="c16_glm_files/figure-html5/unnamed-chunk-31-1.png" width="624" /><img src="c16_glm_files/figure-html5/unnamed-chunk-31-2.png" width="624" /><img src="c16_glm_files/figure-html5/unnamed-chunk-31-3.png" width="624" /><img src="c16_glm_files/figure-html5/unnamed-chunk-31-4.png" width="624" /></p>
</div>
<p>Ahora nuestros gráficos están en la escala de nuestro modelo lineal;
es decir, con <code>response</code> estamos introduciendo la función de
enlace y graficando el GLM completo; sin embargo, esto no está presente
en los coeficientes “crudos” arrojados por la función GLM, por lo que
toca aplicar el álgebra correspondiente:</p>
<p>El modelo básico es:</p>
<p><span class="math display">\[
\theta = logistic(\alpha + \beta x)
\]</span></p>
<p>El inverso de la función logística es la función
<strong>logit</strong>, dada por:</p>
<p><span class="math display">\[
logit(z) = log \left( \frac{z}{1-z} \right)
\]</span></p>
<p>Por lo que si tomamos la primera ecuación y aplicamos la función
logit a ambos términos, obtenemos esta ecuación:</p>
<p><span class="math display">\[
logit(\theta) = \alpha + \beta x
\]</span></p>
<p>O, de manera equivalente:</p>
<p><span class="math display">\[
log \left( \frac{\theta}{1-\theta} \right) = \alpha + \beta x
\]</span></p>
<p>Ahora, recordemos que <span class="math inline">\(\theta\)</span> en
nuestro modelo es <span class="math inline">\(p(y = 1)\)</span> (la
probabilidad de “éxito”, o de ser <code>virginica</code>):</p>
<p><span class="math display">\[
log \left(\frac{p(y = 1)}{1 - p(y = 1)} \right) = \alpha + \beta x
\]</span></p>
<p>La cantidad <span class="math inline">\(\frac{p(y = 1)}{1 - p(y =
1)}\)</span> se conoce como los <em>odds</em>, que representan la
probabilidad de éxito sobre la probabilidad de fracaso. Mientras que la
probabilidad de obtener 2 al lanzar un dado es de 1/6, los <em>odds</em>
para el mismo evento son <span class="math inline">\(\frac{1/6}{5/6}
\approx 0.2\)</span>, o un éxito a cinco fracasos. En una regresión
logística, <span class="math inline">\(\beta\)</span> representa el
incremento en <em>log-odds</em> por incremento unitario en <span
class="math inline">\(x\)</span>, no en la probabilidad de pertenencia a
una clase, aunque la relación entre <em>odds</em> y probabilidad es
monótona; es decir, conforme incrementa una, la otra también.</p>
<h3 id="regresión-logística-multinomial">Regresión logística
multinomial</h3>
<p>Al igual que en el caso anterior, simplemente extenderemosaquellos
detalles que no se aterrizaron por completo, particularmente el utilizar
una red neuronal como análogo a una regresión logística multinomial.
Como acabamos de ver, una regresión logística binaria nos permite
predecir la probabilidad de éxito; <em>i.e.</em>, de pertenecer a una
sola clase. ¿Cómo lo extendemos a más de dos clases? Podemos construir
modelos una clase vs. las demás, podemos utilizar una regresión
<strong>softmax</strong>, o podemos utilizar una red neuronal. Una red
neuronal está formada por capas, las cuales están conectadas entre sí
tal cual neuronas:</p>
<figure>
<img src="https://miro.medium.com/max/585/1*lk7bbg9gbYKpDYSHABaDOg.png"
alt="NN" />
<figcaption aria-hidden="true">NN</figcaption>
</figure>
<p>Tenemos una capa de entrada, correspondiente a nuestros valores,
seguida de una o más capas ocultas, compuestas por neuronas
(perceptrones) que tienen funciones de activación, las cuales están
conectadas por constantes multiplicadoras (pesos o <em>weights</em>) a
las cuales se les añade una constante (sesgo o <em>bias</em>), cuyo
resultado, finalmente, se envía a la capa de salida <span
class="math inline">\(y\)</span> (nuestras clases objetivo), resultando
en la siguiente forma:</p>
<p><span class="math display">\[
y = f(bias + \sum(weight*input))
\]</span> Gráficamente:</p>
<p><img
src="https://miro.medium.com/max/346/1*dyeq4DKbXlNqPN6mnfN0vw.png"
alt="Neurona" /> ¿Suena familiar? Con solo una capa oculta y una función
(<span class="math inline">\(f\)</span>) de identidad tendríamos un
modelo lineal cualquiera, solo que se ajusta mediante descenso
estocástico de gradiente (fuera de esta discusión) en vez de mínimos
cuadrados o máxima verosimilitud. Si esa función <span
class="math inline">\(f\)</span> la hacemos una función sigmoide
(logística), tenemos entonces una regresión logística para más de dos
clases. En un sentido estricto, esta aproximación no es un GLM (no
tenemos una familia de distribución del error), pero se puede considerar
una generalización a más de dos clases. Algo importante a tener en
cuenta es que al ajustar este modelo, R toma una clase como referencia,
para la cual no otorga los coeficientes. En este caso, es setosa.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>logit_mult</span> <span class='op'>&lt;-</span> <span class='fu'>caret</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/caret/man/train.html'>train</a></span><span class='op'>(</span>form <span class='op'>=</span> <span class='va'>Species</span><span class='op'>~</span><span class='va'>.</span>,
                          data <span class='op'>=</span> <span class='va'>iris</span>,
                          method <span class='op'>=</span> <span class='st'>"multinom"</span>,
                          trace <span class='op'>=</span> <span class='cn'>F</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>logit_mult</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Call:
nnet::multinom(formula = .outcome ~ ., data = dat, decay = param$decay, 
    trace = ..1)

Coefficients:
           (Intercept) Sepal.Length Sepal.Width Petal.Length Petal.Width
versicolor    1.444874   -0.4096645   -2.179216     2.772008  -0.3107031
virginica    -2.860780   -2.5296923   -4.150196     5.878699   4.5107445

Std. Errors:
           (Intercept) Sepal.Length Sepal.Width Petal.Length Petal.Width
versicolor    9.430403     2.847250    2.409686     2.832649    5.829681
virginica    10.247224     3.044536    2.741261     3.078484    6.076775

Residual Deviance: 52.0787 
AIC: 72.0787 </code></pre>
</div>
<p>¿Es un problema? Sí y no. Usualmente solo nos interesa saber qué
variables son más importantes para la clasificación; es decir, qué
variables son más “diferentes” entre nuestras clases, para lo cual
podemos utilizar la función <code>VarImp</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>caret</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/caret/man/varImp.html'>varImp</a></span><span class='op'>(</span><span class='va'>logit_mult</span>, scale <span class='op'>=</span> <span class='cn'>F</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>multinom variable importance

             Overall
Petal.Length   8.651
Sepal.Width    6.329
Petal.Width    4.821
Sepal.Length   2.939</code></pre>
</div>
<p>Esta importancia de variables está dada por la suma de
<strong>absolutos</strong> de los coeficientes para una variable (ver
lecturas recomendadas para más detalles). Una manera más fácil de
interpretarlos es utilizando los valores escalados con respecto al valor
máximo:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>caret</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/caret/man/varImp.html'>varImp</a></span><span class='op'>(</span><span class='va'>logit_mult</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>multinom variable importance

             Overall
Petal.Length  100.00
Sepal.Width    59.36
Petal.Width    32.95
Sepal.Length    0.00</code></pre>
</div>
<p>Esto sería todo para esta clase de GLM, aunque no quiere decir que
sean los únicos. Si te interesa modelar el tiempo entre eventos puedes
utilizar un modelo Gamma, puedes cambiar la relación entre la media y la
varianza de la regresión para conteos utilizando un modelo Quasi-Poisson
en vez de un modelo con distribución binomial negativa (ver lecturas
recomendadas), entre otros.</p>
<h2 id="despedida">Despedida</h2>
<p>Con esto llegamos al final del curso. Espero que el contenido haya
sido de tu agrado, que te hayas llevado algo y, sobre todo, que lo
aprendido te sea útil. En este momento cuentas con bases sólidas para
adentrarte más en cualquiera de los temas aquí vistos, e incluso
incursionar en otros temas. Una recomendación personal es revisar un
paradigma de inferencia diferente: la Inferencia Bayesiana. Si te agradó
mi manera de explicar, te recomiendo ampliamente que esperes mi curso
“Introducción a la Inferencia Bayesiana”, que estará disponible también
aquí en Dr. Plancton en los próximos meses. Te recomiendo también
adentrarte más en el área del aprendizaje automatizado, pues es un mundo
con un potencial enorme de aplicación a problemas biológicos. Si te
interesaría un curso más enfocado a eso, házmelo saber y es posible
organizarlo con algunos miembros del equipo de Dr. Plancton. Recuerda
que siempre puedes contactarme en el servidor de Discord, y que siempre
tendrás acceso a las actualizaciones que se hagan al curso.</p>
<p>Te deseo lo mejor, hoy y siempre.</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<div class="distill-site-nav distill-site-footer">
<p>© Copyright 2021 <a href="https://www.drplancton.com">Dr.
Plancton</a>.</p>
<p>Software licensed under the <a
href="https://www.apache.org/licenses/LICENSE-2.0">Apache License,
v2.0</a>.</p>
</div>
<!--/radix_placeholder_navigation_after_body-->


</body>

</html>
