<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
  <title>Bioestadística con R: Clasificación</title>



  <meta name="article:author" content="M. en C. Arturo Bell Enríquez García"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Bioestadística con R: Clasificación"/>
  <meta property="og:type" content="article"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:site_name" content="Bioestadística con R"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Bioestadística con R: Clasificación"/>

  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","author","output"]}},"value":[{"type":"character","attributes":{},"value":["Clasificación"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["M. en C. Arturo Bell Enríquez García"]}]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["toc","toc_float","code_download"]}},"value":[{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[true]}]}]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  <!--radix_placeholder_navigation_in_header-->
  <meta name="distill:offset" content=""/>

  <script type="application/javascript">

    window.headroom_prevent_pin = false;

    window.document.addEventListener("DOMContentLoaded", function (event) {

      // initialize headroom for banner
      var header = $('header').get(0);
      var headerHeight = header.offsetHeight;
      var headroom = new Headroom(header, {
        tolerance: 5,
        onPin : function() {
          if (window.headroom_prevent_pin) {
            window.headroom_prevent_pin = false;
            headroom.unpin();
          }
        }
      });
      headroom.init();
      if(window.location.hash)
        headroom.unpin();
      $(header).addClass('headroom--transition');

      // offset scroll location for banner on hash change
      // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
      window.addEventListener("hashchange", function(event) {
        window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
      });

      // responsive menu
      $('.distill-site-header').each(function(i, val) {
        var topnav = $(this);
        var toggle = topnav.find('.nav-toggle');
        toggle.on('click', function() {
          topnav.toggleClass('responsive');
        });
      });

      // nav dropdowns
      $('.nav-dropbtn').click(function(e) {
        $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
        $(this).parent().siblings('.nav-dropdown')
           .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $("body").click(function(e){
        $('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $(".nav-dropdown").click(function(e){
        e.stopPropagation();
      });
    });
  </script>

  <style type="text/css">

  /* Theme (user-documented overrideables for nav appearance) */

  .distill-site-nav {
    color: rgba(255, 255, 255, 0.8);
    background-color: #0F2E3D;
    font-size: 15px;
    font-weight: 300;
  }

  .distill-site-nav a {
    color: inherit;
    text-decoration: none;
  }

  .distill-site-nav a:hover {
    color: white;
  }

  @media print {
    .distill-site-nav {
      display: none;
    }
  }

  .distill-site-header {

  }

  .distill-site-footer {

  }


  /* Site Header */

  .distill-site-header {
    width: 100%;
    box-sizing: border-box;
    z-index: 3;
  }

  .distill-site-header .nav-left {
    display: inline-block;
    margin-left: 8px;
  }

  @media screen and (max-width: 768px) {
    .distill-site-header .nav-left {
      margin-left: 0;
    }
  }


  .distill-site-header .nav-right {
    float: right;
    margin-right: 8px;
  }

  .distill-site-header a,
  .distill-site-header .title {
    display: inline-block;
    text-align: center;
    padding: 14px 10px 14px 10px;
  }

  .distill-site-header .title {
    font-size: 18px;
    min-width: 150px;
  }

  .distill-site-header .logo {
    padding: 0;
  }

  .distill-site-header .logo img {
    display: none;
    max-height: 20px;
    width: auto;
    margin-bottom: -4px;
  }

  .distill-site-header .nav-image img {
    max-height: 18px;
    width: auto;
    display: inline-block;
    margin-bottom: -3px;
  }



  @media screen and (min-width: 1000px) {
    .distill-site-header .logo img {
      display: inline-block;
    }
    .distill-site-header .nav-left {
      margin-left: 20px;
    }
    .distill-site-header .nav-right {
      margin-right: 20px;
    }
    .distill-site-header .title {
      padding-left: 12px;
    }
  }


  .distill-site-header .nav-toggle {
    display: none;
  }

  .nav-dropdown {
    display: inline-block;
    position: relative;
  }

  .nav-dropdown .nav-dropbtn {
    border: none;
    outline: none;
    color: rgba(255, 255, 255, 0.8);
    padding: 16px 10px;
    background-color: transparent;
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    margin: 0;
    margin-top: 1px;
    z-index: 2;
  }

  .nav-dropdown-content {
    display: none;
    position: absolute;
    background-color: white;
    min-width: 200px;
    border: 1px solid rgba(0,0,0,0.15);
    border-radius: 4px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
    z-index: 1;
    margin-top: 2px;
    white-space: nowrap;
    padding-top: 4px;
    padding-bottom: 4px;
  }

  .nav-dropdown-content hr {
    margin-top: 4px;
    margin-bottom: 4px;
    border: none;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .nav-dropdown-active {
    display: block;
  }

  .nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
    color: black;
    padding: 6px 24px;
    text-decoration: none;
    display: block;
    text-align: left;
  }

  .nav-dropdown-content .nav-dropdown-header {
    display: block;
    padding: 5px 24px;
    padding-bottom: 0;
    text-transform: uppercase;
    font-size: 14px;
    color: #999999;
    white-space: nowrap;
  }

  .nav-dropdown:hover .nav-dropbtn {
    color: white;
  }

  .nav-dropdown-content a:hover {
    background-color: #ddd;
    color: black;
  }

  .nav-right .nav-dropdown-content {
    margin-left: -45%;
    right: 0;
  }

  @media screen and (max-width: 768px) {
    .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
    .distill-site-header a.nav-toggle {
      float: right;
      display: block;
    }
    .distill-site-header .title {
      margin-left: 0;
    }
    .distill-site-header .nav-right {
      margin-right: 0;
    }
    .distill-site-header {
      overflow: hidden;
    }
    .nav-right .nav-dropdown-content {
      margin-left: 0;
    }
  }


  @media screen and (max-width: 768px) {
    .distill-site-header.responsive {position: relative; min-height: 500px; }
    .distill-site-header.responsive a.nav-toggle {
      position: absolute;
      right: 0;
      top: 0;
    }
    .distill-site-header.responsive a,
    .distill-site-header.responsive .nav-dropdown {
      display: block;
      text-align: left;
    }
    .distill-site-header.responsive .nav-left,
    .distill-site-header.responsive .nav-right {
      width: 100%;
    }
    .distill-site-header.responsive .nav-dropdown {float: none;}
    .distill-site-header.responsive .nav-dropdown-content {position: relative;}
    .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
      display: block;
      width: 100%;
      text-align: left;
    }
  }

  /* Site Footer */

  .distill-site-footer {
    width: 100%;
    overflow: hidden;
    box-sizing: border-box;
    z-index: 3;
    margin-top: 30px;
    padding-top: 30px;
    padding-bottom: 30px;
    text-align: center;
  }

  /* Headroom */

  d-title {
    padding-top: 6rem;
  }

  @media print {
    d-title {
      padding-top: 4rem;
    }
  }

  .headroom {
    z-index: 1000;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
  }

  .headroom--transition {
    transition: all .4s ease-in-out;
  }

  .headroom--unpinned {
    top: -100px;
  }

  .headroom--pinned {
    top: 0;
  }

  /* adjust viewport for navbar height */
  /* helps vertically center bootstrap (non-distill) content */
  .min-vh-100 {
    min-height: calc(100vh - 100px) !important;
  }

  </style>

  <script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
  <link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
  <script src="site_libs/headroom-0.9.4/headroom.min.js"></script>
  <script src="site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
  <script src="site_libs/fuse-6.4.1/fuse.min.js"></script>

  <script type="application/javascript">

  function getMeta(metaName) {
    var metas = document.getElementsByTagName('meta');
    for (let i = 0; i < metas.length; i++) {
      if (metas[i].getAttribute('name') === metaName) {
        return metas[i].getAttribute('content');
      }
    }
    return '';
  }

  function offsetURL(url) {
    var offset = getMeta('distill:offset');
    return offset ? offset + '/' + url : url;
  }

  function createFuseIndex() {

    // create fuse index
    var options = {
      keys: [
        { name: 'title', weight: 20 },
        { name: 'categories', weight: 15 },
        { name: 'description', weight: 10 },
        { name: 'contents', weight: 5 },
      ],
      ignoreLocation: true,
      threshold: 0
    };
    var fuse = new window.Fuse([], options);

    // fetch the main search.json
    return fetch(offsetURL('search.json'))
      .then(function(response) {
        if (response.status == 200) {
          return response.json().then(function(json) {
            // index main articles
            json.articles.forEach(function(article) {
              fuse.add(article);
            });
            // download collections and index their articles
            return Promise.all(json.collections.map(function(collection) {
              return fetch(offsetURL(collection)).then(function(response) {
                if (response.status === 200) {
                  return response.json().then(function(articles) {
                    articles.forEach(function(article) {
                      fuse.add(article);
                    });
                  })
                } else {
                  return Promise.reject(
                    new Error('Unexpected status from search index request: ' +
                              response.status)
                  );
                }
              });
            })).then(function() {
              return fuse;
            });
          });

        } else {
          return Promise.reject(
            new Error('Unexpected status from search index request: ' +
                        response.status)
          );
        }
      });
  }

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // get search element (bail if we don't have one)
    var searchEl = window.document.getElementById('distill-search');
    if (!searchEl)
      return;

    createFuseIndex()
      .then(function(fuse) {

        // make search box visible
        searchEl.classList.remove('hidden');

        // initialize autocomplete
        var options = {
          autoselect: true,
          hint: false,
          minLength: 2,
        };
        window.autocomplete(searchEl, options, [{
          source: function(query, callback) {
            const searchOptions = {
              isCaseSensitive: false,
              shouldSort: true,
              minMatchCharLength: 2,
              limit: 10,
            };
            var results = fuse.search(query, searchOptions);
            callback(results
              .map(function(result) { return result.item; })
            );
          },
          templates: {
            suggestion: function(suggestion) {
              var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
                ? `<img src="${offsetURL(suggestion.preview)}"</img>`
                : '';
              var html = `
                <div class="search-item">
                  <h3>${suggestion.title}</h3>
                  <div class="search-item-description">
                    ${suggestion.description || ''}
                  </div>
                  <div class="search-item-preview">
                    ${img}
                  </div>
                </div>
              `;
              return html;
            }
          }
        }]).on('autocomplete:selected', function(event, suggestion) {
          window.location.href = offsetURL(suggestion.path);
        });
        // remove inline display style on autocompleter (we want to
        // manage responsive display via css)
        $('.algolia-autocomplete').css("display", "");
      })
      .catch(function(error) {
        console.log(error);
      });

  });

  </script>

  <style type="text/css">

  .nav-search {
    font-size: x-small;
  }

  /* Algolioa Autocomplete */

  .algolia-autocomplete {
    display: inline-block;
    margin-left: 10px;
    vertical-align: sub;
    background-color: white;
    color: black;
    padding: 6px;
    padding-top: 8px;
    padding-bottom: 0;
    border-radius: 6px;
    border: 1px #0F2E3D solid;
    width: 180px;
  }


  @media screen and (max-width: 768px) {
    .distill-site-nav .algolia-autocomplete {
      display: none;
      visibility: hidden;
    }
    .distill-site-nav.responsive .algolia-autocomplete {
      display: inline-block;
      visibility: visible;
    }
    .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
      margin-left: 0;
      width: 400px;
      max-height: 400px;
    }
  }

  .algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
    width: 90%;
    outline: none;
    border: none;
  }

  .algolia-autocomplete .aa-hint {
    color: #999;
  }
  .algolia-autocomplete .aa-dropdown-menu {
    width: 550px;
    max-height: 70vh;
    overflow-x: visible;
    overflow-y: scroll;
    padding: 5px;
    margin-top: 3px;
    margin-left: -150px;
    background-color: #fff;
    border-radius: 5px;
    border: 1px solid #999;
    border-top: none;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
    cursor: pointer;
    padding: 5px 4px;
    border-bottom: 1px solid #eee;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
    border-bottom: none;
    margin-bottom: 2px;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
    overflow: hidden;
    font-size: 0.8em;
    line-height: 1.4em;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
    font-size: 1rem;
    margin-block-start: 0;
    margin-block-end: 5px;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
    display: inline-block;
    overflow: hidden;
    height: 2.8em;
    width: 80%;
    margin-right: 4%;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
    display: inline-block;
    width: 15%;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
    height: 3em;
    width: auto;
    display: none;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
    display: initial;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
    background-color: #eee;
  }
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
    font-weight: bold;
    font-style: normal;
  }

  </style>


  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        var refs = $(this).attr('data-cites').split(" ");
        var refHtml = refs.map(function(ref) {
          return "<p>" + $('#ref-' + ref).html() + "</p>";
        }).join("\n");
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
  <script src="site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Clasificación","authors":[{"author":"M. en C. Arturo Bell Enríquez García","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}]}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo" href="https://drplancton.com">
<img src="logo.png" alt="Logo"/>
</a>
<a href="index.html" class="title">Bioestadística con R</a>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Temas
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="s1_biolcdatos.html">S1 - Biología como Ciencia de Datos</a>
<a href="s2_herrbasic.html">S2 - Herramientas Básicas</a>
<a href="c08_rls.html">S3 - Modelo Lineal Simple</a>
<a href="s4_noparnolin.html">S4 - No Paramétrico y No Lineal</a>
<a href="s5_mv.html">S5 - Técnicas Multivariadas</a>
</div>
</div>
</div>
<div class="nav-right">
<a href="about.html">Acerca de</a>
<a href="https://github.com/ArturoBell/Bioestadistica_R">
<i class="fab fa-github" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Clasificación</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->

</div>

<div class="d-byline">
  
  M. en C. Arturo Bell Enríquez García
  

</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#funciones-personalizadas">Funciones
personalizadas</a></li>
<li><a href="#división-centrado-y-estandarizado-de-datos">División,
centrado y estandarizado de datos</a></li>
<li><a href="#análisis-de-funciones-discriminantes">Análisis de
Funciones Discriminantes</a>
<ul>
<li><a href="#ajuste-del-modelo">Ajuste del modelo</a></li>
<li><a href="#importancia-de-variables">Importancia de
variables</a></li>
<li><a
href="#diagnóstico-del-modelo-de-funciones-discriminantes">Diagnóstico
del modelo de funciones discriminantes:</a></li>
</ul></li>
<li><a href="#regresión-logística">Regresión logística</a></li>
<li><a href="#ejercicio">Ejercicio</a></li>
</ul>
</nav>
</div>
<p><strong><a href="https://youtu.be/e0ysgJL1ldQ">VIDEO</a></strong></p>
<h2 id="funciones-personalizadas">Funciones personalizadas</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Tema personalizado</span>
<span class='va'>blank_theme</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>aspect.ratio</span> <span class='op'>=</span> <span class='fl'>1</span><span class='op'>/</span><span class='fl'>1.61</span><span class='op'>)</span><span class='op'>{</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>panel.grid.minor <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,
        panel.grid.major <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,
        panel.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,
        axis.line <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,
        aspect.ratio <span class='op'>=</span> <span class='va'>aspect.ratio</span>,
        axis.ticks <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,
        text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>colour <span class='op'>=</span> <span class='st'>"gray50"</span><span class='op'>)</span>, <span class='co'># Eliminar</span>
        legend.position <span class='op'>=</span> <span class='st'>"none"</span>
        <span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>El objetivo de un problema de clasificación es utilizar distintas
variables (características) para <strong>predecir</strong> la
clase/etiqueta de una instancia. Todas las técnicas de clasificación son
técnicas de aprendizaje automatizado; es decir, bajo la definición que
dimos al inicio de esta sección, no haremos pruebas de hipótesis de
nulidad <em>per-se</em>.</p>
<p>Revisemos entonces algunas técnicas de clasificación utilizando la
misma base de datos que utilizamos en el tema de Análisis de Componentes
Principales:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://www.sthda.com/english/rpkgs/factoextra'>factoextra</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://factominer.free.fr'>FactoMineR</a></span><span class='op'>)</span>

<span class='co'>#Base de datos completa</span>
  
<span class='va'>x1n</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/read.table.html'>read.table</a></span><span class='op'>(</span><span class='st'>'data/Medidas.txt'</span>, header <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='co'>#Base de datos sin nombres de especies</span>

<span class='va'>x1</span> <span class='op'>&lt;-</span> <span class='va'>x1n</span><span class='op'>[</span> ,<span class='fl'>2</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>x1n</span><span class='op'>)</span> <span class='op'>]</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>x1</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>     furcal            base             radio              alto        
 Min.   :0.2527   Min.   :0.07088   Min.   :0.04408   Min.   :0.05319  
 1st Qu.:0.2716   1st Qu.:0.09108   1st Qu.:0.06748   1st Qu.:0.06709  
 Median :0.2753   Median :0.09679   Median :0.07090   Median :0.07140  
 Mean   :0.2757   Mean   :0.09645   Mean   :0.07048   Mean   :0.07116  
 3rd Qu.:0.2801   3rd Qu.:0.10142   3rd Qu.:0.07430   3rd Qu.:0.07534  
 Max.   :0.3202   Max.   :0.11394   Max.   :0.08311   Max.   :0.09723  
     gordo             angos              ojo             X1erarc       
 Min.   :0.02679   Min.   :0.02996   Min.   :0.02142   Min.   :0.03485  
 1st Qu.:0.04139   1st Qu.:0.03465   1st Qu.:0.02451   1st Qu.:0.04332  
 Median :0.04402   Median :0.03577   Median :0.02673   Median :0.05129  
 Mean   :0.04405   Mean   :0.03616   Mean   :0.02740   Mean   :0.05158  
 3rd Qu.:0.04680   3rd Qu.:0.03745   3rd Qu.:0.02875   3rd Qu.:0.05899  
 Max.   :0.05859   Max.   :0.04727   Max.   :0.08191   Max.   :0.07738  
     dist.              largo              cabez             hueso        
 Min.   :0.007179   Min.   :0.004202   Min.   :0.07311   Min.   :0.02857  
 1st Qu.:0.030485   1st Qu.:0.022402   1st Qu.:0.08476   1st Qu.:0.03236  
 Median :0.035368   Median :0.029488   Median :0.08951   Median :0.03415  
 Mean   :0.031366   Mean   :0.026533   Mean   :0.08860   Mean   :0.03488  
 3rd Qu.:0.038824   3rd Qu.:0.034574   3rd Qu.:0.09284   3rd Qu.:0.03582  
 Max.   :0.048008   Max.   :0.051843   Max.   :0.09815   Max.   :0.10411  
     mandib           hueso.1            arriba            cabeza       
 Min.   :0.03141   Min.   :0.02348   Min.   :0.01855   Min.   :0.07118  
 1st Qu.:0.03598   1st Qu.:0.03917   1st Qu.:0.02546   1st Qu.:0.08309  
 Median :0.03980   Median :0.04413   Median :0.02952   Median :0.08796  
 Mean   :0.03923   Mean   :0.04498   Mean   :0.02946   Mean   :0.08890  
 3rd Qu.:0.04247   3rd Qu.:0.04995   3rd Qu.:0.03391   3rd Qu.:0.09483  
 Max.   :0.04758   Max.   :0.08783   Max.   :0.03828   Max.   :0.10760  
      boca             abiert           cachete           largo.1        
 Min.   :0.02828   Min.   :0.01810   Min.   :0.02938   Min.   :0.008724  
 1st Qu.:0.03476   1st Qu.:0.02348   1st Qu.:0.03911   1st Qu.:0.012881  
 Median :0.03830   Median :0.02531   Median :0.04308   Median :0.014240  
 Mean   :0.03954   Mean   :0.02547   Mean   :0.04237   Mean   :0.014366  
 3rd Qu.:0.04368   3rd Qu.:0.02741   3rd Qu.:0.04508   3rd Qu.:0.015936  
 Max.   :0.05552   Max.   :0.03248   Max.   :0.06553   Max.   :0.026475  
     ancho            orificio           densi            hocic        
 Min.   :0.00274   Min.   :0.01968   Min.   :0.6990   Min.   :0.01546  
 1st Qu.:0.02663   1st Qu.:0.03741   1st Qu.:0.7782   1st Qu.:0.02491  
 Median :0.03031   Median :0.04381   Median :0.8451   Median :0.02929  
 Mean   :0.03253   Mean   :0.04429   Mean   :0.8401   Mean   :0.02937  
 3rd Qu.:0.03447   3rd Qu.:0.05085   3rd Qu.:0.9031   3rd Qu.:0.03294  
 Max.   :0.22628   Max.   :0.07390   Max.   :1.1139   Max.   :0.04922  
    interbr            ojoatra            proye              base.1       
 Min.   :0.007687   Min.   :0.02685   Min.   :0.007313   Min.   :0.01546  
 1st Qu.:0.014457   1st Qu.:0.03796   1st Qu.:0.013341   1st Qu.:0.02052  
 Median :0.015776   Median :0.04050   Median :0.014982   Median :0.02238  
 Mean   :0.016304   Mean   :0.04067   Mean   :0.016217   Mean   :0.02300  
 3rd Qu.:0.017609   3rd Qu.:0.04256   3rd Qu.:0.016613   3rd Qu.:0.02474  
 Max.   :0.028804   Max.   :0.08124   Max.   :0.127873   Max.   :0.04476  
     altura             area             Intesti      
 Min.   :0.02514   Min.   :0.001431   Min.   :0.1295  
 1st Qu.:0.03815   1st Qu.:0.006723   1st Qu.:0.1774  
 Median :0.04422   Median :0.009716   Median :0.1960  
 Mean   :0.04474   Mean   :0.010638   Mean   :0.1980  
 3rd Qu.:0.04928   3rd Qu.:0.014274   3rd Qu.:0.2150  
 Max.   :0.08398   Max.   :0.027268   Max.   :0.3246  </code></pre>
</div>
<h2 id="división-centrado-y-estandarizado-de-datos">División, centrado y
estandarizado de datos</h2>
<p>Al tratarse de un modelo de aprendizaje automatizado es importante
que realicemos nuestra división entrenamiento/prueba para evaluar el
ajuste del modelo de clasificación:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>caTools</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/topepo/caret/'>caret</a></span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>1111</span><span class='op'>)</span>
<span class='va'>sample</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caTools/man/sample.split.html'>sample.split</a></span><span class='op'>(</span><span class='va'>x1n</span><span class='op'>$</span><span class='va'>especie</span>, SplitRatio <span class='op'>=</span> <span class='fl'>.75</span><span class='op'>)</span>
<span class='va'>train</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>x1n</span>, <span class='va'>sample</span> <span class='op'>==</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='va'>test</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>x1n</span>, <span class='va'>sample</span> <span class='op'>==</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</code></pre>
</div>
</div>
Centremos y estandaricemos los datos:
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>pre_pars</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/preProcess.html'>preProcess</a></span><span class='op'>(</span><span class='va'>train</span>, method <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"center"</span>, <span class='st'>"scale"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>train_t</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>pre_pars</span>, <span class='va'>train</span><span class='op'>)</span>
<span class='va'>test_t</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>pre_pars</span>, <span class='va'>test</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="análisis-de-funciones-discriminantes">Análisis de Funciones
Discriminantes</h2>
<p>El primer modelo con el que trabajaremos es el Análisis de Funciones
Discriminantes. En esta técnica se utilizan <strong>combinaciones
lineales</strong> de las variables originales para predecir la clase de
una instancia, de modo que se tratarán de encontrar nuevas variables que
<strong>maximicen</strong> la separación entre clases. Para que esta
técnica funcione adecuadamente es importante que las medias entre los
grupos sean diferentes (podemos aplicar un MANOVA/PERMANOVA previo) y
que las dispersiones multivariadas entre los grupos sean relativamente
constantes (homocedasticidad multivariada). A partir de lo anterior, es
fácil entender a este análisis como una mezcla entre el MANOVA y
ACP.</p>
<h3 id="ajuste-del-modelo">Ajuste del modelo</h3>
<p>Apliquemos el Análisis Discriminante Lineal. Las probabilidades
previas representan la proporción de cada grupo en la base de datos, las
medias de los grupos las medias de cada grupo para cada variable, los
coeficientes aprendidos por el modelo según los datos de entrenamiento y
la proporción de la traza es la proporción de la varianza explicada por
cada ecuación discriminante.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>lda_mod</span> <span class='op'>&lt;-</span> <span class='fu'>MASS</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/MASS/man/lda.html'>lda</a></span><span class='op'>(</span><span class='va'>especie</span><span class='op'>~</span><span class='va'>.</span>, data <span class='op'>=</span> <span class='va'>train_t</span><span class='op'>)</span>
<span class='va'>lda_mod</span>
</code></pre>
</div>
<pre><code>Call:
lda(especie ~ ., data = train_t)

Prior probabilities of groups:
consocium   jordani  labarcae 
0.3333333 0.2820513 0.3846154 

Group means:
               furcal       base       radio       alto      gordo      angos
consocium -0.27239867 -0.1611638  0.63378818 -0.2478593 -0.1101955 -0.3803264
jordani    0.36978089  0.3538899 -0.08733179  0.5618379 -0.2484665  0.7205529
labarcae  -0.03509381 -0.1198439 -0.48523978 -0.1972031  0.2777115 -0.1987893
                  ojo    X1erarc       dist.      largo      cabez       hueso
consocium  0.09264739  0.2144553  0.08430157  0.1499676  0.4599422  0.29791183
jordani   -0.13400176  1.1016534  0.41922847  0.7816530 -1.1268342 -0.27518895
labarcae   0.01797355 -0.9937404 -0.38049557 -0.7031841  0.4277285 -0.05638502
              mandib     hueso.1      arriba     cabeza        boca     abiert
consocium -0.1350847  0.57353663 -0.07769342  0.8313447 -0.07404553 -0.0995833
jordani   -1.1191233  0.04897799 -1.07793758 -0.4147328 -0.77198065 -0.6994560
labarcae   0.9377638 -0.53298228  0.85782185 -0.4163614  0.63029194  0.5992399
              cachete    largo.1      ancho    orificio      densi       hocic
consocium  0.14378260 -0.5532935 -0.2135984 -0.45224471  0.4142481 -0.06895108
jordani   -0.06177900  0.3066528  0.4361758  0.40599544  0.2418548 -0.83621678
labarcae  -0.07930699  0.2546422 -0.1347437  0.09421543 -0.5363752  0.67298324
             interbr     ojoatra       proye      base.1      altura       area
consocium -0.2677804 -0.02876978 -0.04894378 -0.26537856 -0.53739820 -0.3555283
jordani   -0.1140360 -0.04914858  0.16971481 -0.06077242  0.76287054 -0.3222543
labarcae   0.3157027  0.06097610 -0.08203958  0.27456120 -0.09369329  0.5444443
             Intesti
consocium -0.7077703
jordani    0.3010229
labarcae   0.3926508

Coefficients of linear discriminants:
                  LD1          LD2
furcal    0.028526771 -0.391614791
base     -0.209139809 -0.227408806
radio    -0.061305903  0.221130285
alto      0.168798201 -0.224047615
gordo     0.634093713  0.209065251
angos    -0.758743387 -0.139034212
ojo       0.123364337 -0.007622951
X1erarc  -1.997627631 -0.235408480
dist.    -0.053552688 -0.147007173
largo    -0.046825454  0.389589901
cabez     0.203836005  0.646888740
hueso    -0.033319442  0.029258810
mandib    0.918796636 -0.408134075
hueso.1  -0.449510944  0.627524539
arriba    1.125104935 -0.007142905
cabeza   -0.493254681  0.948682851
boca     -0.163258105  0.388505301
abiert    0.011259084 -0.373641604
cachete   0.234498784  0.639571836
largo.1  -0.637704833 -0.263752163
ancho    -0.125785157  0.036733196
orificio  0.008486124 -0.513403328
densi    -0.364318989  0.048784740
hocic    -0.337415062  0.182388583
interbr   0.532901007 -0.005325388
ojoatra  -0.067049359 -0.338594926
proye    -0.343082471 -0.025104445
base.1    0.190284049  0.262195074
altura   -0.094050504 -0.223923073
area     -0.134056419 -0.247898344
Intesti   0.243726491 -0.309536900

Proportion of trace:
   LD1    LD2 
0.8141 0.1859 </code></pre>
</div>
<h3 id="importancia-de-variables">Importancia de variables</h3>
<p>Calculemos la correlación entre las variables originales y las dos
funciones discriminantes</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>adj_vals</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>lda_mod</span>, <span class='va'>train_t</span><span class='op'>)</span><span class='op'>$</span><span class='va'>x</span><span class='op'>)</span>
<span class='va'>adj_vals</span><span class='op'>[</span><span class='st'>"especie"</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>train_t</span><span class='op'>[</span><span class='st'>"especie"</span><span class='op'>]</span>
<span class='va'>corr</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>cor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='va'>train_t</span><span class='op'>[</span>,<span class='fl'>2</span><span class='op'>:</span><span class='fl'>32</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>, 
                   <span class='va'>adj_vals</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span>
<span class='va'>corr</span>
</code></pre>
</div>
<pre><code>                 LD1           LD2
furcal   -0.13141273 -0.2457755403
base     -0.17400395 -0.1640832259
radio    -0.24496179  0.4650184432
alto     -0.28012983 -0.2547783331
gordo     0.23041878 -0.0444178857
angos    -0.32899744 -0.3713816134
ojo       0.05056099  0.0847301419
X1erarc  -0.88877042  0.0010272598
dist.    -0.33952156  0.0023146043
largo    -0.62954328 -0.0008393222
cabez     0.57984949  0.4844248183
hueso     0.05165890  0.2509373702
mandib    0.86274763  0.0581108077
hueso.1  -0.31286833  0.4031217248
arriba    0.80559067  0.0934352143
cabeza   -0.10746724  0.6514499754
boca      0.58585544  0.0537619900
abiert    0.54656544  0.0254886911
cachete  -0.02567501  0.1112945128
largo.1   0.04970162 -0.4377992219
ancho    -0.20721195 -0.2129277982
orificio -0.07004645 -0.3793107927
densi    -0.37307363  0.2626291405
hocic     0.62914887  0.0662796506
interbr   0.21102558 -0.1756162121
ojoatra   0.04895785 -0.0137690705
proye    -0.09718520 -0.0584316340
base.1    0.17191592 -0.1812602117
altura   -0.28301703 -0.4894841705
area      0.40189142 -0.2095533890
Intesti   0.12858271 -0.5474213085</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>corrplot</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/corrplot/man/corrplot.html'>corrplot</a></span><span class='op'>(</span><span class='va'>corr</span>, is.corr <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="c14_clasificacion_files/figure-html5/unnamed-chunk-7-1.png" width="624" /></p>
</div>
<p>Creemos un gráfico de densidad bivariado para conocer la distribución
de los grupos en el nuevo espacio:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>territ_plot</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>adj_vals</span>,
                      <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>LD1</span>, y <span class='op'>=</span> <span class='va'>LD2</span>, colour <span class='op'>=</span> <span class='va'>especie</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
               <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_density_2d.html'>geom_density_2d</a></span><span class='op'>(</span>show.legend <span class='op'>=</span> <span class='cn'>T</span>, alpha <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span> <span class='op'>+</span>
               <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
               <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>territ_plot</span>
</code></pre>
</div>
<p><img src="c14_clasificacion_files/figure-html5/unnamed-chunk-8-1.png" width="624" /></p>
</div>
<h3 id="diagnóstico-del-modelo-de-funciones-discriminantes">Diagnóstico
del modelo de funciones discriminantes:</h3>
<h4 id="probabilidades-de-pertenencia">Probabilidades de
pertenencia</h4>
<p>Probabilidad de pertenencia de cada individuo a partir de los datos
de prueba:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>p</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>lda_mod</span>, <span class='va'>test_t</span><span class='op'>)</span><span class='op'>$</span><span class='va'>posterior</span>
<span class='va'>p.acom</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>especie <span class='op'>=</span> <span class='va'>test_t</span><span class='op'>$</span><span class='va'>especie</span>, id <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>test_t</span><span class='op'>)</span>, p <span class='op'>=</span> <span class='va'>p</span><span class='op'>)</span>
<span class='va'>p.acom</span>
</code></pre>
</div>
<pre><code>      especie  id  p.consocium    p.jordani   p.labarcae
3     jordani   3 1.576647e-05 9.999842e-01 1.938031e-17
6     jordani   6 1.050268e-04 9.998950e-01 1.299891e-22
7     jordani   7 6.766174e-01 3.205883e-01 2.794340e-03
15    jordani  15 1.525816e-05 9.999847e-01 4.904069e-19
17    jordani  17 1.073441e-05 9.999893e-01 5.255517e-22
19    jordani  19 2.544053e-08 1.000000e+00 9.148421e-14
24    jordani  24 2.620872e-04 9.997379e-01 1.073915e-17
32   labarcae  32 4.402102e-12 3.745222e-26 1.000000e+00
41   labarcae  41 1.234120e-15 4.780119e-29 1.000000e+00
46   labarcae  46 2.105752e-10 2.382699e-22 1.000000e+00
48   labarcae  48 1.982179e-13 1.791345e-33 1.000000e+00
49   labarcae  49 3.036055e-18 1.439861e-32 1.000000e+00
55   labarcae  55 4.916184e-07 1.176208e-14 9.999995e-01
57   labarcae  57 3.860063e-12 1.941377e-22 1.000000e+00
59   labarcae  59 1.502760e-16 2.095582e-33 1.000000e+00
61   labarcae  61 1.071438e-02 1.384241e-10 9.892856e-01
63   labarcae  63 9.007014e-19 1.617244e-38 1.000000e+00
70  consocium  70 1.123931e-15 7.836223e-32 1.000000e+00
74  consocium  74 9.999669e-01 3.306267e-05 7.004830e-14
77  consocium  77 5.028596e-02 9.497140e-01 5.289779e-27
80  consocium  80 1.000000e+00 2.253411e-14 4.793196e-13
85  consocium  85 1.000000e+00 3.011736e-11 9.417053e-10
86  consocium  86 1.698278e-07 9.999998e-01 1.717979e-20
97  consocium  97 1.000000e+00 1.538708e-12 9.626341e-13
98  consocium  98 1.000000e+00 2.712993e-12 6.977327e-14
100 consocium 100 1.000000e+00 5.416680e-14 4.344065e-13</code></pre>
</div>
<h4 id="matriz-de-confusión">Matriz de confusión</h4>
<p>Recordemos que la matriz de confusión es una tabla de contingencia
que permite obtener métricas relacionadas con proporciones de
predicciones correctas. La función <code>confusionMatrix</code> de la
librería <code>caret</code> da, además de las vistas en la presentación,
algunas otras que pueden ser interesantes, pues minimizan el efecto de
la Tasa de No Información (NIR):</p>
<ul>
<li>p-value [Acc&gt;NIR]: es el valor de p de una prueba binomial de una
cola para probar que la exactitud observada es mayor que la tasa de no
información; es decir, que no estamos tratando con un modelo bobo.</li>
<li>Kappa: Este es el valor del estadístico Kappa de Cohen, que es una
medida de el porcentaje de las predicciones del modelo que no pueden ser
explicadas adivinando al azar.</li>
<li>McNemar’s test p-value: Es una prueba <span
class="math inline">\(\chi^2\)</span> para la simetría de los renglones
y columnas de una tabla de contingencia, de modo que la hipótesis de
nulidad es que las probabilidades de ser clasificado en las celdas [i,j]
y [j, i] son las mismas; es decir, que lo que está debajo de la diagonal
sea igual a lo que está encima de la diagonal.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>pred.clase</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>lda_mod</span>, <span class='va'>test_t</span><span class='op'>)</span><span class='op'>$</span><span class='va'>class</span>
<span class='fu'><a href='https://rdrr.io/pkg/caret/man/confusionMatrix.html'>confusionMatrix</a></span><span class='op'>(</span><span class='va'>pred.clase</span>, <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>test_t</span><span class='op'>$</span><span class='va'>especie</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Confusion Matrix and Statistics

           Reference
Prediction  consocium jordani labarcae
  consocium         6       1        0
  jordani           2       6        0
  labarcae          1       0       10

Overall Statistics
                                          
               Accuracy : 0.8462          
                 95% CI : (0.6513, 0.9564)
    No Information Rate : 0.3846          
    P-Value [Acc &gt; NIR] : 1.779e-06       
                                          
                  Kappa : 0.7673          
                                          
 Mcnemar&#39;s Test P-Value : NA              

Statistics by Class:

                     Class: consocium Class: jordani Class: labarcae
Sensitivity                    0.6667         0.8571          1.0000
Specificity                    0.9412         0.8947          0.9375
Pos Pred Value                 0.8571         0.7500          0.9091
Neg Pred Value                 0.8421         0.9444          1.0000
Prevalence                     0.3462         0.2692          0.3846
Detection Rate                 0.2308         0.2308          0.3846
Detection Prevalence           0.2692         0.3077          0.4231
Balanced Accuracy              0.8039         0.8759          0.9688</code></pre>
</div>
<p>Es importante mencionar que, por lo general, el valor AUC de la curva
ROC es una medida más robusta que estas; sin embargo, habrá veces en las
que nos interese que los positivos predichos sean realmente positivos,
aunque tengamos falsos negativos, por ejemplo. Pensemos que nos interesa
asegurarnos que los individuos clasificados como consocium realmente
sean consocium. ¿Qué medida utilizarías para saber en qué proporción se
da ese caso? Pista: no es ni la exactitud ni el AUC. Regresa a la
presentación si es necesario.</p>
<h5 id="márgenes-de-decisión">Márgenes de decisión</h5>
<p>Nos interesaremos en los márgenes de decisión de un clasificador
cuando nos interesa saber cómo es que nuestro modelo está haciendo las
decisiones. En este caso, mostraremos la probabilidad de pertenencia a
cada clase (obtenida desde los datos de entrenamiento) como fondo de un
gráfico en donde los ejes x y y serán las ecuaciones discriminantes, y
le sobrepondremos los datos de prueba. Para poder hacer esto habrá que
“simular” datos para nuestro fondo y formar una malla con todos ellos.
Desafortunadamente, crear la malla requiere que hagamos cierta trampa.
Primero, ajustaremos un modelo LDA para predecir los valores de LD1 y
LD2 de cada especie:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"> <span class='co'># Ajustamos un LDA para "predecir" los valores de las nuevas dimensiones</span>
<span class='va'>prob_lda</span> <span class='op'>&lt;-</span> <span class='fu'>MASS</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/MASS/man/lda.html'>lda</a></span><span class='op'>(</span><span class='va'>especie</span> <span class='op'>~</span> <span class='va'>.</span>, data <span class='op'>=</span> <span class='va'>adj_vals</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Generamos una función que nos permita generar una malla utilizando
esos nuevos valores y que, multiplique los valores de LDA con signo
negativo por -1 para evitar una rotación de los datos:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>adjust_probs_sp</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>mesh</span>, <span class='va'>probs</span><span class='op'>)</span><span class='op'>{</span>
  <span class='co'># Obtener la mayor probabilidad</span>
  <span class='va'>mesh</span><span class='op'>[</span><span class='st'>"adj_probs"</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span><span class='op'>(</span><span class='va'>probs</span>, 
                           <span class='fl'>1</span>,
                           FUN <span class='op'>=</span> <span class='va'>max</span>
                           <span class='op'>)</span>
  <span class='co'># Obtener la especie a la que le corresponde</span>
  <span class='va'>mesh</span><span class='op'>[</span><span class='st'>"adj_esp"</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span><span class='op'>(</span><span class='va'>probs</span>,
                           <span class='fl'>1</span>,
                           FUN <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>{</span>
                                 <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.max</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
                                 <span class='op'>}</span>
                           <span class='op'>)</span>
  <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>mesh</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>dec_bounds</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>model</span>, <span class='va'>adj_vals</span><span class='op'>)</span><span class='op'>{</span>
  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://scales.r-lib.org'>scales</a></span><span class='op'>)</span>
  <span class='co'># Calculamos los límites expandidos de LD1 y LD2</span>
  <span class='va'>ld1lim</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://scales.r-lib.org/reference/expand_range.html'>expand_range</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>adj_vals</span><span class='op'>$</span><span class='va'>LD1</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>adj_vals</span><span class='op'>$</span><span class='va'>LD1</span><span class='op'>)</span><span class='op'>)</span>, 
                                 mul<span class='op'>=</span><span class='fl'>0.1</span><span class='op'>)</span> <span class='co'># + 10% hacia "abajo"</span>
  <span class='va'>ld2lim</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://scales.r-lib.org/reference/expand_range.html'>expand_range</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>adj_vals</span><span class='op'>$</span><span class='va'>LD2</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>adj_vals</span><span class='op'>$</span><span class='va'>LD2</span><span class='op'>)</span><span class='op'>)</span>, 
                                 mul<span class='op'>=</span><span class='fl'>0.1</span><span class='op'>)</span> <span class='co'># + 10% hacia "arriba"</span>
  
  <span class='co'># Generamos 300 valores nuevos de LD1 y LD2 en esos límites:</span>
  <span class='va'>ld1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='va'>ld1lim</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>, <span class='va'>ld1lim</span><span class='op'>[[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>]</span>, 
             length.out<span class='op'>=</span><span class='fl'>300</span><span class='op'>)</span>
  <span class='va'>ld2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='va'>ld2lim</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>, <span class='va'>ld1lim</span><span class='op'>[[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>]</span>,
             length.out<span class='op'>=</span><span class='fl'>300</span><span class='op'>)</span>
  
  <span class='co'># Generamos un objeto con todas las combinaciones de nuevos valores</span>
  <span class='va'>newdat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/expand.grid.html'>expand.grid</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>LD1 <span class='op'>=</span> <span class='va'>ld1</span>,
                             LD2 <span class='op'>=</span> <span class='va'>ld2</span><span class='op'>)</span><span class='op'>)</span>
  
  <span class='co'># Realizamos predicciones a partir de estos valores</span>
  <span class='va'>preds</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>prob_lda</span>, newdata <span class='op'>=</span> <span class='va'>newdat</span><span class='op'>)</span>
  
  <span class='co'># Generamos un objeto que contendrá la "malla" con los valores de</span>
  <span class='co'># LD1, LD2, adj_probs y adj_esp</span>
  <span class='va'>mesh</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='va'>preds</span><span class='op'>$</span><span class='va'>x</span><span class='op'>)</span>
  
  <span class='co'># Probabilidad de pertenencia de los valores simulados:</span>
  <span class='va'>prob_sim</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='va'>preds</span><span class='op'>$</span><span class='va'>posterior</span><span class='op'>)</span>
  
  <span class='co'># Probabilidades "ajustadas" para cada punto en la malla:</span>
  
  <span class='va'>mesh</span> <span class='op'>&lt;-</span> <span class='fu'>adjust_probs_sp</span><span class='op'>(</span><span class='va'>mesh</span>, <span class='va'>prob_sim</span><span class='op'>)</span>
  
  <span class='co'># Corregimos los valores del eje negativo</span>
  <span class='va'>axes</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span><span class='op'>(</span><span class='va'>model</span><span class='op'>$</span><span class='va'>scaling</span><span class='op'>)</span>
  <span class='va'>axis</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>axes</span><span class='op'>[</span><span class='va'>axes</span> <span class='op'>&lt;</span> <span class='fl'>0</span><span class='op'>]</span><span class='op'>)</span>
  <span class='va'>mesh</span><span class='op'>[</span>,<span class='va'>axis</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='op'>-</span><span class='va'>mesh</span><span class='op'>[</span>,<span class='va'>axis</span><span class='op'>]</span>
  
  <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>mesh</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>Ahora formamos el gráfico</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Generamos la malla</span>
<span class='va'>mesh</span> <span class='op'>&lt;-</span> <span class='fu'>dec_bounds</span><span class='op'>(</span><span class='va'>prob_lda</span>, <span class='va'>adj_vals</span><span class='op'>)</span>

<span class='co'># Graficamos las probabilidades de decisión</span>
<span class='va'>dec.probs</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>mesh</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>LD1</span>, y <span class='op'>=</span> <span class='va'>LD2</span>, color <span class='op'>=</span> <span class='va'>adj_esp</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
             <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_tile.html'>geom_raster</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>adj_esp</span><span class='op'>)</span>, alpha <span class='op'>=</span> <span class='va'>mesh</span><span class='op'>$</span><span class='va'>adj_probs</span><span class='op'>*</span><span class='fl'>0.3</span>, show.legend <span class='op'>=</span> <span class='cn'>F</span><span class='op'>)</span> <span class='op'>+</span> 
             <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_minimal</a></span><span class='op'>(</span><span class='op'>)</span>

<span class='co'># Añadimos los datos de prueba al gráfico</span>
<span class='co'># Valores de LDA para los datos de prueba;</span>
<span class='co'># i.e., utilizar los parámetros del modelo:</span>
<span class='va'>mesh_test</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>lda_mod</span>, <span class='va'>test_t</span><span class='op'>)</span><span class='op'>$</span><span class='va'>x</span><span class='op'>)</span> 

<span class='co'># Obtener las probabilidades y especies predichas</span>
<span class='va'>mesh_test</span> <span class='op'>&lt;-</span> <span class='fu'>adjust_probs_sp</span><span class='op'>(</span><span class='va'>mesh_test</span>,
                             <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>lda_mod</span>, <span class='va'>test_t</span><span class='op'>)</span><span class='op'>$</span><span class='va'>posterior</span><span class='op'>)</span> 

<span class='co'># Etiqueta para saber si la instancia está correctamente clasificada</span>
<span class='va'>mesh_test</span><span class='op'>[</span><span class='st'>"mark"</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>test_t</span><span class='op'>$</span><span class='va'>especie</span> <span class='op'>==</span> <span class='va'>mesh_test</span><span class='op'>$</span><span class='va'>adj_esp</span>,
                            <span class='va'>test_t</span><span class='op'>$</span><span class='va'>especie</span>,
                            <span class='st'>"Mal clasificado"</span><span class='op'>)</span>

<span class='co'># Añadimos los puntos de prueba,</span>
<span class='co'># cambiando el marcador según la clase predicha por el modelo,</span>
<span class='co'># y el color según la clase observada:</span>
<span class='va'>clas.plot</span> <span class='op'>&lt;-</span> <span class='va'>dec.probs</span> <span class='op'>+</span> 
             <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>mesh_test</span>,
                        <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>LD1</span>, y <span class='op'>=</span> <span class='va'>LD2</span>, shape <span class='op'>=</span> <span class='va'>mark</span>,
                            color <span class='op'>=</span> <span class='va'>test</span><span class='op'>$</span><span class='va'>especie</span><span class='op'>)</span>,
                        size <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span> 
             <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_shape.html'>scale_shape_discrete</a></span><span class='op'>(</span>name <span class='op'>=</span> <span class='st'>"Clasificación"</span><span class='op'>)</span> <span class='op'>+</span>
             <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_hue.html'>scale_color_discrete</a></span><span class='op'>(</span>name <span class='op'>=</span> <span class='st'>"Clases"</span><span class='op'>)</span> <span class='op'>+</span>
             <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_alpha.html'>scale_alpha_continuous</a></span><span class='op'>(</span>name <span class='op'>=</span> <span class='st'>"P(decisión)"</span><span class='op'>)</span> <span class='op'>+</span>
             <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Límites de decisión del LDA"</span>,
                  subtitle <span class='op'>=</span> <span class='st'>"Primeras dos funciones discriminantes"</span>,
                  x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,
                  y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># Imprimimos el gráfico</span>
<span class='va'>clas.plot</span>
</code></pre>
</div>
<p><img src="c14_clasificacion_files/figure-html5/unnamed-chunk-13-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mesh_test</span><span class='op'>[</span><span class='va'>mesh_test</span><span class='op'>$</span><span class='va'>mark</span> <span class='op'>==</span> <span class='st'>"Mal clasificado"</span>,<span class='op'>]</span>
</code></pre>
</div>
<pre><code>          LD1        LD2 adj_probs   adj_esp            mark
7  -0.7471448 -1.6503592 0.6766174 consocium Mal clasificado
70  6.8164930 -0.6894308 1.0000000  labarcae Mal clasificado
77 -6.7280520  3.0847575 0.9497140   jordani Mal clasificado
86 -4.8481683 -1.4215721 0.9999998   jordani Mal clasificado</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>x1n</span><span class='op'>[</span><span class='fl'>7</span>,<span class='op'>]</span>
</code></pre>
</div>
<pre><code>  especie   furcal       base      radio       alto      gordo      angos
7 jordani 0.281895 0.09631057 0.06971912 0.07162811 0.04002912 0.03453165
         ojo    X1erarc     dist.     largo      cabez      hueso     mandib
7 0.02756048 0.04568261 0.0366289 0.0366289 0.08476112 0.03314634 0.03591256
     hueso.1     arriba    cabeza       boca     abiert    cachete    largo.1
7 0.04610479 0.02544712 0.0939045 0.03797572 0.02756048 0.03866126 0.01472326
      ancho  orificio   densi      hocic    interbr    ojoatra      proye
7 0.0366289 0.0523091 0.90309 0.02403248 0.01760895 0.04071144 0.01181827
     base.1     altura       area   Intesti
7 0.0197607 0.05842602 0.01042717 0.2447462</code></pre>
</div>
<h4 id="curva-roc-y-valor-auc">Curva ROC y valor AUC</h4>
<p>Primero obtengamos la curva ROC y el valor de AUC multi-clase.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://expasy.org/tools/pROC/'>pROC</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>gridExtra</span><span class='op'>)</span>

<span class='va'>test_sp_num</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>test_t</span><span class='op'>$</span><span class='va'>especie</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>pred_clase_num</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>pred.clase</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>roc_cons</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/pROC/man/multiclass.html'>multiclass.roc</a></span><span class='op'>(</span><span class='va'>test_sp_num</span>, <span class='va'>pred_clase_num</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Ahora creemos una función personalizada para utilizar un ciclo for
para graficar las curvas ROC:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>plot_rocs</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>classes</span>, <span class='va'>multi_roc</span>, <span class='va'>colors</span>, <span class='va'>theme</span>, <span class='va'>test_t</span><span class='op'>)</span><span class='op'>{</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme_get.html'>theme_set</a></span><span class='op'>(</span><span class='va'>theme</span><span class='op'>)</span>
  
  <span class='co'># Lista vacía para llenar con las gráficas</span>
  <span class='va'>rocs_plots</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>
  
  <span class='co'># Valores a ciclar (clases)</span>
  <span class='va'>counter</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_along</a></span><span class='op'>(</span><span class='va'>classes</span><span class='op'>)</span> 

  <span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='va'>counter</span><span class='op'>)</span> <span class='op'>{</span> <span class='co'># para cada i en clases</span>
    <span class='kw'>if</span> <span class='op'>(</span><span class='va'>i</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>{</span> <span class='co'># Si i == 1</span>
      <span class='co'># curva ROC para la primera clase</span>
      <span class='va'>rocs_plots</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/pROC/man/ggroc.html'>ggroc</a></span><span class='op'>(</span><span class='va'>multi_roc</span><span class='op'>$</span><span class='va'>rocs</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span>,
                               color <span class='op'>=</span> <span class='va'>colors</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span>, size <span class='op'>=</span> <span class='fl'>1</span>,
                               legacy.axes <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span> <span class='op'>+</span>
                         <span class='co'># Establecemos el título global de la gráfica</span>
                         <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span>
                                <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='st'>"AUC multi-clase = "</span>,
                                      <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>roc_cons</span><span class='op'>$</span><span class='va'>auc</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>,<span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>,
                              <span class='co'># clase como subtítulo</span>
                              subtitle <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sprintf.html'>sprintf</a></span><span class='op'>(</span><span class='st'>"%s"</span>,
                                                 <span class='va'>classes</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>)</span>,
                              <span class='co'># Sin nombre del eje x</span>
                              x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>, 
                              y <span class='op'>=</span> <span class='st'>"TVP (Sensibilidad)"</span><span class='op'>)</span> <span class='op'>+</span>
                         <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_abline</a></span><span class='op'>(</span>intercept <span class='op'>=</span> <span class='fl'>0</span>, slope <span class='op'>=</span> <span class='fl'>1</span>,
                                     color <span class='op'>=</span> <span class='st'>"gray50"</span>, size <span class='op'>=</span> <span class='fl'>1</span>,
                                     <span class='co'># Línea de referencia (Azar)</span>
                                     linetype <span class='op'>=</span> <span class='st'>"dashed"</span><span class='op'>)</span>
    <span class='op'>}</span> <span class='co'># curva ROC para clase intermedias</span>
    <span class='kw'>if</span> <span class='op'>(</span><span class='va'>i</span> <span class='op'>&lt;</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>counter</span><span class='op'>)</span> <span class='op'>&amp;</span> <span class='va'>i</span> <span class='op'>&gt;</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>{</span>
      <span class='va'>rocs_plots</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/pROC/man/ggroc.html'>ggroc</a></span><span class='op'>(</span><span class='va'>roc_cons</span><span class='op'>$</span><span class='va'>rocs</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span>,
                               color <span class='op'>=</span> <span class='va'>colors</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span>, size <span class='op'>=</span> <span class='fl'>1</span>,
                               legacy.axes <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span> <span class='op'>+</span>
                         <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>subtitle <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sprintf.html'>sprintf</a></span><span class='op'>(</span><span class='st'>"%s"</span>,
                                                 <span class='va'>classes</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>)</span>,
                              x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,
                              y <span class='op'>=</span> <span class='st'>"TVP (Sensibilidad)"</span><span class='op'>)</span> <span class='op'>+</span>
                         <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_abline</a></span><span class='op'>(</span>intercept <span class='op'>=</span> <span class='fl'>0</span>, slope <span class='op'>=</span> <span class='fl'>1</span>,
                                     color <span class='op'>=</span> <span class='st'>"gray50"</span>, size <span class='op'>=</span> <span class='fl'>1</span>, 
                                     linetype <span class='op'>=</span> <span class='st'>"dashed"</span><span class='op'>)</span>
    <span class='op'>}</span> <span class='co'># curva ROC para la última clase</span>
    <span class='kw'>if</span> <span class='op'>(</span><span class='va'>i</span> <span class='op'>==</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>counter</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
      <span class='va'>rocs_plots</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/pROC/man/ggroc.html'>ggroc</a></span><span class='op'>(</span><span class='va'>roc_cons</span><span class='op'>$</span><span class='va'>rocs</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span>, color <span class='op'>=</span> <span class='va'>colors</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span>, 
                               size <span class='op'>=</span> <span class='fl'>1</span>, legacy.axes <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span> <span class='op'>+</span>
                         <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>subtitle <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sprintf.html'>sprintf</a></span><span class='op'>(</span><span class='st'>"%s"</span>,
                                                 <span class='va'>classes</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>)</span>,
                              <span class='co'># Se agrega el nombre del eje x para todas las</span>
                              <span class='co'># gráficas (ojo a que es una sola columna)</span>
                              x <span class='op'>=</span> <span class='st'>"TFP (1 - especificidad)"</span>, 
                              y <span class='op'>=</span> <span class='st'>"TVP (Sensibilidad)"</span><span class='op'>)</span> <span class='op'>+</span>
                         <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_abline</a></span><span class='op'>(</span>intercept <span class='op'>=</span> <span class='fl'>0</span>, slope <span class='op'>=</span> <span class='fl'>1</span>,
                                     color <span class='op'>=</span> <span class='st'>"gray50"</span>, size <span class='op'>=</span> <span class='fl'>1</span>,
                                     linetype <span class='op'>=</span> <span class='st'>"dashed"</span><span class='op'>)</span>
    <span class='op'>}</span>
    <span class='op'>}</span>
  <span class='fu'><a href='https://rdrr.io/r/base/do.call.html'>do.call</a></span><span class='op'>(</span><span class='st'>'grid.arrange'</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>rocs_plots</span>, ncol <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>Ahora grafiquémoslas:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Colores de las especies:</span>
<span class='va'>colors</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"brown3"</span>, <span class='st'>"chartreuse4"</span>, <span class='st'>"deepskyblue4"</span><span class='op'>)</span>
<span class='co'>#cairo_pdf("ROC_LDA.pdf", height = 12.9, width = 7 )</span>
<span class='fu'>plot_rocs</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sort.html'>sort</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='va'>test_t</span><span class='op'>$</span><span class='va'>especie</span><span class='op'>)</span><span class='op'>)</span>,
          <span class='va'>roc_cons</span>, <span class='va'>colors</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='va'>test_t</span><span class='op'>)</span>
</code></pre>
</div>
<img src="c14_clasificacion_files/figure-html5/unnamed-chunk-18-1.png" width="288" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#dev.off()</span>
</code></pre>
</div>
</div>
<h2 id="regresión-logística">Regresión logística</h2>
<p>Otra técnica que podemos utilizar es la regresión logística. Es
importante recordar que este modelo de clasificación fue desarrollado
originalmente para clasificaciones binarias, aunque ya ha sido extendido
a clasificaciones multinomiales. Esta técnica la veremos a detalle en la
sesión de GLMs, aunque es importante mencionar que todas las formas de
evaluación (entrenamiento-prueba, matriz de confusión, ROC-AUC) siguen
aplicando. Para fines ilustrativos, realicemos el ajuste de un modelo
multinomial; i.e., más de dos clases:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>iris_dat</span> <span class='op'>&lt;-</span> <span class='va'>iris</span>
<span class='va'>samples</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caTools/man/sample.split.html'>sample.split</a></span><span class='op'>(</span><span class='va'>iris_dat</span><span class='op'>$</span><span class='va'>Species</span>, SplitRatio <span class='op'>=</span> <span class='fl'>.75</span><span class='op'>)</span>
<span class='va'>train2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>iris_dat</span>, <span class='va'>samples</span> <span class='op'>==</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='va'>test2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>iris_dat</span>, <span class='va'>samples</span> <span class='op'>==</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Centremos y estandaricemos:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>pre_pars</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/preProcess.html'>preProcess</a></span><span class='op'>(</span><span class='va'>train2</span>, method <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"center"</span>, <span class='st'>"scale"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>train_t2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>pre_pars</span>, <span class='va'>train2</span><span class='op'>)</span>
<span class='va'>test_t2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>pre_pars</span>, <span class='va'>test2</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h4 id="ajuste-del-modelo-1">Ajuste del modelo</h4>
<p>A diferencia del caso anterior, vamos a implementar el modelo
utilizando la librería caret (Classification and Regression Training).
Esta librería nos permite homogeneizar el proceso de declaración de
modelos de aprendizaje supervizado, y nos evita estar batallando con las
librerías independientes. Veámoslo en acción:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>logit_mult</span> <span class='op'>&lt;-</span> <span class='fu'>caret</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/caret/man/train.html'>train</a></span><span class='op'>(</span>form <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>Species</span><span class='op'>)</span><span class='op'>~</span><span class='va'>.</span>,
                          data <span class='op'>=</span> <span class='va'>train_t2</span>,
                          method <span class='op'>=</span> <span class='st'>"multinom"</span>,
                          trace <span class='op'>=</span> <span class='cn'>F</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>test_preds</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>logit_mult</span>, <span class='va'>test_t2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/caret/man/confusionMatrix.html'>confusionMatrix</a></span><span class='op'>(</span><span class='va'>test_preds</span>, <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>test_t2</span><span class='op'>$</span><span class='va'>Species</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Confusion Matrix and Statistics

            Reference
Prediction   setosa versicolor virginica
  setosa         12          0         0
  versicolor      0         10         1
  virginica       0          2        11

Overall Statistics
                                          
               Accuracy : 0.9167          
                 95% CI : (0.7753, 0.9825)
    No Information Rate : 0.3333          
    P-Value [Acc &gt; NIR] : 3.978e-13       
                                          
                  Kappa : 0.875           
                                          
 Mcnemar&#39;s Test P-Value : NA              

Statistics by Class:

                     Class: setosa Class: versicolor Class: virginica
Sensitivity                 1.0000            0.8333           0.9167
Specificity                 1.0000            0.9583           0.9167
Pos Pred Value              1.0000            0.9091           0.8462
Neg Pred Value              1.0000            0.9200           0.9565
Prevalence                  0.3333            0.3333           0.3333
Detection Rate              0.3333            0.2778           0.3056
Detection Prevalence        0.3333            0.3056           0.3611
Balanced Accuracy           1.0000            0.8958           0.9167</code></pre>
</div>
<p>Y la importancia de variables:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/caret/man/varImp.html'>varImp</a></span><span class='op'>(</span><span class='va'>logit_mult</span>, scale <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>multinom variable importance

             Overall
Petal.Length   100.0
Petal.Width     84.3
Sepal.Length    14.4
Sepal.Width      0.0</code></pre>
</div>
<h2 id="ejercicio">Ejercicio</h2>
<p>Realizar una regresión logística multinomial con los datos de
morfometría de peces (<code>Medidas.txt</code>). Responde lo siguiente:
1. ¿El modelo se encuentra sobre ajustado? ¿Por qué? 2. Obtén las curvas
ROC y el valor de AUC multi-clase. ¿que tan bueno consideras al modelo?
3. ¿Cuáles fueron las variables más importantes para la clasificación?
Compara con los resultados del ACP de la clase de reducción de
dimensionalidad y los del LDA.</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<div class="distill-site-nav distill-site-footer">
<p>© Copyright 2021 <a href="https://www.drplancton.com">Dr.
Plancton</a>.</p>
<p>Software licensed under the <a
href="https://www.apache.org/licenses/LICENSE-2.0">Apache License,
v2.0</a>.</p>
</div>
<!--/radix_placeholder_navigation_after_body-->


</body>

</html>
