<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="M. en C. Arturo Bell Enríquez García" />


<title>Agrupamientos y Reducción de la Dimensionalidad</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
#rmd-source-code {
  display: none;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Bioestadística con R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Temas
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Biología como Ciencia de Datos</a>
      <ul class="dropdown-menu" role="menu">
        <li>
          <a href="c1_Intro_R.html">Introducción a R</a>
        </li>
        <li>
          <a href="c2_ggplot2.html">ggplot2</a>
        </li>
      </ul>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Herramientas Básicas</a>
      <ul class="dropdown-menu" role="menu">
        <li>
          <a href="c3_probabilidad.html">Probabilidad</a>
        </li>
        <li>
          <a href="c4_muestreo.html">Teoría del Muestreo</a>
        </li>
        <li>
          <a href="c5_descriptiva.html">Estadística Descriptiva</a>
        </li>
        <li>
          <a href="c6_ph0.html">Pruebas de hipótesis</a>
        </li>
        <li>
          <a href="c7_param.html">Técnicas Paramétricas</a>
        </li>
      </ul>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Relaciones Lineales</a>
      <ul class="dropdown-menu" role="menu">
        <li>
          <a href="c8_rls.html">Modelo Lineal Simple</a>
        </li>
        <li>
          <a href="c9_glm.html">Modelos Lineales Generalizados</a>
        </li>
      </ul>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">No Paramétrico y No Lineal</a>
      <ul class="dropdown-menu" role="menu">
        <li>
          <a href="c10_no_par.html">Técnicas No Paramétricas</a>
        </li>
        <li>
          <a href="c11_no_lineal.html">Modelos No Lineales</a>
        </li>
      </ul>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Técnicas Multivariadas</a>
      <ul class="dropdown-menu" role="menu">
        <li>
          <a href="c11_intro_mv.html">Introducción</a>
        </li>
        <li>
          <a href="c12_no_sup.html">No supervisadas</a>
        </li>
        <li>
          <a href="c13_comps_mv.html">Comparaciones Multivariadas</a>
        </li>
        <li>
          <a href="c14_clasificacion.html">Clasificaciones</a>
        </li>
        <li>
          <a href="c15_regs_mv.html">Regresiones Múltiples</a>
        </li>
      </ul>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Agrupamientos y Reducción de la Dimensionalidad</h1>
<h4 class="author">M. en C. Arturo Bell Enríquez García</h4>

</div>


<p><strong><a href="https://youtu.be/rJ2_STjvqx8">VIDEO</a></strong></p>
<div id="funciones-personalizadas" class="section level2">
<h2>Funciones personalizadas:</h2>
<pre class="r"><code># Tema personalizado
blank_theme &lt;- function(aspect.ratio = 1/1.61){
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        panel.background = element_blank(),
        axis.line = element_blank(),
        aspect.ratio = aspect.ratio,
        axis.ticks = element_blank(),
        text = element_text(colour = &quot;gray50&quot;), # Eliminar
        legend.position = &quot;none&quot;
        )
}
# Función para la estimación de los CP óptimos:

evplot &lt;- function(ev){
    
    # Broken stick model (MacArthur 1957)
      n &lt;- length(ev)
      bsm &lt;- data.frame(j=seq(1:n), p=0)
      bsm$p[1] &lt;- 1/n 
      for (i in 2:n) bsm$p[i] &lt;- bsm$p[i-1] + (1/(n + 1 - i))
      bsm$p &lt;- 100*bsm$p/n
    # Plot eigenvalues and % of variation for each axis
      op &lt;- par(mfrow=c(2,1))
      barplot(ev, main=&quot;Eigenvalues&quot;, col=&quot;bisque&quot;, las=2)
        abline(h=mean(ev), col=&quot;red&quot;)
        legend(&quot;topright&quot;, &quot;Average eigenvalue&quot;, lwd=1, col=2, bty=&quot;n&quot;)
      barplot(t(cbind(100*ev/sum(ev), bsm$p[n:1])), beside=TRUE, 
              main=&quot;% variation&quot;, col=c(&quot;bisque&quot;,2), las=2)
        legend(&quot;topright&quot;, c(&quot;% eigenvalue&quot;, &quot;Broken stick model&quot;), 
               pch=15, col=c(&quot;bisque&quot;,2), bty=&quot;n&quot;)
      par(op)
  }</code></pre>
</div>
<div id="agrupamiento-jerárquico-clúster" class="section level1">
<h1>Agrupamiento jerárquico (clúster)</h1>
<p>Realizar un agrupamiento jerárquico en R es bastante sencillo, únicamente debemos de tener nuestro data.frame cuyos nombres de renglones sean las etiquetas de nuestras instancias a agrupar, calcular las distancias con la función <code>dist(x, method)</code> y unir los grupos con la función <code>hclust(dist, method)</code>.</p>
<pre class="r"><code>library(vegan, quietly = T)

df1 &lt;- data.frame(long = c(3, 3.6, 6.5, 7.5, 15, 20), row.names = c(&quot;Tt&quot;, &quot;Gg&quot;, &quot;Gm&quot;, &quot;Oo&quot;, &quot;Mn&quot;, &quot;Bp&quot;))
dist.mat &lt;- dist(df1, method = &quot;euclidean&quot;)
hc.av &lt;- hclust(dist.mat, method =&quot;average&quot;)</code></pre>
<p>Si graficamos este objeto tendremos un dendrograma muy sencillo:</p>
<pre class="r"><code>library(ggplot2, quietly = T)
library(ggdendro, quietly = T)

ggdendrogram(hc.av, labels = T)</code></pre>
<p><img src="c13_no_sup_files/figure-html/unnamed-chunk-4-1.png" width="672" /> Podemos personalizar el dendrograma utilizando la función <code>set(object, what, value)</code> de la librería <code>dendextend</code>:</p>
<pre class="r"><code>library(dendextend)
# Primero transformemos nuestro objeto a un dendrograma:
dend &lt;- as.dendrogram(hc.av)

# Cambiemos el color a las ramas:
dend &lt;- set(dend, &quot;branches_k_color&quot;,
            value = &quot;deepskyblue4&quot;,
            k = 1)

#dend &lt;- set(dend, &quot;branches_k_color&quot;,
#            value = c(rgb(0,118, 186, maxColorValue = 255),
#                      rgb(0, 123, 118, maxColorValue = 255),
#                      rgb(255, 147, 0, maxColorValue = 255),
#                      rgb(181, 23, 0, maxColorValue = 255)), 
#            k = 4)
dend &lt;- set(dend, &quot;branches_lwd&quot;, 1)

# Cambiemos el color de las etiquetas:
dend &lt;- set(dend, &quot;labels_col&quot;,
            value = c(rgb(0,118, 186, maxColorValue = 255),
                      rgb(0, 123, 118, maxColorValue = 255),
                      rgb(255, 147, 0, maxColorValue = 255),
                      rgb(181, 23, 0, maxColorValue = 255)), 
            k = 4)

# Graficador base de R:
plot(dend)</code></pre>
<p><img src="c13_no_sup_files/figure-html/unnamed-chunk-5-1.png" width="672" /> Por homogeneidad con el resto del curso, grafiquémoslo utilizando <code>ggplot2</code>:</p>
<pre class="r"><code>ggd1 &lt;- as.ggdend(dend)
ggd1.plot &lt;- ggplot(ggd1, offset_labels = -1, theme = blank_theme()) + 
             ylim(-2.4, max(get_branches_heights(dend))) +
             scale_x_continuous(breaks = NULL) +
             labs(title = &quot;Dendrograma de especies de cetáceos&quot;,
                  subtitle = &quot;Agrupamientos por longitud (método: promedio)&quot;,
                  x = element_blank(),
                  y = &quot;Distancia euclidiana&quot;,
                  caption = &quot;Datos de bit.ly/clust_medium&quot;)

ggd1.plot</code></pre>
<p><img src="c13_no_sup_files/figure-html/unnamed-chunk-6-1.png" width="672" /> ## Ejercicio Mv Habiendo comprendido cómo funciona el análisis de agrupamientos, apliquémoslo a una base de datos multivariada (<code>cluster.txt</code>), la cual consiste en mediciones de variables ambientales en distintos sitios de muestreo y el objetivo es agrupar aquellos que tengan características similares. En el resumen podemos ver que hay diferencias muy importantes en las escalas de las variables, por lo cual será necesario escalar los datos.</p>
<pre class="r"><code>clust.df &lt;- read.table(&quot;data/cluster.txt&quot;, header = T, row.names = 1) # ¡OJO con row.names!
summary(clust.df)</code></pre>
<pre><code>##       Temp            NH4             NO3              OD             Prof    
##  Min.   :16.90   Min.   :0.540   Min.   :0.400   Min.   :0.810   Min.   : 27  
##  1st Qu.:18.20   1st Qu.:0.900   1st Qu.:1.830   1st Qu.:2.650   1st Qu.: 76  
##  Median :19.60   Median :0.980   Median :2.500   Median :3.800   Median :122  
##  Mean   :20.31   Mean   :1.047   Mean   :2.394   Mean   :4.103   Mean   :109  
##  3rd Qu.:21.40   3rd Qu.:1.250   3rd Qu.:3.120   3rd Qu.:5.840   3rd Qu.:148  
##  Max.   :25.80   Max.   :1.570   Max.   :4.210   Max.   :8.010   Max.   :199  
##      Trans            Caud             SST              STD       
##  Min.   : 4.00   Min.   : 0.520   Min.   :   4.0   Min.   : 86.9  
##  1st Qu.: 6.00   1st Qu.: 1.960   1st Qu.:  50.0   1st Qu.:101.5  
##  Median :10.00   Median : 5.580   Median : 134.0   Median :104.3  
##  Mean   :17.62   Mean   : 5.877   Mean   : 254.3   Mean   :108.7  
##  3rd Qu.:18.00   3rd Qu.: 8.100   3rd Qu.: 298.7   3rd Qu.:113.7  
##  Max.   :56.00   Max.   :15.440   Max.   :1163.3   Max.   :137.7  
##       PO4             DBO5            DQO       
##  Min.   :0.000   Min.   :20.21   Min.   : 5.00  
##  1st Qu.:0.250   1st Qu.:21.29   1st Qu.:16.00  
##  Median :0.400   Median :23.27   Median :32.00  
##  Mean   :0.391   Mean   :27.45   Mean   :32.52  
##  3rd Qu.:0.600   3rd Qu.:32.62   3rd Qu.:50.00  
##  Max.   :0.870   Max.   :59.82   Max.   :62.00</code></pre>
<p>Otro problema, tal vez no tan evidente, es que la distribución de SST se encuentra sumamente sesgada, por lo que habrá que a) aplicar una transformación para normalizar los datos, b) retirarla del análisis. Tomando en cuenta los valores, es bastante probable que las mediciones estén equivocadas, por lo que la retiraremos del análisis.</p>
<pre class="r"><code>mask &lt;- colnames(clust.df)[colnames(clust.df) != &quot;SST&quot;]
clust.filt &lt;- clust.df[,mask]
colnames(clust.filt)</code></pre>
<pre><code>##  [1] &quot;Temp&quot;  &quot;NH4&quot;   &quot;NO3&quot;   &quot;OD&quot;    &quot;Prof&quot;  &quot;Trans&quot; &quot;Caud&quot;  &quot;STD&quot;   &quot;PO4&quot;  
## [10] &quot;DBO5&quot;  &quot;DQO&quot;</code></pre>
<p>Ahora escalemos todos nuestros datos. Al analizar rápidamente la distribución de cada una de las variables podemos ver que hay algunas con sesgos que pudieran ser importantes; sin embargo, podemos utilizar una medida de distancia que contienda con este tipo de distribuciones para evitar una transformación más agresiva que el escalamiento.</p>
<pre class="r"><code>clust.scale &lt;- scale(clust.filt)
#clust.scale &lt;- log(clust.filt +1) # Si de todos modos deseas aplicar una transformación para &quot;normalizar&quot; los datos.
summary(clust.scale)</code></pre>
<pre><code>##       Temp             NH4               NO3                OD         
##  Min.   :-1.315   Min.   :-1.8357   Min.   :-1.9515   Min.   :-1.4896  
##  1st Qu.:-0.814   1st Qu.:-0.5326   1st Qu.:-0.5518   1st Qu.:-0.6573  
##  Median :-0.275   Median :-0.2430   Median : 0.1039   Median :-0.1370  
##  Mean   : 0.000   Mean   : 0.0000   Mean   : 0.0000   Mean   : 0.0000  
##  3rd Qu.: 0.418   3rd Qu.: 0.7343   3rd Qu.: 0.7108   3rd Qu.: 0.7859  
##  Max.   : 2.112   Max.   : 1.8926   Max.   : 1.7776   Max.   : 1.7675  
##       Prof             Trans              Caud               STD         
##  Min.   :-1.5885   Min.   :-0.8294   Min.   :-1.19044   Min.   :-1.4307  
##  1st Qu.:-0.6393   1st Qu.:-0.7076   1st Qu.:-0.87045   1st Qu.:-0.4734  
##  Median : 0.2518   Median :-0.4640   Median :-0.06603   Median :-0.2898  
##  Mean   : 0.0000   Mean   : 0.0000   Mean   : 0.00000   Mean   : 0.0000  
##  3rd Qu.: 0.7555   3rd Qu.: 0.0232   3rd Qu.: 0.49395   3rd Qu.: 0.3266  
##  Max.   : 1.7435   Max.   : 2.3373   Max.   : 2.12502   Max.   : 1.9003  
##       PO4                DBO5              DQO          
##  Min.   :-1.45097   Min.   :-0.7880   Min.   :-1.43661  
##  1st Qu.:-0.52313   1st Qu.:-0.6704   1st Qu.:-0.86246  
##  Median : 0.03358   Median :-0.4548   Median :-0.02734  
##  Mean   : 0.00000   Mean   : 0.0000   Mean   : 0.00000  
##  3rd Qu.: 0.77585   3rd Qu.: 0.5631   3rd Qu.: 0.91217  
##  Max.   : 1.77792   Max.   : 3.5244   Max.   : 1.53851</code></pre>
<p>Ahora realicemos los agrupamientos. Utilizaremos la distancia Mahalanobis ya que esta no es tan sensible a los valores extremos. El método de agrupamiento será ward.D2, (distancias cuadráticas) para minimizar la varianza intra-grupos:</p>
<pre class="r"><code>dist.mv1 &lt;- vegdist(clust.scale, method = &quot;mahalanobis&quot;)
hc.mv1 &lt;- hclust(dist.mv1, method =&quot;ward.D2&quot;)

# Transformemos nuestro objeto a un dendrograma:
dend.mv1 &lt;- as.dendrogram(hc.mv1)

# Cambiemos el color a las ramas:
dend.mv1 &lt;- set(dend.mv1, &quot;branches_k_color&quot;,
            value = &quot;deepskyblue4&quot;,
            k = 1)

dend.mv1 &lt;- set(dend.mv1, &quot;branches_lwd&quot;, 0.7)

ggd1 &lt;- as.ggdend(dend.mv1)
ggd1.plot &lt;- ggplot(ggd1, offset_labels = -1, theme = blank_theme()) + 
             expand_limits(y = -2.4) +
             scale_x_continuous(breaks = NULL) +
             scale_y_continuous(breaks = seq(0,max(get_branches_heights(dend.mv1)),2)) +
             labs(title = &quot;Dendrograma de sitios de muestreo&quot;,
                  subtitle = &quot;Método de agrupamiento: Ward.D2&quot;,
                  x = element_blank(),
                  y = &quot;Distancia Mahalanobis&quot;,
                  caption = &quot;Datos: clust.txt&quot;)

ggd1.plot</code></pre>
<p><img src="c13_no_sup_files/figure-html/unnamed-chunk-10-1.png" width="672" /> Los agrupamientos con esa combinación de distancia y método de agrupamiento no son claros, veamos qué pasa si consideramos la distancia euclidiana:</p>
<pre class="r"><code>dist.mv2 &lt;- vegdist(clust.scale, method = &quot;euclidean&quot;)
hc.mv2 &lt;- hclust(dist.mv2, method =&quot;ward.D2&quot;)

# Transformemos nuestro objeto a un dendrograma:
dend.mv2 &lt;- as.dendrogram(hc.mv2)

# Cambiemos el color a las ramas:
dend.mv2 &lt;- set(dend.mv2, &quot;branches_k_color&quot;,
            value = &quot;deepskyblue4&quot;,
            k = 1)

dend.mv2 &lt;- set(dend.mv2, &quot;branches_lwd&quot;, 0.7)

ggd2 &lt;- as.ggdend(dend.mv2)
ggd2.plot &lt;- ggplot(ggd2, offset_labels = -1, theme = blank_theme()) + 
             expand_limits(y = -2.4) +
             scale_x_continuous(breaks = NULL) +
             scale_y_continuous(breaks = seq(0,max(get_branches_heights(dend.mv2)),2)) +
             labs(title = &quot;Dendrograma de sitios de muestreo&quot;,
                  subtitle = &quot;Método de agrupamiento: Ward.D2&quot;,
                  x = element_blank(),
                  y = &quot;Distancia Euclidiana&quot;,
                  caption = &quot;Datos: clust.txt&quot;)

ggd2.plot</code></pre>
<p><img src="c13_no_sup_files/figure-html/unnamed-chunk-11-1.png" width="672" /> ¿Y la distancia Manhattan? Las agrupaciones resultantes son similares; sin embargo, las medidas de distancia son muy diferentes. Utilicemos el caso anterior para evaluar las agrupaciones.</p>
<pre class="r"><code>dist.mv3 &lt;- vegdist(clust.scale, method = &quot;manhattan&quot;)
hc.mv3 &lt;- hclust(dist.mv3, method =&quot;ward.D2&quot;)

# Transformemos nuestro objeto a un dendrograma:
dend.mv3 &lt;- as.dendrogram(hc.mv3)

# Cambiemos el color a las ramas:
dend.mv3 &lt;- set(dend.mv3, &quot;branches_k_color&quot;,
            value = &quot;deepskyblue4&quot;,
            k = 1)

dend.mv3 &lt;- set(dend.mv3, &quot;branches_lwd&quot;, 0.7)

ggd3 &lt;- as.ggdend(dend.mv3)
ggd3.plot &lt;- ggplot(ggd3, offset_labels = -1, theme = blank_theme()) + 
             expand_limits(y = -3.5) +
             scale_x_continuous(breaks = NULL) +
             scale_y_continuous(breaks = seq(0,max(get_branches_heights(dend.mv3)),5)) +
             labs(title = &quot;Dendrograma de sitios de muestreo&quot;,
                  subtitle = &quot;Método de agrupamiento: Ward.D2)&quot;,
                  x = element_blank(),
                  y = &quot;Distancia Manhattan&quot;,
                  caption = &quot;Datos: clust.txt&quot;)

ggd3.plot</code></pre>
<p><img src="c13_no_sup_files/figure-html/unnamed-chunk-12-1.png" width="672" /> ### Evaluación de los agrupamientos Para calcular los índices que estiman el número óptimo de agrupaciones utilizaremos la función <code>NbClust</code> de la librería con el mismo nombre.</p>
<pre class="r"><code>library(NbClust)
res &lt;- NbClust(clust.scale, diss = NULL, distance = &quot;euclidean&quot;, method = &quot;ward.D2&quot;, index = &quot;all&quot;, max.nc = 8)</code></pre>
<p><img src="c13_no_sup_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<pre><code>## *** : The Hubert index is a graphical method of determining the number of clusters.
##                 In the plot of Hubert index, we seek a significant knee that corresponds to a 
##                 significant increase of the value of the measure i.e the significant peak in Hubert
##                 index second differences plot. 
## </code></pre>
<p><img src="c13_no_sup_files/figure-html/unnamed-chunk-13-2.png" width="672" /></p>
<pre><code>## *** : The D index is a graphical method of determining the number of clusters. 
##                 In the plot of D index, we seek a significant knee (the significant peak in Dindex
##                 second differences plot) that corresponds to a significant increase of the value of
##                 the measure. 
##  
## ******************************************************************* 
## * Among all indices:                                                
## * 4 proposed 2 as the best number of clusters 
## * 11 proposed 3 as the best number of clusters 
## * 1 proposed 5 as the best number of clusters 
## * 2 proposed 7 as the best number of clusters 
## * 5 proposed 8 as the best number of clusters 
## 
##                    ***** Conclusion *****                            
##  
## * According to the majority rule, the best number of clusters is  3 
##  
##  
## *******************************************************************</code></pre>
<p>Veamos ahora los grupos y calculemos el coeficiente de correlación cofenético. Una correlación de prácticamente el 70% es más que aceptable, si consideramos que no filtramos la totalidad de los datos. Como dato curioso, al aplicar una transformación logarítmica se mantienen estos grupos pero el coeficiente de correlación cofenético se eleva a 0.8.</p>
<pre class="r"><code>res$Best.partition</code></pre>
<pre><code>##  S1  S2  S3  S4  S5  S6  S7  S8  S9 S10 S11 S12 S13 S14 S15 S16 S17 S18 S19 S20 
##   1   1   1   1   2   2   2   2   2   2   2   1   2   2   2   3   3   2   3   3 
## S21 
##   3</code></pre>
<pre class="r"><code>hc.e &lt;- cluster::agnes(dist.mv2, diss = T, method = &quot;ward&quot;)
ccc &lt;- cophenetic(hc.e) # Distancias en el dendrograma
ccofen &lt;- cor(dist.mv2, ccc, method = &quot;spearman&quot;) # Correlación entre distancias reales y graficadas
ccofen</code></pre>
<pre><code>## [1] 0.6868661</code></pre>
<p>Esta forma de ver los agrupamientos no es muy clara, entonces agreguémosla a nuestro gráfico mediante colores de las ramas y etiquetas:</p>
<pre class="r"><code># Cambiamos el color de nuestr
dend.mv2 &lt;- set(dend.mv2, &quot;labels_col&quot;,
                value = 1:3,
                k = 3)

dend.mv2 &lt;- set(dend.mv2, &quot;branches_k_color&quot;,
            value = 1:3,
            k = 3)          
          
dend.mv2 &lt;- set(dend.mv2, &quot;branches_lwd&quot;, 0.7)

ggd2 &lt;- as.ggdend(dend.mv2)
ggd2.plot &lt;- ggplot(ggd2, offset_labels = -1, theme = blank_theme()) + 
             expand_limits(y = -2.4) +
             scale_x_continuous(breaks = NULL) +
             scale_y_continuous(breaks = seq(0,max(get_branches_heights(dend.mv2)),2)) +
             labs(title = &quot;Dendrograma de sitios de muestreo&quot;,
                  subtitle = &quot;Método de agrupamiento: Ward.D2&quot;,
                  x = element_blank(),
                  y = &quot;Distancia Euclidiana&quot;,
                  caption = &quot;Datos: clust.txt&quot;)

ggd2.plot</code></pre>
<p><img src="c13_no_sup_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p><strong>Guardado de figuras!!!</strong></p>
<pre class="r"><code>#cairo_pdf(&quot;dendrogram.pdf&quot;, width = 8, height = 8)
ggd2.plot</code></pre>
<p><img src="c13_no_sup_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<pre class="r"><code>#dev.off()</code></pre>
<p>¿Cómo lo interpretamos? Hay que revisar la base de datos para evitar caer en interpretaciones incorrectas y analizar qué características conforman cada grupo.</p>
</div>
<div id="análisis-de-componentes-principales" class="section level1">
<h1>Análisis de Componentes Principales</h1>
<p>Por fin llegó la hora de hablar del Análisis de Componentes Principales. Vimos que esta técnica nos permite aproximar nuestros datos multivariados utilizando nuevas variables llamadas Componentes Principales, las cuales son ortogonales (independientes) entre sí. Apliquemos el Análisis de componentes principales a una base de datos con una gran cantidad de variables:</p>
<pre class="r"><code>library(factoextra)
library(FactoMineR)
#Base de datos completa
  
x1n &lt;- read.table(&#39;data/Medidas.txt&#39;, header = TRUE)
#Base de datos sin nombres de especies

x1 &lt;- x1n[ ,2:length(x1n) ]
summary(x1)</code></pre>
<pre><code>##      furcal            base             radio              alto        
##  Min.   :0.2527   Min.   :0.07088   Min.   :0.04408   Min.   :0.05319  
##  1st Qu.:0.2716   1st Qu.:0.09108   1st Qu.:0.06748   1st Qu.:0.06709  
##  Median :0.2753   Median :0.09679   Median :0.07090   Median :0.07140  
##  Mean   :0.2757   Mean   :0.09645   Mean   :0.07048   Mean   :0.07116  
##  3rd Qu.:0.2801   3rd Qu.:0.10142   3rd Qu.:0.07430   3rd Qu.:0.07534  
##  Max.   :0.3202   Max.   :0.11394   Max.   :0.08311   Max.   :0.09723  
##      gordo             angos              ojo             X1erarc       
##  Min.   :0.02679   Min.   :0.02996   Min.   :0.02142   Min.   :0.03485  
##  1st Qu.:0.04139   1st Qu.:0.03465   1st Qu.:0.02451   1st Qu.:0.04332  
##  Median :0.04402   Median :0.03577   Median :0.02673   Median :0.05129  
##  Mean   :0.04405   Mean   :0.03616   Mean   :0.02740   Mean   :0.05158  
##  3rd Qu.:0.04680   3rd Qu.:0.03745   3rd Qu.:0.02875   3rd Qu.:0.05899  
##  Max.   :0.05859   Max.   :0.04727   Max.   :0.08191   Max.   :0.07738  
##      dist.              largo              cabez             hueso        
##  Min.   :0.007179   Min.   :0.004202   Min.   :0.07311   Min.   :0.02857  
##  1st Qu.:0.030485   1st Qu.:0.022402   1st Qu.:0.08476   1st Qu.:0.03236  
##  Median :0.035368   Median :0.029488   Median :0.08951   Median :0.03415  
##  Mean   :0.031366   Mean   :0.026533   Mean   :0.08860   Mean   :0.03488  
##  3rd Qu.:0.038824   3rd Qu.:0.034574   3rd Qu.:0.09284   3rd Qu.:0.03582  
##  Max.   :0.048008   Max.   :0.051843   Max.   :0.09815   Max.   :0.10411  
##      mandib           hueso.1            arriba            cabeza       
##  Min.   :0.03141   Min.   :0.02348   Min.   :0.01855   Min.   :0.07118  
##  1st Qu.:0.03598   1st Qu.:0.03917   1st Qu.:0.02546   1st Qu.:0.08309  
##  Median :0.03980   Median :0.04413   Median :0.02952   Median :0.08796  
##  Mean   :0.03923   Mean   :0.04498   Mean   :0.02946   Mean   :0.08890  
##  3rd Qu.:0.04247   3rd Qu.:0.04995   3rd Qu.:0.03391   3rd Qu.:0.09483  
##  Max.   :0.04758   Max.   :0.08783   Max.   :0.03828   Max.   :0.10760  
##       boca             abiert           cachete           largo.1        
##  Min.   :0.02828   Min.   :0.01810   Min.   :0.02938   Min.   :0.008724  
##  1st Qu.:0.03476   1st Qu.:0.02348   1st Qu.:0.03911   1st Qu.:0.012881  
##  Median :0.03830   Median :0.02531   Median :0.04308   Median :0.014240  
##  Mean   :0.03954   Mean   :0.02547   Mean   :0.04237   Mean   :0.014366  
##  3rd Qu.:0.04368   3rd Qu.:0.02741   3rd Qu.:0.04508   3rd Qu.:0.015936  
##  Max.   :0.05552   Max.   :0.03248   Max.   :0.06553   Max.   :0.026475  
##      ancho            orificio           densi            hocic        
##  Min.   :0.00274   Min.   :0.01968   Min.   :0.6990   Min.   :0.01546  
##  1st Qu.:0.02663   1st Qu.:0.03741   1st Qu.:0.7782   1st Qu.:0.02491  
##  Median :0.03031   Median :0.04381   Median :0.8451   Median :0.02929  
##  Mean   :0.03253   Mean   :0.04429   Mean   :0.8401   Mean   :0.02937  
##  3rd Qu.:0.03447   3rd Qu.:0.05085   3rd Qu.:0.9031   3rd Qu.:0.03294  
##  Max.   :0.22628   Max.   :0.07390   Max.   :1.1139   Max.   :0.04922  
##     interbr            ojoatra            proye              base.1       
##  Min.   :0.007687   Min.   :0.02685   Min.   :0.007313   Min.   :0.01546  
##  1st Qu.:0.014457   1st Qu.:0.03796   1st Qu.:0.013341   1st Qu.:0.02052  
##  Median :0.015776   Median :0.04050   Median :0.014982   Median :0.02238  
##  Mean   :0.016304   Mean   :0.04067   Mean   :0.016217   Mean   :0.02300  
##  3rd Qu.:0.017609   3rd Qu.:0.04256   3rd Qu.:0.016613   3rd Qu.:0.02474  
##  Max.   :0.028804   Max.   :0.08124   Max.   :0.127873   Max.   :0.04476  
##      altura             area             Intesti      
##  Min.   :0.02514   Min.   :0.001431   Min.   :0.1295  
##  1st Qu.:0.03815   1st Qu.:0.006723   1st Qu.:0.1774  
##  Median :0.04422   Median :0.009716   Median :0.1960  
##  Mean   :0.04474   Mean   :0.010638   Mean   :0.1980  
##  3rd Qu.:0.04928   3rd Qu.:0.014274   3rd Qu.:0.2150  
##  Max.   :0.08398   Max.   :0.027268   Max.   :0.3246</code></pre>
<p>Apliquemos el Análisis de Componentes Principales:</p>
<pre class="r"><code>res.pca &lt;- FactoMineR::PCA(x1, graph = F, ncp = length(x1), scale.unit = T) #Aplicamos el ACP con los datos escalados y centrados
var &lt;- get_pca_var(res.pca) # Extraemos las correlaciones de cada variable con cada componente principal
cors &lt;- (round(abs(var$coord),2))
cors</code></pre>
<pre><code>##          Dim.1 Dim.2 Dim.3 Dim.4 Dim.5 Dim.6 Dim.7 Dim.8 Dim.9 Dim.10 Dim.11
## furcal    0.17  0.11  0.22  0.25  0.09  0.37  0.37  0.34  0.43   0.31   0.19
## base      0.08  0.08  0.32  0.02  0.15  0.46  0.19  0.41  0.35   0.02   0.45
## radio     0.29  0.05  0.25  0.33  0.43  0.31  0.07  0.13  0.24   0.20   0.38
## alto      0.13  0.32  0.44  0.45  0.48  0.04  0.14  0.09  0.08   0.05   0.03
## gordo     0.24  0.26  0.50  0.28  0.44  0.11  0.17  0.14  0.06   0.09   0.22
## angos     0.19  0.42  0.16  0.43  0.37  0.18  0.15  0.01  0.07   0.06   0.29
## ojo       0.16  0.21  0.06  0.14  0.18  0.43  0.25  0.17  0.28   0.52   0.33
## X1erarc   0.76  0.28  0.00  0.00  0.23  0.02  0.16  0.04  0.04   0.05   0.05
## dist.     0.44  0.29  0.15  0.30  0.01  0.46  0.29  0.24  0.24   0.20   0.21
## largo     0.65  0.36  0.22  0.30  0.01  0.26  0.17  0.08  0.25   0.20   0.15
## cabez     0.58  0.49  0.12  0.22  0.29  0.16  0.22  0.08  0.07   0.04   0.19
## hueso     0.02  0.17  0.32  0.45  0.06  0.31  0.46  0.19  0.04   0.07   0.06
## mandib    0.83  0.36  0.03  0.06  0.00  0.03  0.05  0.05  0.11   0.01   0.08
## hueso.1   0.30  0.02  0.42  0.65  0.16  0.03  0.29  0.22  0.06   0.10   0.04
## arriba    0.79  0.31  0.23  0.12  0.01  0.01  0.01  0.01  0.11   0.01   0.07
## cabeza    0.24  0.22  0.29  0.54  0.35  0.19  0.39  0.05  0.17   0.23   0.03
## boca      0.71  0.18  0.06  0.09  0.12  0.24  0.16  0.08  0.25   0.15   0.01
## abiert    0.60  0.11  0.54  0.05  0.07  0.06  0.21  0.19  0.13   0.17   0.05
## cachete   0.24  0.35  0.59  0.09  0.39  0.22  0.20  0.09  0.01   0.00   0.01
## largo.1   0.37  0.72  0.18  0.02  0.11  0.08  0.13  0.05  0.07   0.01   0.06
## ancho     0.11  0.33  0.17  0.02  0.47  0.18  0.06  0.08  0.19   0.53   0.00
## orificio  0.08  0.67  0.28  0.20  0.12  0.36  0.04  0.12  0.18   0.06   0.07
## densi     0.59  0.32  0.29  0.12  0.12  0.05  0.24  0.10  0.29   0.03   0.04
## hocic     0.78  0.14  0.22  0.32  0.06  0.06  0.03  0.05  0.03   0.06   0.00
## interbr   0.38  0.54  0.03  0.35  0.15  0.14  0.26  0.04  0.03   0.02   0.05
## ojoatra   0.26  0.52  0.49  0.29  0.30  0.10  0.03  0.08  0.10   0.05   0.03
## proye     0.01  0.16  0.18  0.14  0.14  0.23  0.20  0.68  0.38   0.08   0.03
## base.1    0.39  0.61  0.35  0.11  0.01  0.02  0.05  0.11  0.02   0.14   0.27
## altura    0.10  0.74  0.23  0.15  0.17  0.10  0.10  0.09  0.05   0.00   0.07
## area      0.61  0.34  0.50  0.01  0.05  0.18  0.04  0.02  0.07   0.00   0.01
## Intesti   0.33  0.63  0.02  0.15  0.03  0.15  0.10  0.05  0.08   0.16   0.03
##          Dim.12 Dim.13 Dim.14 Dim.15 Dim.16 Dim.17 Dim.18 Dim.19 Dim.20 Dim.21
## furcal     0.16   0.15   0.07   0.10   0.04   0.15   0.01   0.13   0.05   0.06
## base       0.25   0.01   0.05   0.03   0.01   0.01   0.11   0.11   0.10   0.03
## radio      0.08   0.11   0.04   0.35   0.07   0.10   0.10   0.09   0.02   0.09
## alto       0.05   0.03   0.03   0.04   0.12   0.25   0.24   0.06   0.07   0.05
## gordo      0.11   0.02   0.21   0.04   0.25   0.18   0.17   0.02   0.00   0.08
## angos      0.26   0.13   0.24   0.04   0.07   0.11   0.27   0.05   0.16   0.02
## ojo        0.11   0.13   0.24   0.05   0.20   0.07   0.10   0.00   0.00   0.04
## X1erarc    0.08   0.21   0.03   0.14   0.19   0.03   0.08   0.06   0.11   0.08
## dist.      0.03   0.09   0.04   0.15   0.07   0.05   0.12   0.16   0.04   0.03
## largo      0.01   0.07   0.01   0.06   0.07   0.01   0.05   0.06   0.01   0.05
## cabez      0.19   0.05   0.07   0.04   0.03   0.00   0.05   0.12   0.15   0.08
## hueso      0.24   0.42   0.09   0.04   0.08   0.11   0.00   0.02   0.08   0.13
## mandib     0.07   0.09   0.02   0.09   0.02   0.10   0.01   0.05   0.10   0.01
## hueso.1    0.02   0.03   0.07   0.13   0.03   0.10   0.11   0.02   0.03   0.21
## arriba     0.04   0.00   0.07   0.02   0.04   0.13   0.06   0.21   0.04   0.22
## cabeza     0.11   0.06   0.02   0.13   0.12   0.01   0.01   0.05   0.09   0.10
## boca       0.09   0.24   0.06   0.17   0.08   0.01   0.09   0.26   0.09   0.15
## abiert     0.14   0.03   0.16   0.02   0.04   0.12   0.06   0.02   0.20   0.12
## cachete    0.03   0.09   0.18   0.02   0.05   0.20   0.09   0.07   0.17   0.03
## largo.1    0.17   0.06   0.02   0.24   0.13   0.03   0.11   0.09   0.23   0.06
## ancho      0.38   0.09   0.22   0.01   0.05   0.04   0.23   0.04   0.00   0.06
## orificio   0.08   0.03   0.10   0.22   0.21   0.10   0.03   0.19   0.06   0.05
## densi      0.10   0.24   0.21   0.07   0.17   0.03   0.02   0.03   0.09   0.27
## hocic      0.13   0.05   0.07   0.06   0.04   0.09   0.19   0.02   0.11   0.06
## interbr    0.13   0.06   0.38   0.09   0.16   0.14   0.10   0.03   0.18   0.13
## ojoatra    0.10   0.17   0.09   0.09   0.14   0.01   0.13   0.05   0.11   0.03
## proye      0.21   0.28   0.09   0.16   0.00   0.17   0.03   0.05   0.03   0.04
## base.1     0.14   0.12   0.10   0.17   0.20   0.03   0.11   0.21   0.11   0.02
## altura     0.25   0.13   0.20   0.10   0.08   0.25   0.03   0.20   0.02   0.00
## area       0.25   0.18   0.22   0.06   0.07   0.01   0.01   0.10   0.08   0.07
## Intesti    0.02   0.30   0.04   0.26   0.34   0.25   0.07   0.15   0.16   0.04
##          Dim.22 Dim.23 Dim.24 Dim.25 Dim.26 Dim.27 Dim.28 Dim.29 Dim.30 Dim.31
## furcal     0.03   0.03   0.05   0.06   0.02   0.00   0.08   0.04   0.03   0.00
## base       0.00   0.09   0.03   0.07   0.00   0.05   0.02   0.02   0.02   0.00
## radio      0.11   0.00   0.01   0.03   0.01   0.00   0.01   0.05   0.02   0.03
## alto       0.10   0.20   0.10   0.03   0.06   0.05   0.00   0.04   0.02   0.02
## gordo      0.01   0.20   0.10   0.05   0.07   0.02   0.01   0.01   0.01   0.02
## angos      0.12   0.00   0.01   0.07   0.08   0.01   0.00   0.00   0.01   0.01
## ojo        0.03   0.07   0.01   0.02   0.00   0.01   0.01   0.02   0.02   0.00
## X1erarc    0.21   0.09   0.11   0.05   0.20   0.05   0.04   0.03   0.05   0.02
## dist.      0.03   0.00   0.01   0.09   0.07   0.06   0.03   0.06   0.05   0.09
## largo      0.03   0.01   0.06   0.11   0.05   0.11   0.04   0.08   0.10   0.10
## cabez      0.07   0.02   0.03   0.06   0.03   0.02   0.01   0.15   0.13   0.03
## hueso      0.13   0.02   0.05   0.03   0.02   0.09   0.02   0.00   0.02   0.01
## mandib     0.06   0.00   0.14   0.09   0.03   0.18   0.15   0.07   0.09   0.03
## hueso.1    0.13   0.03   0.03   0.02   0.10   0.14   0.02   0.04   0.02   0.06
## arriba     0.09   0.02   0.16   0.11   0.09   0.10   0.03   0.03   0.07   0.06
## cabeza     0.05   0.05   0.01   0.07   0.07   0.11   0.02   0.15   0.03   0.01
## boca       0.01   0.07   0.15   0.00   0.04   0.08   0.07   0.08   0.03   0.01
## abiert     0.06   0.02   0.08   0.08   0.22   0.04   0.09   0.03   0.01   0.01
## cachete    0.02   0.23   0.12   0.09   0.01   0.10   0.06   0.01   0.01   0.01
## largo.1    0.23   0.11   0.05   0.00   0.01   0.01   0.12   0.02   0.07   0.01
## ancho      0.07   0.03   0.05   0.02   0.02   0.02   0.02   0.03   0.00   0.00
## orificio   0.05   0.11   0.09   0.12   0.11   0.00   0.12   0.01   0.02   0.03
## densi      0.03   0.01   0.08   0.14   0.04   0.01   0.05   0.02   0.06   0.02
## hocic      0.18   0.08   0.03   0.16   0.06   0.09   0.18   0.02   0.03   0.01
## interbr    0.05   0.03   0.06   0.18   0.01   0.06   0.03   0.03   0.03   0.00
## ojoatra    0.15   0.25   0.11   0.10   0.04   0.04   0.08   0.02   0.01   0.05
## proye      0.03   0.02   0.01   0.01   0.01   0.02   0.03   0.02   0.01   0.01
## base.1     0.15   0.05   0.10   0.03   0.02   0.03   0.02   0.08   0.07   0.05
## altura     0.03   0.11   0.16   0.06   0.00   0.07   0.03   0.02   0.03   0.07
## area       0.07   0.00   0.04   0.05   0.10   0.02   0.06   0.14   0.07   0.08
## Intesti    0.03   0.02   0.02   0.02   0.03   0.02   0.03   0.02   0.04   0.01</code></pre>
<p>Ahora veamos los resultados de manera gráfica. Primero las variables:</p>
<pre class="r"><code>fviz_pca_var(res.pca, col.var = &quot;coord&quot;,
                       gradient.cols = c(&quot;#00AFBB&quot;, &quot;#E7B800&quot;, &quot;#FC4E07&quot;))</code></pre>
<p><img src="c13_no_sup_files/figure-html/unnamed-chunk-19-1.png" width="672" /> ¿Qué variables son las más importantes? Otra forma de ver estos resultados es utilizando la librería corrplot:</p>
<pre class="r"><code>library(corrplot)
corrplot(var$coord, is.corr = T)</code></pre>
<p><img src="c13_no_sup_files/figure-html/unnamed-chunk-20-1.png" width="672" /> Podemos extraer las 4 variables más importantes para un componente dado:</p>
<pre class="r"><code>sort(cors[,1], decreasing = T)[1:4]</code></pre>
<pre><code>##  mandib  arriba   hocic X1erarc 
##    0.83    0.79    0.78    0.76</code></pre>
<pre class="r"><code>sort(cors[,2], decreasing = T)[1:4]</code></pre>
<pre><code>##   altura  largo.1 orificio  Intesti 
##     0.74     0.72     0.67     0.63</code></pre>
<p>Un efecto secundario de reducir la dimensionalidad es que podemos formar agrupaciones, (otra de las aplicaciones del ACP) tal y como en el caso del NMDS. Podemos ver cómo se distribuyeron los individuos según nuestras agrupaciones originales, tal que:</p>
<pre class="r"><code>fviz_pca_ind(res.pca,
             geom.ind = &quot;point&quot;, # Mostrar solo puntos (sin textos)
             col.ind = x1n[,1], # Número de colores (grupos)
             palette = c(&quot;#00AFBB&quot;, &quot;#E7B800&quot;, &quot;#FC4E07&quot;), # Colores a utilizar
             addEllipses = TRUE, # Elipses de concentración
             legend.title = &quot;Especies&quot;)</code></pre>
<p><img src="c13_no_sup_files/figure-html/unnamed-chunk-22-1.png" width="672" /> Y podemos también hacer un gráfico conjunto, aunque dada la alta dimensionalidad de esta base de datos, los resultados serán poco interpretables.</p>
<pre class="r"><code>fviz_pca_biplot(res.pca, 
                col.ind = x1n$especie, palette = &quot;jco&quot;, 
                addEllipses = TRUE, label = &quot;var&quot;,
                col.var = &quot;black&quot;, repel = TRUE,
                legend.title = &quot;Especies&quot;) </code></pre>
<p><img src="c13_no_sup_files/figure-html/unnamed-chunk-23-1.png" width="672" /> ## Evaluación de los Componentes Principales Veamos ahora las varianzas explicadas acumuladas para cada componente:</p>
<pre class="r"><code>eig.val &lt;- get_eigenvalue(res.pca)
eig.val</code></pre>
<pre><code>##        eigenvalue variance.percent cumulative.variance.percent
## Dim.1  6.14608922       19.8260942                    19.82609
## Dim.2  4.63221636       14.9426334                    34.76873
## Dim.3  2.80882601        9.0607291                    43.82946
## Dim.4  2.27068129        7.3247783                    51.15424
## Dim.5  1.68514008        5.4359358                    56.59017
## Dim.6  1.55020741        5.0006691                    61.59084
## Dim.7  1.26002881        4.0646091                    65.65545
## Dim.8  1.10797871        3.5741249                    69.22957
## Dim.9  1.05894728        3.4159590                    72.64553
## Dim.10 0.96627425        3.1170137                    75.76255
## Dim.11 0.84470657        2.7248599                    78.48741
## Dim.12 0.75624648        2.4395048                    80.92691
## Dim.13 0.72656100        2.3437452                    83.27066
## Dim.14 0.62761130        2.0245526                    85.29521
## Dim.15 0.52955055        1.7082276                    87.00344
## Dim.16 0.51240639        1.6529238                    88.65636
## Dim.17 0.45010263        1.4519440                    90.10830
## Dim.18 0.39821456        1.2845631                    91.39287
## Dim.19 0.37664998        1.2149999                    92.60787
## Dim.20 0.35475436        1.1443689                    93.75224
## Dim.21 0.30760753        0.9922823                    94.74452
## Dim.22 0.28534181        0.9204574                    95.66498
## Dim.23 0.26608062        0.8583246                    96.52330
## Dim.24 0.20787739        0.6705722                    97.19387
## Dim.25 0.19269314        0.6215908                    97.81546
## Dim.26 0.16829393        0.5428837                    98.35835
## Dim.27 0.14322652        0.4620210                    98.82037
## Dim.28 0.13259938        0.4277399                    99.24811
## Dim.29 0.10706999        0.3453871                    99.59350
## Dim.30 0.07572896        0.2442870                    99.83778
## Dim.31 0.05028750        0.1622177                   100.00000</code></pre>
<p>De todos los resultados anteriores vemos que las primeras dos dimensiones capturan menos del 50% de la varianza total de los datos; por tanto, es conveniente analizar cuántos componentes principales son los óptimos. Una alternativa es realizar el análisis gráfico de la varianza. En este gráfico buscamos un punto de inflexión, el cual indicaría el límite de los PCs representativos.</p>
<pre class="r"><code>fviz_eig(res.pca, addlabels = T)</code></pre>
<p><img src="c13_no_sup_files/figure-html/unnamed-chunk-25-1.png" width="672" /> En este gráfico yo consideraría el primer punto de inflexión en el tercer componente principal, pero veamos otros dos criterios. El primero es el criterio de Kaiser-Guttman, en el cual consideraremos los CP cuyas varianzas explicadas sean superiores al valor medio. El segundo modelo es un modelo de repartición de recursos desarrollado en el campo de la ecología: El modelo Broken-Stick (McArthur 1957). En este modelo, el recurso compartido es la varianza total, entonces consideraremos aquellos CPs que contengan una varianza explicada superior a la esperada según el modelo.</p>
<pre class="r"><code>#Kaisser-Guttman y Broken Stick
ev &lt;- as.data.frame(eig.val)$eigenvalue
names(ev) &lt;- paste(&quot;CP&quot;,seq_along(ev), &quot;&quot;)
evplot(ev)</code></pre>
<p><img src="c13_no_sup_files/figure-html/unnamed-chunk-26-1.png" width="672" /> Bajo el criterio de Kaiser-Guttman consideraríamos 8 CPs, mientras que en el modelo de Broken-Stick consideraríamos únicamente 4. De cualquier modo, ambos criterios sugieren un número mayor al que yo consideré en el gráfico de la varianza.</p>
</div>
<div id="escalamiento-multidimensional-no-métrico-nmds" class="section level1">
<h1>Escalamiento Multidimensional No Métrico (NMDS)</h1>
<p>A diferencia del PCA en el cual es importante que las variables estén centradas y estandarizadas (o que las variables sean del mismo tipo; e.g., biometrías en distintas especies de peces), el Escalamiento Multidimensional No Métrico (NMDS) es una técnica más flexible al estar basada en órdenes de rangos (distancias) para la ordenación. Como resultado, puede aceptar una variedad mayor de tipos de datos. Otra diferencia es que en el ACP el objetivo primordial no es la formación de agrupaciones, sino la reducción de la dimensionalidad y la ordenación es una consecuencia del proceso, mientras que en NMDS sí se busca una ordenación.</p>
<p>Para analizar este caso utilicemos los mismos datos del caso sitios (clúster):</p>
<pre class="r"><code># Matriz de distancias
dist.nmds &lt;- dist.mv2
mds &lt;- metaMDS(dist.nmds, distance = &quot;euclidean&quot;, k = 2, trace = T)</code></pre>
<pre><code>## Run 0 stress 0.1033851 
## Run 1 stress 0.1033851 
## ... Procrustes: rmse 1.978742e-05  max resid 5.90848e-05 
## ... Similar to previous best
## Run 2 stress 0.1033851 
## ... Procrustes: rmse 0.0001034217  max resid 0.0003289743 
## ... Similar to previous best
## Run 3 stress 0.1033851 
## ... Procrustes: rmse 2.031462e-05  max resid 6.432062e-05 
## ... Similar to previous best
## Run 4 stress 0.1188198 
## Run 5 stress 0.1642917 
## Run 6 stress 0.1033852 
## ... Procrustes: rmse 0.000156549  max resid 0.0004971714 
## ... Similar to previous best
## Run 7 stress 0.1033851 
## ... New best solution
## ... Procrustes: rmse 1.531413e-05  max resid 4.788813e-05 
## ... Similar to previous best
## Run 8 stress 0.1033851 
## ... Procrustes: rmse 2.991831e-05  max resid 8.992686e-05 
## ... Similar to previous best
## Run 9 stress 0.1033851 
## ... Procrustes: rmse 3.015689e-05  max resid 9.541441e-05 
## ... Similar to previous best
## Run 10 stress 0.1033851 
## ... Procrustes: rmse 5.621113e-05  max resid 0.0001683602 
## ... Similar to previous best
## Run 11 stress 0.1188198 
## Run 12 stress 0.1033851 
## ... New best solution
## ... Procrustes: rmse 8.814424e-06  max resid 2.799945e-05 
## ... Similar to previous best
## Run 13 stress 0.1188198 
## Run 14 stress 0.1188198 
## Run 15 stress 0.1033851 
## ... Procrustes: rmse 1.720723e-05  max resid 5.253055e-05 
## ... Similar to previous best
## Run 16 stress 0.1708132 
## Run 17 stress 0.1188198 
## Run 18 stress 0.1033851 
## ... Procrustes: rmse 1.352609e-05  max resid 4.290582e-05 
## ... Similar to previous best
## Run 19 stress 0.2047354 
## Run 20 stress 0.1033851 
## ... Procrustes: rmse 1.263777e-05  max resid 3.973764e-05 
## ... Similar to previous best
## *** Solution reached</code></pre>
<pre class="r"><code>mds.dims &lt;- data.frame(NMDS1 = mds$points[,1], NMDS2 = mds$points[,2])

mds.plot.data &lt;- cbind(mds.dims, clust.scale)</code></pre>
<p>Podemos obtener también la importancia de las variables, de modo análogo a lo que hicimos con el ACP:</p>
<pre class="r"><code># Extraemos los coeficientes de determinación de cada variable con cada dimensión reducida (flechas)
fit &lt;- envfit(mds, clust.scale)
arrow &lt;- data.frame(fit$vectors$arrows, R = fit$vectors$r, P = fit$vectors$pvals)
arrow[&quot;Variable&quot;] &lt;- rownames(arrow)

# Extraemos aquellas que tengan una correlación significativamente diferente de 0
arrow.p &lt;- subset(arrow, P &lt;= 0.05)

#Ordenamos de manera descendente según su valor de R2
arrow.p &lt;- arrow.p[order(arrow.p$R, decreasing = T), ]
head(arrow.p)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["NMDS1"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["NMDS2"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["R"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["P"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Variable"],"name":[5],"type":["chr"],"align":["left"]}],"data":[{"1":"-0.8293750","2":"0.5586923","3":"0.9128740","4":"0.001","5":"OD","_rn_":"OD"},{"1":"0.9471213","2":"-0.3208757","3":"0.8744891","4":"0.001","5":"STD","_rn_":"STD"},{"1":"0.8293891","2":"-0.5586714","3":"0.7176466","4":"0.001","5":"Temp","_rn_":"Temp"},{"1":"0.9517439","2":"-0.3068933","3":"0.6989926","4":"0.001","5":"NH4","_rn_":"NH4"},{"1":"0.9045884","2":"0.4262861","3":"0.6989239","4":"0.001","5":"Caud","_rn_":"Caud"},{"1":"-0.7862194","2":"-0.6179475","3":"0.6977652","4":"0.001","5":"Trans","_rn_":"Trans"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>library(ggrepel)
mds.plot &lt;- ggplot(mds.plot.data, aes(NMDS1, NMDS2)) +
            geom_point(aes(color = as.factor(res$Best.partition)), alpha = 0.7) +
            geom_label_repel(aes(label = rownames(clust.scale))) +
            stat_ellipse(aes(fill = as.factor(res$Best.partition)), 
                         type = &quot;t&quot;, size = 1, geom = &quot;polygon&quot;, 
                         alpha = 0.2, show.legend = F) +
            labs(title = &quot;Escalamiento Multidimensional no métrico (NMDS)&quot;,
                 subtitle = paste(&#39;Estrés =&#39;,round(mds$stress,3)),
                 caption = &quot;Datos: cluster.txt&quot;) +
            blank_theme() + 
            theme(legend.position = &quot;right&quot;) + scale_color_discrete(name = &quot;Grupo&quot;) #+
            #geom_segment(data = arrow.p, 
            #             aes(x=0, y=0, xend = NMDS1, yend = NMDS2, lty = Variable), 
            #             arrow = arrow(length = unit(.25, &quot;cm&quot;)*arrow.p$R) #Flechas escaladas según su R^2
            #             )

mds.plot</code></pre>
<p><img src="c13_no_sup_files/figure-html/unnamed-chunk-29-1.png" width="672" /> Ahora comparemos con el dendrograma:</p>
<pre class="r"><code>ggd2.plot</code></pre>
<p><img src="c13_no_sup_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<p>Tarea opcional: Aplicar un ACP a esta misma base de datos. 1. ¿Los datos deben de centrarse y estandarizarse? 2. Realiza el ACP. ¿Cuántos CPs considerarías? 3. ¿Cuál es la varianza explicada entre los dos primeros componentes principales? 4. ¿Cuáles son las variables más imporantes para esos dos componentes? 5. ¿Hay diferencias en la ordenación con respecto a los otros dos métodos? 6. Realizar las tres técnicas con las medidas ambientales, incluyendo SST y comparar con estos resultados.</p>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAiQWdydXBhbWllbnRvcyB5IFJlZHVjY2nDs24gZGUgbGEgRGltZW5zaW9uYWxpZGFkIgphdXRob3I6ICJNLiBlbiBDLiBBcnR1cm8gQmVsbCBFbnLDrXF1ZXogR2FyY8OtYSIKb3V0cHV0OgogICAgaHRtbF9kb2N1bWVudDoKICAgICAgZGZfcHJpbnQ6IHBhZ2VkCiAgICAgIHRoZW1lOiBjb3NtbwogICAgICB0b2M6IFRSVUUKICAgICAgdG9jX2Zsb2F0OiBUUlVFCiAgICAgIGNvZGVfZG93bmxvYWQ6IFRSVUUKLS0tCgoqKltWSURFT10oaHR0cHM6Ly95b3V0dS5iZS9ySjJfU1RqdnF4OCkqKgoKYGBge3IsIGVjaG89RkFMU0V9CiMgSW5zdGFsYWNpw7NuIGRlIHBhcXVldGVyw61hczoKI2lmICghcmVxdWlyZShjKCJnZ2RlbmRybyIsICJkZW5kZXh0ZW5kIiwgImZhY3RvZXh0cmEiLCAiY2x1c3RlciIsICJOYkNsdXN0IiwgIkZhY3RvTWluZVIiLCAiTUFTUyIsICJrbGFSIiwgInZlZ2FuIiwgImdncmVwZWwiLCAiY2FUb29scyIsICJjYXJldCIpKSkgewojICBpbnN0YWxsLnBhY2thZ2VzKCBjKCJnZ2RlbmRybyIsICJkZW5kZXh0ZW5kIiwgImZhY3RvZXh0cmEiLCAiY2x1c3RlciIsICJOYkNsdXN0IiwgIkZhY3RvTWluZVIiLCAiTUFTUyIsICJ2ZWdhbiIsICJnZ3JlcGVsIiwgImNhVG9vbHMiLCAiY2FyZXQiKSwgZGVwZW5kZW5jaWVzID0gVCkKI30KYGBgCgojIyBGdW5jaW9uZXMgcGVyc29uYWxpemFkYXM6CmBgYHtyfQojIFRlbWEgcGVyc29uYWxpemFkbwpibGFua190aGVtZSA8LSBmdW5jdGlvbihhc3BlY3QucmF0aW8gPSAxLzEuNjEpewogIHRoZW1lKHBhbmVsLmdyaWQubWlub3IgPSBlbGVtZW50X2JsYW5rKCksCiAgICAgICAgcGFuZWwuZ3JpZC5tYWpvciA9IGVsZW1lbnRfYmxhbmsoKSwKICAgICAgICBwYW5lbC5iYWNrZ3JvdW5kID0gZWxlbWVudF9ibGFuaygpLAogICAgICAgIGF4aXMubGluZSA9IGVsZW1lbnRfYmxhbmsoKSwKICAgICAgICBhc3BlY3QucmF0aW8gPSBhc3BlY3QucmF0aW8sCiAgICAgICAgYXhpcy50aWNrcyA9IGVsZW1lbnRfYmxhbmsoKSwKICAgICAgICB0ZXh0ID0gZWxlbWVudF90ZXh0KGNvbG91ciA9ICJncmF5NTAiKSwgIyBFbGltaW5hcgogICAgICAgIGxlZ2VuZC5wb3NpdGlvbiA9ICJub25lIgogICAgICAgICkKfQojIEZ1bmNpw7NuIHBhcmEgbGEgZXN0aW1hY2nDs24gZGUgbG9zIENQIMOzcHRpbW9zOgoKZXZwbG90IDwtIGZ1bmN0aW9uKGV2KXsKICAgIAogICAgIyBCcm9rZW4gc3RpY2sgbW9kZWwgKE1hY0FydGh1ciAxOTU3KQogICAgICBuIDwtIGxlbmd0aChldikKICAgICAgYnNtIDwtIGRhdGEuZnJhbWUoaj1zZXEoMTpuKSwgcD0wKQogICAgICBic20kcFsxXSA8LSAxL24gCiAgICAgIGZvciAoaSBpbiAyOm4pIGJzbSRwW2ldIDwtIGJzbSRwW2ktMV0gKyAoMS8obiArIDEgLSBpKSkKICAgICAgYnNtJHAgPC0gMTAwKmJzbSRwL24KICAgICMgUGxvdCBlaWdlbnZhbHVlcyBhbmQgJSBvZiB2YXJpYXRpb24gZm9yIGVhY2ggYXhpcwogICAgICBvcCA8LSBwYXIobWZyb3c9YygyLDEpKQogICAgICBiYXJwbG90KGV2LCBtYWluPSJFaWdlbnZhbHVlcyIsIGNvbD0iYmlzcXVlIiwgbGFzPTIpCiAgICAgICAgYWJsaW5lKGg9bWVhbihldiksIGNvbD0icmVkIikKICAgICAgICBsZWdlbmQoInRvcHJpZ2h0IiwgIkF2ZXJhZ2UgZWlnZW52YWx1ZSIsIGx3ZD0xLCBjb2w9MiwgYnR5PSJuIikKICAgICAgYmFycGxvdCh0KGNiaW5kKDEwMCpldi9zdW0oZXYpLCBic20kcFtuOjFdKSksIGJlc2lkZT1UUlVFLCAKICAgICAgICAgICAgICBtYWluPSIlIHZhcmlhdGlvbiIsIGNvbD1jKCJiaXNxdWUiLDIpLCBsYXM9MikKICAgICAgICBsZWdlbmQoInRvcHJpZ2h0IiwgYygiJSBlaWdlbnZhbHVlIiwgIkJyb2tlbiBzdGljayBtb2RlbCIpLCAKICAgICAgICAgICAgICAgcGNoPTE1LCBjb2w9YygiYmlzcXVlIiwyKSwgYnR5PSJuIikKICAgICAgcGFyKG9wKQogIH0KYGBgCgojIEFncnVwYW1pZW50byBqZXLDoXJxdWljbyAoY2zDunN0ZXIpCgpSZWFsaXphciB1biBhZ3J1cGFtaWVudG8gamVyw6FycXVpY28gZW4gUiBlcyBiYXN0YW50ZSBzZW5jaWxsbywgw7puaWNhbWVudGUgZGViZW1vcyBkZSB0ZW5lciBudWVzdHJvIGRhdGEuZnJhbWUgY3V5b3Mgbm9tYnJlcyBkZSByZW5nbG9uZXMgc2VhbiBsYXMgZXRpcXVldGFzIGRlIG51ZXN0cmFzIGluc3RhbmNpYXMgYSBhZ3J1cGFyLCBjYWxjdWxhciBsYXMgZGlzdGFuY2lhcyBjb24gbGEgZnVuY2nDs24gYGRpc3QoeCwgbWV0aG9kKWAgeSB1bmlyIGxvcyBncnVwb3MgY29uIGxhIGZ1bmNpw7NuIGBoY2x1c3QoZGlzdCwgbWV0aG9kKWAuCgpgYGB7cn0KbGlicmFyeSh2ZWdhbiwgcXVpZXRseSA9IFQpCgpkZjEgPC0gZGF0YS5mcmFtZShsb25nID0gYygzLCAzLjYsIDYuNSwgNy41LCAxNSwgMjApLCByb3cubmFtZXMgPSBjKCJUdCIsICJHZyIsICJHbSIsICJPbyIsICJNbiIsICJCcCIpKQpkaXN0Lm1hdCA8LSBkaXN0KGRmMSwgbWV0aG9kID0gImV1Y2xpZGVhbiIpCmhjLmF2IDwtIGhjbHVzdChkaXN0Lm1hdCwgbWV0aG9kID0iYXZlcmFnZSIpCmBgYApTaSBncmFmaWNhbW9zIGVzdGUgb2JqZXRvIHRlbmRyZW1vcyB1biBkZW5kcm9ncmFtYSBtdXkgc2VuY2lsbG86CmBgYHtyfQpsaWJyYXJ5KGdncGxvdDIsIHF1aWV0bHkgPSBUKQpsaWJyYXJ5KGdnZGVuZHJvLCBxdWlldGx5ID0gVCkKCmdnZGVuZHJvZ3JhbShoYy5hdiwgbGFiZWxzID0gVCkKYGBgClBvZGVtb3MgcGVyc29uYWxpemFyIGVsIGRlbmRyb2dyYW1hIHV0aWxpemFuZG8gbGEgZnVuY2nDs24gYHNldChvYmplY3QsIHdoYXQsIHZhbHVlKWAgZGUgbGEgbGlicmVyw61hIGBkZW5kZXh0ZW5kYDoKYGBge3J9CmxpYnJhcnkoZGVuZGV4dGVuZCkKIyBQcmltZXJvIHRyYW5zZm9ybWVtb3MgbnVlc3RybyBvYmpldG8gYSB1biBkZW5kcm9ncmFtYToKZGVuZCA8LSBhcy5kZW5kcm9ncmFtKGhjLmF2KQoKIyBDYW1iaWVtb3MgZWwgY29sb3IgYSBsYXMgcmFtYXM6CmRlbmQgPC0gc2V0KGRlbmQsICJicmFuY2hlc19rX2NvbG9yIiwKICAgICAgICAgICAgdmFsdWUgPSAiZGVlcHNreWJsdWU0IiwKICAgICAgICAgICAgayA9IDEpCgojZGVuZCA8LSBzZXQoZGVuZCwgImJyYW5jaGVzX2tfY29sb3IiLAojICAgICAgICAgICAgdmFsdWUgPSBjKHJnYigwLDExOCwgMTg2LCBtYXhDb2xvclZhbHVlID0gMjU1KSwKIyAgICAgICAgICAgICAgICAgICAgICByZ2IoMCwgMTIzLCAxMTgsIG1heENvbG9yVmFsdWUgPSAyNTUpLAojICAgICAgICAgICAgICAgICAgICAgIHJnYigyNTUsIDE0NywgMCwgbWF4Q29sb3JWYWx1ZSA9IDI1NSksCiMgICAgICAgICAgICAgICAgICAgICAgcmdiKDE4MSwgMjMsIDAsIG1heENvbG9yVmFsdWUgPSAyNTUpKSwgCiMgICAgICAgICAgICBrID0gNCkKZGVuZCA8LSBzZXQoZGVuZCwgImJyYW5jaGVzX2x3ZCIsIDEpCgojIENhbWJpZW1vcyBlbCBjb2xvciBkZSBsYXMgZXRpcXVldGFzOgpkZW5kIDwtIHNldChkZW5kLCAibGFiZWxzX2NvbCIsCiAgICAgICAgICAgIHZhbHVlID0gYyhyZ2IoMCwxMTgsIDE4NiwgbWF4Q29sb3JWYWx1ZSA9IDI1NSksCiAgICAgICAgICAgICAgICAgICAgICByZ2IoMCwgMTIzLCAxMTgsIG1heENvbG9yVmFsdWUgPSAyNTUpLAogICAgICAgICAgICAgICAgICAgICAgcmdiKDI1NSwgMTQ3LCAwLCBtYXhDb2xvclZhbHVlID0gMjU1KSwKICAgICAgICAgICAgICAgICAgICAgIHJnYigxODEsIDIzLCAwLCBtYXhDb2xvclZhbHVlID0gMjU1KSksIAogICAgICAgICAgICBrID0gNCkKCiMgR3JhZmljYWRvciBiYXNlIGRlIFI6CnBsb3QoZGVuZCkKYGBgClBvciBob21vZ2VuZWlkYWQgY29uIGVsIHJlc3RvIGRlbCBjdXJzbywgZ3JhZmlxdcOpbW9zbG8gdXRpbGl6YW5kbyBgZ2dwbG90MmA6CmBgYHtyfQpnZ2QxIDwtIGFzLmdnZGVuZChkZW5kKQpnZ2QxLnBsb3QgPC0gZ2dwbG90KGdnZDEsIG9mZnNldF9sYWJlbHMgPSAtMSwgdGhlbWUgPSBibGFua190aGVtZSgpKSArIAogICAgICAgICAgICAgeWxpbSgtMi40LCBtYXgoZ2V0X2JyYW5jaGVzX2hlaWdodHMoZGVuZCkpKSArCiAgICAgICAgICAgICBzY2FsZV94X2NvbnRpbnVvdXMoYnJlYWtzID0gTlVMTCkgKwogICAgICAgICAgICAgbGFicyh0aXRsZSA9ICJEZW5kcm9ncmFtYSBkZSBlc3BlY2llcyBkZSBjZXTDoWNlb3MiLAogICAgICAgICAgICAgICAgICBzdWJ0aXRsZSA9ICJBZ3J1cGFtaWVudG9zIHBvciBsb25naXR1ZCAobcOpdG9kbzogcHJvbWVkaW8pIiwKICAgICAgICAgICAgICAgICAgeCA9IGVsZW1lbnRfYmxhbmsoKSwKICAgICAgICAgICAgICAgICAgeSA9ICJEaXN0YW5jaWEgZXVjbGlkaWFuYSIsCiAgICAgICAgICAgICAgICAgIGNhcHRpb24gPSAiRGF0b3MgZGUgYml0Lmx5L2NsdXN0X21lZGl1bSIpCgpnZ2QxLnBsb3QKYGBgCiMjIEVqZXJjaWNpbyBNdgpIYWJpZW5kbyBjb21wcmVuZGlkbyBjw7NtbyBmdW5jaW9uYSBlbCBhbsOhbGlzaXMgZGUgYWdydXBhbWllbnRvcywgYXBsaXF1w6ltb3NsbyBhIHVuYSBiYXNlIGRlIGRhdG9zIG11bHRpdmFyaWFkYSAoYGNsdXN0ZXIudHh0YCksIGxhIGN1YWwgY29uc2lzdGUgZW4gbWVkaWNpb25lcyBkZSB2YXJpYWJsZXMgYW1iaWVudGFsZXMgZW4gZGlzdGludG9zIHNpdGlvcyBkZSBtdWVzdHJlbyB5IGVsIG9iamV0aXZvIGVzIGFncnVwYXIgYXF1ZWxsb3MgcXVlIHRlbmdhbiBjYXJhY3RlcsOtc3RpY2FzIHNpbWlsYXJlcy4gRW4gZWwgcmVzdW1lbiBwb2RlbW9zIHZlciBxdWUgaGF5IGRpZmVyZW5jaWFzIG11eSBpbXBvcnRhbnRlcyBlbiBsYXMgZXNjYWxhcyBkZSBsYXMgdmFyaWFibGVzLCBwb3IgbG8gY3VhbCBzZXLDoSBuZWNlc2FyaW8gZXNjYWxhciBsb3MgZGF0b3MuIApgYGB7cn0KY2x1c3QuZGYgPC0gcmVhZC50YWJsZSgiZGF0YS9jbHVzdGVyLnR4dCIsIGhlYWRlciA9IFQsIHJvdy5uYW1lcyA9IDEpICMgwqFPSk8gY29uIHJvdy5uYW1lcyEKc3VtbWFyeShjbHVzdC5kZikKYGBgCk90cm8gcHJvYmxlbWEsIHRhbCB2ZXogbm8gdGFuIGV2aWRlbnRlLCBlcyBxdWUgbGEgZGlzdHJpYnVjacOzbiBkZSBTU1Qgc2UgZW5jdWVudHJhIHN1bWFtZW50ZSBzZXNnYWRhLCBwb3IgbG8gcXVlIGhhYnLDoSBxdWUgYSkgYXBsaWNhciB1bmEgdHJhbnNmb3JtYWNpw7NuIHBhcmEgbm9ybWFsaXphciBsb3MgZGF0b3MsIGIpIHJldGlyYXJsYSBkZWwgYW7DoWxpc2lzLiBUb21hbmRvIGVuIGN1ZW50YSBsb3MgdmFsb3JlcywgZXMgYmFzdGFudGUgcHJvYmFibGUgcXVlIGxhcyBtZWRpY2lvbmVzIGVzdMOpbiBlcXVpdm9jYWRhcywgcG9yIGxvIHF1ZSBsYSByZXRpcmFyZW1vcyBkZWwgYW7DoWxpc2lzLgpgYGB7cn0KbWFzayA8LSBjb2xuYW1lcyhjbHVzdC5kZilbY29sbmFtZXMoY2x1c3QuZGYpICE9ICJTU1QiXQpjbHVzdC5maWx0IDwtIGNsdXN0LmRmWyxtYXNrXQpjb2xuYW1lcyhjbHVzdC5maWx0KQpgYGAKCkFob3JhIGVzY2FsZW1vcyB0b2RvcyBudWVzdHJvcyBkYXRvcy4gQWwgYW5hbGl6YXIgcsOhcGlkYW1lbnRlIGxhIGRpc3RyaWJ1Y2nDs24gZGUgY2FkYSB1bmEgZGUgbGFzIHZhcmlhYmxlcyBwb2RlbW9zIHZlciBxdWUgaGF5IGFsZ3VuYXMgY29uIHNlc2dvcyBxdWUgcHVkaWVyYW4gc2VyIGltcG9ydGFudGVzOyBzaW4gZW1iYXJnbywgcG9kZW1vcyB1dGlsaXphciB1bmEgbWVkaWRhIGRlIGRpc3RhbmNpYSBxdWUgY29udGllbmRhIGNvbiBlc3RlIHRpcG8gZGUgZGlzdHJpYnVjaW9uZXMgcGFyYSBldml0YXIgdW5hIHRyYW5zZm9ybWFjacOzbiBtw6FzIGFncmVzaXZhIHF1ZSBlbCBlc2NhbGFtaWVudG8uCmBgYHtyfQpjbHVzdC5zY2FsZSA8LSBzY2FsZShjbHVzdC5maWx0KQojY2x1c3Quc2NhbGUgPC0gbG9nKGNsdXN0LmZpbHQgKzEpICMgU2kgZGUgdG9kb3MgbW9kb3MgZGVzZWFzIGFwbGljYXIgdW5hIHRyYW5zZm9ybWFjacOzbiBwYXJhICJub3JtYWxpemFyIiBsb3MgZGF0b3MuCnN1bW1hcnkoY2x1c3Quc2NhbGUpCmBgYAoKCkFob3JhIHJlYWxpY2Vtb3MgbG9zIGFncnVwYW1pZW50b3MuIFV0aWxpemFyZW1vcyBsYSBkaXN0YW5jaWEgTWFoYWxhbm9iaXMgeWEgcXVlIGVzdGEgbm8gZXMgdGFuIHNlbnNpYmxlIGEgbG9zIHZhbG9yZXMgZXh0cmVtb3MuIEVsIG3DqXRvZG8gZGUgYWdydXBhbWllbnRvIHNlcsOhIHdhcmQuRDIsIChkaXN0YW5jaWFzIGN1YWRyw6F0aWNhcykgcGFyYSBtaW5pbWl6YXIgbGEgdmFyaWFuemEgaW50cmEtZ3J1cG9zOgoKYGBge3J9CmRpc3QubXYxIDwtIHZlZ2Rpc3QoY2x1c3Quc2NhbGUsIG1ldGhvZCA9ICJtYWhhbGFub2JpcyIpCmhjLm12MSA8LSBoY2x1c3QoZGlzdC5tdjEsIG1ldGhvZCA9IndhcmQuRDIiKQoKIyBUcmFuc2Zvcm1lbW9zIG51ZXN0cm8gb2JqZXRvIGEgdW4gZGVuZHJvZ3JhbWE6CmRlbmQubXYxIDwtIGFzLmRlbmRyb2dyYW0oaGMubXYxKQoKIyBDYW1iaWVtb3MgZWwgY29sb3IgYSBsYXMgcmFtYXM6CmRlbmQubXYxIDwtIHNldChkZW5kLm12MSwgImJyYW5jaGVzX2tfY29sb3IiLAogICAgICAgICAgICB2YWx1ZSA9ICJkZWVwc2t5Ymx1ZTQiLAogICAgICAgICAgICBrID0gMSkKCmRlbmQubXYxIDwtIHNldChkZW5kLm12MSwgImJyYW5jaGVzX2x3ZCIsIDAuNykKCmdnZDEgPC0gYXMuZ2dkZW5kKGRlbmQubXYxKQpnZ2QxLnBsb3QgPC0gZ2dwbG90KGdnZDEsIG9mZnNldF9sYWJlbHMgPSAtMSwgdGhlbWUgPSBibGFua190aGVtZSgpKSArIAogICAgICAgICAgICAgZXhwYW5kX2xpbWl0cyh5ID0gLTIuNCkgKwogICAgICAgICAgICAgc2NhbGVfeF9jb250aW51b3VzKGJyZWFrcyA9IE5VTEwpICsKICAgICAgICAgICAgIHNjYWxlX3lfY29udGludW91cyhicmVha3MgPSBzZXEoMCxtYXgoZ2V0X2JyYW5jaGVzX2hlaWdodHMoZGVuZC5tdjEpKSwyKSkgKwogICAgICAgICAgICAgbGFicyh0aXRsZSA9ICJEZW5kcm9ncmFtYSBkZSBzaXRpb3MgZGUgbXVlc3RyZW8iLAogICAgICAgICAgICAgICAgICBzdWJ0aXRsZSA9ICJNw6l0b2RvIGRlIGFncnVwYW1pZW50bzogV2FyZC5EMiIsCiAgICAgICAgICAgICAgICAgIHggPSBlbGVtZW50X2JsYW5rKCksCiAgICAgICAgICAgICAgICAgIHkgPSAiRGlzdGFuY2lhIE1haGFsYW5vYmlzIiwKICAgICAgICAgICAgICAgICAgY2FwdGlvbiA9ICJEYXRvczogY2x1c3QudHh0IikKCmdnZDEucGxvdApgYGAKTG9zIGFncnVwYW1pZW50b3MgY29uIGVzYSBjb21iaW5hY2nDs24gZGUgZGlzdGFuY2lhIHkgbcOpdG9kbyBkZSBhZ3J1cGFtaWVudG8gbm8gc29uIGNsYXJvcywgdmVhbW9zIHF1w6kgcGFzYSBzaSBjb25zaWRlcmFtb3MgbGEgZGlzdGFuY2lhIGV1Y2xpZGlhbmE6CgpgYGB7cn0KZGlzdC5tdjIgPC0gdmVnZGlzdChjbHVzdC5zY2FsZSwgbWV0aG9kID0gImV1Y2xpZGVhbiIpCmhjLm12MiA8LSBoY2x1c3QoZGlzdC5tdjIsIG1ldGhvZCA9IndhcmQuRDIiKQoKIyBUcmFuc2Zvcm1lbW9zIG51ZXN0cm8gb2JqZXRvIGEgdW4gZGVuZHJvZ3JhbWE6CmRlbmQubXYyIDwtIGFzLmRlbmRyb2dyYW0oaGMubXYyKQoKIyBDYW1iaWVtb3MgZWwgY29sb3IgYSBsYXMgcmFtYXM6CmRlbmQubXYyIDwtIHNldChkZW5kLm12MiwgImJyYW5jaGVzX2tfY29sb3IiLAogICAgICAgICAgICB2YWx1ZSA9ICJkZWVwc2t5Ymx1ZTQiLAogICAgICAgICAgICBrID0gMSkKCmRlbmQubXYyIDwtIHNldChkZW5kLm12MiwgImJyYW5jaGVzX2x3ZCIsIDAuNykKCmdnZDIgPC0gYXMuZ2dkZW5kKGRlbmQubXYyKQpnZ2QyLnBsb3QgPC0gZ2dwbG90KGdnZDIsIG9mZnNldF9sYWJlbHMgPSAtMSwgdGhlbWUgPSBibGFua190aGVtZSgpKSArIAogICAgICAgICAgICAgZXhwYW5kX2xpbWl0cyh5ID0gLTIuNCkgKwogICAgICAgICAgICAgc2NhbGVfeF9jb250aW51b3VzKGJyZWFrcyA9IE5VTEwpICsKICAgICAgICAgICAgIHNjYWxlX3lfY29udGludW91cyhicmVha3MgPSBzZXEoMCxtYXgoZ2V0X2JyYW5jaGVzX2hlaWdodHMoZGVuZC5tdjIpKSwyKSkgKwogICAgICAgICAgICAgbGFicyh0aXRsZSA9ICJEZW5kcm9ncmFtYSBkZSBzaXRpb3MgZGUgbXVlc3RyZW8iLAogICAgICAgICAgICAgICAgICBzdWJ0aXRsZSA9ICJNw6l0b2RvIGRlIGFncnVwYW1pZW50bzogV2FyZC5EMiIsCiAgICAgICAgICAgICAgICAgIHggPSBlbGVtZW50X2JsYW5rKCksCiAgICAgICAgICAgICAgICAgIHkgPSAiRGlzdGFuY2lhIEV1Y2xpZGlhbmEiLAogICAgICAgICAgICAgICAgICBjYXB0aW9uID0gIkRhdG9zOiBjbHVzdC50eHQiKQoKZ2dkMi5wbG90CmBgYArCv1kgbGEgZGlzdGFuY2lhIE1hbmhhdHRhbj8gTGFzIGFncnVwYWNpb25lcyByZXN1bHRhbnRlcyBzb24gc2ltaWxhcmVzOyBzaW4gZW1iYXJnbywgbGFzIG1lZGlkYXMgZGUgZGlzdGFuY2lhIHNvbiBtdXkgZGlmZXJlbnRlcy4gVXRpbGljZW1vcyBlbCBjYXNvIGFudGVyaW9yIHBhcmEgZXZhbHVhciBsYXMgYWdydXBhY2lvbmVzLgpgYGB7cn0KZGlzdC5tdjMgPC0gdmVnZGlzdChjbHVzdC5zY2FsZSwgbWV0aG9kID0gIm1hbmhhdHRhbiIpCmhjLm12MyA8LSBoY2x1c3QoZGlzdC5tdjMsIG1ldGhvZCA9IndhcmQuRDIiKQoKIyBUcmFuc2Zvcm1lbW9zIG51ZXN0cm8gb2JqZXRvIGEgdW4gZGVuZHJvZ3JhbWE6CmRlbmQubXYzIDwtIGFzLmRlbmRyb2dyYW0oaGMubXYzKQoKIyBDYW1iaWVtb3MgZWwgY29sb3IgYSBsYXMgcmFtYXM6CmRlbmQubXYzIDwtIHNldChkZW5kLm12MywgImJyYW5jaGVzX2tfY29sb3IiLAogICAgICAgICAgICB2YWx1ZSA9ICJkZWVwc2t5Ymx1ZTQiLAogICAgICAgICAgICBrID0gMSkKCmRlbmQubXYzIDwtIHNldChkZW5kLm12MywgImJyYW5jaGVzX2x3ZCIsIDAuNykKCmdnZDMgPC0gYXMuZ2dkZW5kKGRlbmQubXYzKQpnZ2QzLnBsb3QgPC0gZ2dwbG90KGdnZDMsIG9mZnNldF9sYWJlbHMgPSAtMSwgdGhlbWUgPSBibGFua190aGVtZSgpKSArIAogICAgICAgICAgICAgZXhwYW5kX2xpbWl0cyh5ID0gLTMuNSkgKwogICAgICAgICAgICAgc2NhbGVfeF9jb250aW51b3VzKGJyZWFrcyA9IE5VTEwpICsKICAgICAgICAgICAgIHNjYWxlX3lfY29udGludW91cyhicmVha3MgPSBzZXEoMCxtYXgoZ2V0X2JyYW5jaGVzX2hlaWdodHMoZGVuZC5tdjMpKSw1KSkgKwogICAgICAgICAgICAgbGFicyh0aXRsZSA9ICJEZW5kcm9ncmFtYSBkZSBzaXRpb3MgZGUgbXVlc3RyZW8iLAogICAgICAgICAgICAgICAgICBzdWJ0aXRsZSA9ICJNw6l0b2RvIGRlIGFncnVwYW1pZW50bzogV2FyZC5EMikiLAogICAgICAgICAgICAgICAgICB4ID0gZWxlbWVudF9ibGFuaygpLAogICAgICAgICAgICAgICAgICB5ID0gIkRpc3RhbmNpYSBNYW5oYXR0YW4iLAogICAgICAgICAgICAgICAgICBjYXB0aW9uID0gIkRhdG9zOiBjbHVzdC50eHQiKQoKZ2dkMy5wbG90CmBgYAojIyMgRXZhbHVhY2nDs24gZGUgbG9zIGFncnVwYW1pZW50b3MKUGFyYSBjYWxjdWxhciBsb3Mgw61uZGljZXMgcXVlIGVzdGltYW4gZWwgbsO6bWVybyDDs3B0aW1vIGRlIGFncnVwYWNpb25lcyB1dGlsaXphcmVtb3MgbGEgZnVuY2nDs24gYE5iQ2x1c3RgIGRlIGxhIGxpYnJlcsOtYSBjb24gZWwgbWlzbW8gbm9tYnJlLiAKYGBge3J9CmxpYnJhcnkoTmJDbHVzdCkKcmVzIDwtIE5iQ2x1c3QoY2x1c3Quc2NhbGUsIGRpc3MgPSBOVUxMLCBkaXN0YW5jZSA9ICJldWNsaWRlYW4iLCBtZXRob2QgPSAid2FyZC5EMiIsIGluZGV4ID0gImFsbCIsIG1heC5uYyA9IDgpCmBgYApWZWFtb3MgYWhvcmEgbG9zIGdydXBvcyB5IGNhbGN1bGVtb3MgZWwgY29lZmljaWVudGUgZGUgY29ycmVsYWNpw7NuIGNvZmVuw6l0aWNvLiBVbmEgY29ycmVsYWNpw7NuIGRlIHByw6FjdGljYW1lbnRlIGVsIDcwJSBlcyBtw6FzIHF1ZSBhY2VwdGFibGUsIHNpIGNvbnNpZGVyYW1vcyBxdWUgbm8gZmlsdHJhbW9zIGxhIHRvdGFsaWRhZCBkZSBsb3MgZGF0b3MuIENvbW8gZGF0byBjdXJpb3NvLCBhbCBhcGxpY2FyIHVuYSB0cmFuc2Zvcm1hY2nDs24gbG9nYXLDrXRtaWNhIHNlIG1hbnRpZW5lbiBlc3RvcyBncnVwb3MgcGVybyBlbCBjb2VmaWNpZW50ZSBkZSBjb3JyZWxhY2nDs24gY29mZW7DqXRpY28gc2UgZWxldmEgYSAwLjguCmBgYHtyfQpyZXMkQmVzdC5wYXJ0aXRpb24KaGMuZSA8LSBjbHVzdGVyOjphZ25lcyhkaXN0Lm12MiwgZGlzcyA9IFQsIG1ldGhvZCA9ICJ3YXJkIikKY2NjIDwtIGNvcGhlbmV0aWMoaGMuZSkgIyBEaXN0YW5jaWFzIGVuIGVsIGRlbmRyb2dyYW1hCmNjb2ZlbiA8LSBjb3IoZGlzdC5tdjIsIGNjYywgbWV0aG9kID0gInNwZWFybWFuIikgIyBDb3JyZWxhY2nDs24gZW50cmUgZGlzdGFuY2lhcyByZWFsZXMgeSBncmFmaWNhZGFzCmNjb2ZlbgpgYGAKRXN0YSBmb3JtYSBkZSB2ZXIgbG9zIGFncnVwYW1pZW50b3Mgbm8gZXMgbXV5IGNsYXJhLCBlbnRvbmNlcyBhZ3JlZ3XDqW1vc2xhIGEgbnVlc3RybyBncsOhZmljbyBtZWRpYW50ZSBjb2xvcmVzIGRlIGxhcyByYW1hcyB5IGV0aXF1ZXRhczoKCmBgYHtyfQojIENhbWJpYW1vcyBlbCBjb2xvciBkZSBudWVzdHIKZGVuZC5tdjIgPC0gc2V0KGRlbmQubXYyLCAibGFiZWxzX2NvbCIsCiAgICAgICAgICAgICAgICB2YWx1ZSA9IDE6MywKICAgICAgICAgICAgICAgIGsgPSAzKQoKZGVuZC5tdjIgPC0gc2V0KGRlbmQubXYyLCAiYnJhbmNoZXNfa19jb2xvciIsCiAgICAgICAgICAgIHZhbHVlID0gMTozLAogICAgICAgICAgICBrID0gMykgICAgICAgICAgCiAgICAgICAgICAKZGVuZC5tdjIgPC0gc2V0KGRlbmQubXYyLCAiYnJhbmNoZXNfbHdkIiwgMC43KQoKZ2dkMiA8LSBhcy5nZ2RlbmQoZGVuZC5tdjIpCmdnZDIucGxvdCA8LSBnZ3Bsb3QoZ2dkMiwgb2Zmc2V0X2xhYmVscyA9IC0xLCB0aGVtZSA9IGJsYW5rX3RoZW1lKCkpICsgCiAgICAgICAgICAgICBleHBhbmRfbGltaXRzKHkgPSAtMi40KSArCiAgICAgICAgICAgICBzY2FsZV94X2NvbnRpbnVvdXMoYnJlYWtzID0gTlVMTCkgKwogICAgICAgICAgICAgc2NhbGVfeV9jb250aW51b3VzKGJyZWFrcyA9IHNlcSgwLG1heChnZXRfYnJhbmNoZXNfaGVpZ2h0cyhkZW5kLm12MikpLDIpKSArCiAgICAgICAgICAgICBsYWJzKHRpdGxlID0gIkRlbmRyb2dyYW1hIGRlIHNpdGlvcyBkZSBtdWVzdHJlbyIsCiAgICAgICAgICAgICAgICAgIHN1YnRpdGxlID0gIk3DqXRvZG8gZGUgYWdydXBhbWllbnRvOiBXYXJkLkQyIiwKICAgICAgICAgICAgICAgICAgeCA9IGVsZW1lbnRfYmxhbmsoKSwKICAgICAgICAgICAgICAgICAgeSA9ICJEaXN0YW5jaWEgRXVjbGlkaWFuYSIsCiAgICAgICAgICAgICAgICAgIGNhcHRpb24gPSAiRGF0b3M6IGNsdXN0LnR4dCIpCgpnZ2QyLnBsb3QKYGBgCgoqKkd1YXJkYWRvIGRlIGZpZ3VyYXMhISEqKgpgYGB7cn0KI2NhaXJvX3BkZigiZGVuZHJvZ3JhbS5wZGYiLCB3aWR0aCA9IDgsIGhlaWdodCA9IDgpCmdnZDIucGxvdAojZGV2Lm9mZigpCmBgYAoKwr9Dw7NtbyBsbyBpbnRlcnByZXRhbW9zPyBIYXkgcXVlIHJldmlzYXIgbGEgYmFzZSBkZSBkYXRvcyBwYXJhIGV2aXRhciBjYWVyIGVuIGludGVycHJldGFjaW9uZXMgaW5jb3JyZWN0YXMgeSBhbmFsaXphciBxdcOpIGNhcmFjdGVyw61zdGljYXMgY29uZm9ybWFuIGNhZGEgZ3J1cG8uCgojIEFuw6FsaXNpcyBkZSBDb21wb25lbnRlcyBQcmluY2lwYWxlcwpQb3IgZmluIGxsZWfDsyBsYSBob3JhIGRlIGhhYmxhciBkZWwgQW7DoWxpc2lzIGRlIENvbXBvbmVudGVzIFByaW5jaXBhbGVzLiBWaW1vcyBxdWUgZXN0YSB0w6ljbmljYSBub3MgcGVybWl0ZSBhcHJveGltYXIgbnVlc3Ryb3MgZGF0b3MgbXVsdGl2YXJpYWRvcyB1dGlsaXphbmRvIG51ZXZhcyB2YXJpYWJsZXMgbGxhbWFkYXMgQ29tcG9uZW50ZXMgUHJpbmNpcGFsZXMsIGxhcyBjdWFsZXMgc29uIG9ydG9nb25hbGVzIChpbmRlcGVuZGllbnRlcykgZW50cmUgc8OtLiBBcGxpcXVlbW9zIGVsIEFuw6FsaXNpcyBkZSBjb21wb25lbnRlcyBwcmluY2lwYWxlcyBhIHVuYSBiYXNlIGRlIGRhdG9zIGNvbiB1bmEgZ3JhbiBjYW50aWRhZCBkZSB2YXJpYWJsZXM6IAoKYGBge3J9CmxpYnJhcnkoZmFjdG9leHRyYSkKbGlicmFyeShGYWN0b01pbmVSKQojQmFzZSBkZSBkYXRvcyBjb21wbGV0YQogIAp4MW4gPC0gcmVhZC50YWJsZSgnZGF0YS9NZWRpZGFzLnR4dCcsIGhlYWRlciA9IFRSVUUpCiNCYXNlIGRlIGRhdG9zIHNpbiBub21icmVzIGRlIGVzcGVjaWVzCgp4MSA8LSB4MW5bICwyOmxlbmd0aCh4MW4pIF0Kc3VtbWFyeSh4MSkKYGBgCkFwbGlxdWVtb3MgZWwgQW7DoWxpc2lzIGRlIENvbXBvbmVudGVzIFByaW5jaXBhbGVzOgpgYGB7cn0KcmVzLnBjYSA8LSBGYWN0b01pbmVSOjpQQ0EoeDEsIGdyYXBoID0gRiwgbmNwID0gbGVuZ3RoKHgxKSwgc2NhbGUudW5pdCA9IFQpICNBcGxpY2Ftb3MgZWwgQUNQIGNvbiBsb3MgZGF0b3MgZXNjYWxhZG9zIHkgY2VudHJhZG9zCnZhciA8LSBnZXRfcGNhX3ZhcihyZXMucGNhKSAjIEV4dHJhZW1vcyBsYXMgY29ycmVsYWNpb25lcyBkZSBjYWRhIHZhcmlhYmxlIGNvbiBjYWRhIGNvbXBvbmVudGUgcHJpbmNpcGFsCmNvcnMgPC0gKHJvdW5kKGFicyh2YXIkY29vcmQpLDIpKQpjb3JzCmBgYAoKQWhvcmEgdmVhbW9zIGxvcyByZXN1bHRhZG9zIGRlIG1hbmVyYSBncsOhZmljYS4gUHJpbWVybyBsYXMgdmFyaWFibGVzOgpgYGB7cn0KZnZpel9wY2FfdmFyKHJlcy5wY2EsIGNvbC52YXIgPSAiY29vcmQiLAogICAgICAgICAgICAgICAgICAgICAgIGdyYWRpZW50LmNvbHMgPSBjKCIjMDBBRkJCIiwgIiNFN0I4MDAiLCAiI0ZDNEUwNyIpKQpgYGAKwr9RdcOpIHZhcmlhYmxlcyBzb24gbGFzIG3DoXMgaW1wb3J0YW50ZXM/IE90cmEgZm9ybWEgZGUgdmVyIGVzdG9zIHJlc3VsdGFkb3MgZXMgdXRpbGl6YW5kbyBsYSBsaWJyZXLDrWEgY29ycnBsb3Q6CmBgYHtyfQpsaWJyYXJ5KGNvcnJwbG90KQpjb3JycGxvdCh2YXIkY29vcmQsIGlzLmNvcnIgPSBUKQpgYGAKUG9kZW1vcyBleHRyYWVyIGxhcyA0IHZhcmlhYmxlcyBtw6FzIGltcG9ydGFudGVzIHBhcmEgdW4gY29tcG9uZW50ZSBkYWRvOgpgYGB7cn0Kc29ydChjb3JzWywxXSwgZGVjcmVhc2luZyA9IFQpWzE6NF0Kc29ydChjb3JzWywyXSwgZGVjcmVhc2luZyA9IFQpWzE6NF0KYGBgCgpVbiBlZmVjdG8gc2VjdW5kYXJpbyBkZSByZWR1Y2lyIGxhIGRpbWVuc2lvbmFsaWRhZCBlcyBxdWUgcG9kZW1vcyBmb3JtYXIgYWdydXBhY2lvbmVzLCAob3RyYSBkZSBsYXMgYXBsaWNhY2lvbmVzIGRlbCBBQ1ApIHRhbCB5IGNvbW8gZW4gZWwgY2FzbyBkZWwgTk1EUy4gUG9kZW1vcyB2ZXIgY8OzbW8gc2UgZGlzdHJpYnV5ZXJvbiBsb3MgaW5kaXZpZHVvcyBzZWfDum4gbnVlc3RyYXMgYWdydXBhY2lvbmVzIG9yaWdpbmFsZXMsIHRhbCBxdWU6CgpgYGB7cn0KZnZpel9wY2FfaW5kKHJlcy5wY2EsCiAgICAgICAgICAgICBnZW9tLmluZCA9ICJwb2ludCIsICMgTW9zdHJhciBzb2xvIHB1bnRvcyAoc2luIHRleHRvcykKICAgICAgICAgICAgIGNvbC5pbmQgPSB4MW5bLDFdLCAjIE7Dum1lcm8gZGUgY29sb3JlcyAoZ3J1cG9zKQogICAgICAgICAgICAgcGFsZXR0ZSA9IGMoIiMwMEFGQkIiLCAiI0U3QjgwMCIsICIjRkM0RTA3IiksICMgQ29sb3JlcyBhIHV0aWxpemFyCiAgICAgICAgICAgICBhZGRFbGxpcHNlcyA9IFRSVUUsICMgRWxpcHNlcyBkZSBjb25jZW50cmFjacOzbgogICAgICAgICAgICAgbGVnZW5kLnRpdGxlID0gIkVzcGVjaWVzIikKYGBgClkgcG9kZW1vcyB0YW1iacOpbiBoYWNlciB1biBncsOhZmljbyBjb25qdW50bywgYXVucXVlIGRhZGEgbGEgYWx0YSBkaW1lbnNpb25hbGlkYWQgZGUgZXN0YSBiYXNlIGRlIGRhdG9zLCBsb3MgcmVzdWx0YWRvcyBzZXLDoW4gcG9jbyBpbnRlcnByZXRhYmxlcy4KCmBgYHtyfQpmdml6X3BjYV9iaXBsb3QocmVzLnBjYSwgCiAgICAgICAgICAgICAgICBjb2wuaW5kID0geDFuJGVzcGVjaWUsIHBhbGV0dGUgPSAiamNvIiwgCiAgICAgICAgICAgICAgICBhZGRFbGxpcHNlcyA9IFRSVUUsIGxhYmVsID0gInZhciIsCiAgICAgICAgICAgICAgICBjb2wudmFyID0gImJsYWNrIiwgcmVwZWwgPSBUUlVFLAogICAgICAgICAgICAgICAgbGVnZW5kLnRpdGxlID0gIkVzcGVjaWVzIikgCmBgYAojIyBFdmFsdWFjacOzbiBkZSBsb3MgQ29tcG9uZW50ZXMgUHJpbmNpcGFsZXMKVmVhbW9zIGFob3JhIGxhcyB2YXJpYW56YXMgZXhwbGljYWRhcyBhY3VtdWxhZGFzIHBhcmEgY2FkYSBjb21wb25lbnRlOgpgYGB7cn0KZWlnLnZhbCA8LSBnZXRfZWlnZW52YWx1ZShyZXMucGNhKQplaWcudmFsCmBgYAoKRGUgdG9kb3MgbG9zIHJlc3VsdGFkb3MgYW50ZXJpb3JlcyB2ZW1vcyBxdWUgbGFzIHByaW1lcmFzIGRvcyBkaW1lbnNpb25lcyBjYXB0dXJhbiBtZW5vcyBkZWwgNTAlIGRlIGxhIHZhcmlhbnphIHRvdGFsIGRlIGxvcyBkYXRvczsgcG9yIHRhbnRvLCBlcyBjb252ZW5pZW50ZSBhbmFsaXphciBjdcOhbnRvcyBjb21wb25lbnRlcyBwcmluY2lwYWxlcyBzb24gbG9zIMOzcHRpbW9zLiBVbmEgYWx0ZXJuYXRpdmEgZXMgcmVhbGl6YXIgZWwgYW7DoWxpc2lzIGdyw6FmaWNvIGRlIGxhIHZhcmlhbnphLiBFbiBlc3RlIGdyw6FmaWNvIGJ1c2NhbW9zIHVuIHB1bnRvIGRlIGluZmxleGnDs24sIGVsIGN1YWwgaW5kaWNhcsOtYSBlbCBsw61taXRlIGRlIGxvcyBQQ3MgcmVwcmVzZW50YXRpdm9zLgoKYGBge3J9CmZ2aXpfZWlnKHJlcy5wY2EsIGFkZGxhYmVscyA9IFQpCmBgYApFbiBlc3RlIGdyw6FmaWNvIHlvIGNvbnNpZGVyYXLDrWEgZWwgcHJpbWVyIHB1bnRvIGRlIGluZmxleGnDs24gZW4gZWwgdGVyY2VyIGNvbXBvbmVudGUgcHJpbmNpcGFsLCBwZXJvIHZlYW1vcyBvdHJvcyBkb3MgY3JpdGVyaW9zLiBFbCBwcmltZXJvIGVzIGVsIGNyaXRlcmlvIGRlIEthaXNlci1HdXR0bWFuLCBlbiBlbCBjdWFsIGNvbnNpZGVyYXJlbW9zIGxvcyBDUCBjdXlhcyB2YXJpYW56YXMgZXhwbGljYWRhcyBzZWFuIHN1cGVyaW9yZXMgYWwgdmFsb3IgbWVkaW8uIEVsIHNlZ3VuZG8gbW9kZWxvIGVzIHVuIG1vZGVsbyBkZSByZXBhcnRpY2nDs24gZGUgcmVjdXJzb3MgZGVzYXJyb2xsYWRvIGVuIGVsIGNhbXBvIGRlIGxhIGVjb2xvZ8OtYTogRWwgbW9kZWxvIEJyb2tlbi1TdGljayAoTWNBcnRodXIgMTk1NykuIEVuIGVzdGUgbW9kZWxvLCBlbCByZWN1cnNvIGNvbXBhcnRpZG8gZXMgbGEgdmFyaWFuemEgdG90YWwsIGVudG9uY2VzIGNvbnNpZGVyYXJlbW9zIGFxdWVsbG9zIENQcyBxdWUgY29udGVuZ2FuIHVuYSB2YXJpYW56YSBleHBsaWNhZGEgc3VwZXJpb3IgYSBsYSBlc3BlcmFkYSBzZWfDum4gZWwgbW9kZWxvLiAKYGBge3J9CiNLYWlzc2VyLUd1dHRtYW4geSBCcm9rZW4gU3RpY2sKZXYgPC0gYXMuZGF0YS5mcmFtZShlaWcudmFsKSRlaWdlbnZhbHVlCm5hbWVzKGV2KSA8LSBwYXN0ZSgiQ1AiLHNlcV9hbG9uZyhldiksICIiKQpldnBsb3QoZXYpCmBgYApCYWpvIGVsIGNyaXRlcmlvIGRlIEthaXNlci1HdXR0bWFuIGNvbnNpZGVyYXLDrWFtb3MgOCBDUHMsIG1pZW50cmFzIHF1ZSBlbiBlbCBtb2RlbG8gZGUgQnJva2VuLVN0aWNrIGNvbnNpZGVyYXLDrWFtb3Mgw7puaWNhbWVudGUgNC4gRGUgY3VhbHF1aWVyIG1vZG8sIGFtYm9zIGNyaXRlcmlvcyBzdWdpZXJlbiB1biBuw7ptZXJvIG1heW9yIGFsIHF1ZSB5byBjb25zaWRlcsOpIGVuIGVsIGdyw6FmaWNvIGRlIGxhIHZhcmlhbnphLgoKIyBFc2NhbGFtaWVudG8gTXVsdGlkaW1lbnNpb25hbCBObyBNw6l0cmljbyAoTk1EUykKQSBkaWZlcmVuY2lhIGRlbCBQQ0EgZW4gZWwgY3VhbCBlcyBpbXBvcnRhbnRlIHF1ZSBsYXMgdmFyaWFibGVzIGVzdMOpbiBjZW50cmFkYXMgeSBlc3RhbmRhcml6YWRhcyAobyBxdWUgbGFzIHZhcmlhYmxlcyBzZWFuIGRlbCBtaXNtbyB0aXBvOyBlLmcuLCBiaW9tZXRyw61hcyBlbiBkaXN0aW50YXMgZXNwZWNpZXMgZGUgcGVjZXMpLCBlbCBFc2NhbGFtaWVudG8gTXVsdGlkaW1lbnNpb25hbCBObyBNw6l0cmljbyAoTk1EUykgZXMgdW5hIHTDqWNuaWNhIG3DoXMgZmxleGlibGUgYWwgZXN0YXIgYmFzYWRhIGVuIMOzcmRlbmVzIGRlIHJhbmdvcyAoZGlzdGFuY2lhcykgcGFyYSBsYSBvcmRlbmFjacOzbi4gQ29tbyByZXN1bHRhZG8sIHB1ZWRlIGFjZXB0YXIgdW5hIHZhcmllZGFkIG1heW9yIGRlIHRpcG9zIGRlIGRhdG9zLiBPdHJhIGRpZmVyZW5jaWEgZXMgcXVlIGVuIGVsIEFDUCBlbCBvYmpldGl2byBwcmltb3JkaWFsIG5vIGVzIGxhIGZvcm1hY2nDs24gZGUgYWdydXBhY2lvbmVzLCBzaW5vIGxhIHJlZHVjY2nDs24gZGUgbGEgZGltZW5zaW9uYWxpZGFkIHkgbGEgb3JkZW5hY2nDs24gZXMgdW5hIGNvbnNlY3VlbmNpYSBkZWwgcHJvY2VzbywgbWllbnRyYXMgcXVlIGVuIE5NRFMgc8OtIHNlIGJ1c2NhIHVuYSBvcmRlbmFjacOzbi4KClBhcmEgYW5hbGl6YXIgZXN0ZSBjYXNvIHV0aWxpY2Vtb3MgbG9zIG1pc21vcyBkYXRvcyBkZWwgY2FzbyBzaXRpb3MgKGNsw7pzdGVyKToKYGBge3J9CiMgTWF0cml6IGRlIGRpc3RhbmNpYXMKZGlzdC5ubWRzIDwtIGRpc3QubXYyCm1kcyA8LSBtZXRhTURTKGRpc3Qubm1kcywgZGlzdGFuY2UgPSAiZXVjbGlkZWFuIiwgayA9IDIsIHRyYWNlID0gVCkKbWRzLmRpbXMgPC0gZGF0YS5mcmFtZShOTURTMSA9IG1kcyRwb2ludHNbLDFdLCBOTURTMiA9IG1kcyRwb2ludHNbLDJdKQoKbWRzLnBsb3QuZGF0YSA8LSBjYmluZChtZHMuZGltcywgY2x1c3Quc2NhbGUpCmBgYAoKUG9kZW1vcyBvYnRlbmVyIHRhbWJpw6luIGxhIGltcG9ydGFuY2lhIGRlIGxhcyB2YXJpYWJsZXMsIGRlIG1vZG8gYW7DoWxvZ28gYSBsbyBxdWUgaGljaW1vcyBjb24gZWwgQUNQOgpgYGB7cn0KIyBFeHRyYWVtb3MgbG9zIGNvZWZpY2llbnRlcyBkZSBkZXRlcm1pbmFjacOzbiBkZSBjYWRhIHZhcmlhYmxlIGNvbiBjYWRhIGRpbWVuc2nDs24gcmVkdWNpZGEgKGZsZWNoYXMpCmZpdCA8LSBlbnZmaXQobWRzLCBjbHVzdC5zY2FsZSkKYXJyb3cgPC0gZGF0YS5mcmFtZShmaXQkdmVjdG9ycyRhcnJvd3MsIFIgPSBmaXQkdmVjdG9ycyRyLCBQID0gZml0JHZlY3RvcnMkcHZhbHMpCmFycm93WyJWYXJpYWJsZSJdIDwtIHJvd25hbWVzKGFycm93KQoKIyBFeHRyYWVtb3MgYXF1ZWxsYXMgcXVlIHRlbmdhbiB1bmEgY29ycmVsYWNpw7NuIHNpZ25pZmljYXRpdmFtZW50ZSBkaWZlcmVudGUgZGUgMAphcnJvdy5wIDwtIHN1YnNldChhcnJvdywgUCA8PSAwLjA1KQoKI09yZGVuYW1vcyBkZSBtYW5lcmEgZGVzY2VuZGVudGUgc2Vnw7puIHN1IHZhbG9yIGRlIFIyCmFycm93LnAgPC0gYXJyb3cucFtvcmRlcihhcnJvdy5wJFIsIGRlY3JlYXNpbmcgPSBUKSwgXQpoZWFkKGFycm93LnApCmBgYAoKYGBge3J9CmxpYnJhcnkoZ2dyZXBlbCkKbWRzLnBsb3QgPC0gZ2dwbG90KG1kcy5wbG90LmRhdGEsIGFlcyhOTURTMSwgTk1EUzIpKSArCiAgICAgICAgICAgIGdlb21fcG9pbnQoYWVzKGNvbG9yID0gYXMuZmFjdG9yKHJlcyRCZXN0LnBhcnRpdGlvbikpLCBhbHBoYSA9IDAuNykgKwogICAgICAgICAgICBnZW9tX2xhYmVsX3JlcGVsKGFlcyhsYWJlbCA9IHJvd25hbWVzKGNsdXN0LnNjYWxlKSkpICsKICAgICAgICAgICAgc3RhdF9lbGxpcHNlKGFlcyhmaWxsID0gYXMuZmFjdG9yKHJlcyRCZXN0LnBhcnRpdGlvbikpLCAKICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgPSAidCIsIHNpemUgPSAxLCBnZW9tID0gInBvbHlnb24iLCAKICAgICAgICAgICAgICAgICAgICAgICAgIGFscGhhID0gMC4yLCBzaG93LmxlZ2VuZCA9IEYpICsKICAgICAgICAgICAgbGFicyh0aXRsZSA9ICJFc2NhbGFtaWVudG8gTXVsdGlkaW1lbnNpb25hbCBubyBtw6l0cmljbyAoTk1EUykiLAogICAgICAgICAgICAgICAgIHN1YnRpdGxlID0gcGFzdGUoJ0VzdHLDqXMgPScscm91bmQobWRzJHN0cmVzcywzKSksCiAgICAgICAgICAgICAgICAgY2FwdGlvbiA9ICJEYXRvczogY2x1c3Rlci50eHQiKSArCiAgICAgICAgICAgIGJsYW5rX3RoZW1lKCkgKyAKICAgICAgICAgICAgdGhlbWUobGVnZW5kLnBvc2l0aW9uID0gInJpZ2h0IikgKyBzY2FsZV9jb2xvcl9kaXNjcmV0ZShuYW1lID0gIkdydXBvIikgIysKICAgICAgICAgICAgI2dlb21fc2VnbWVudChkYXRhID0gYXJyb3cucCwgCiAgICAgICAgICAgICMgICAgICAgICAgICAgYWVzKHg9MCwgeT0wLCB4ZW5kID0gTk1EUzEsIHllbmQgPSBOTURTMiwgbHR5ID0gVmFyaWFibGUpLCAKICAgICAgICAgICAgIyAgICAgICAgICAgICBhcnJvdyA9IGFycm93KGxlbmd0aCA9IHVuaXQoLjI1LCAiY20iKSphcnJvdy5wJFIpICNGbGVjaGFzIGVzY2FsYWRhcyBzZWfDum4gc3UgUl4yCiAgICAgICAgICAgICMgICAgICAgICAgICAgKQoKbWRzLnBsb3QKYGBgCkFob3JhIGNvbXBhcmVtb3MgY29uIGVsIGRlbmRyb2dyYW1hOgpgYGB7cn0KZ2dkMi5wbG90CmBgYAoKVGFyZWEgb3BjaW9uYWw6IApBcGxpY2FyIHVuIEFDUCBhIGVzdGEgbWlzbWEgYmFzZSBkZSBkYXRvcy4gCjEuIMK/TG9zIGRhdG9zIGRlYmVuIGRlIGNlbnRyYXJzZSB5IGVzdGFuZGFyaXphcnNlPyAKMi4gUmVhbGl6YSBlbCBBQ1AuIMK/Q3XDoW50b3MgQ1BzIGNvbnNpZGVyYXLDrWFzPyAKMy4gwr9DdcOhbCBlcyBsYSB2YXJpYW56YSBleHBsaWNhZGEgZW50cmUgbG9zIGRvcyBwcmltZXJvcyBjb21wb25lbnRlcyBwcmluY2lwYWxlcz8KNC4gwr9DdcOhbGVzIHNvbiBsYXMgdmFyaWFibGVzIG3DoXMgaW1wb3JhbnRlcyBwYXJhIGVzb3MgZG9zIGNvbXBvbmVudGVzPwo1LiDCv0hheSBkaWZlcmVuY2lhcyBlbiBsYSBvcmRlbmFjacOzbiBjb24gcmVzcGVjdG8gYSBsb3Mgb3Ryb3MgZG9zIG3DqXRvZG9zPwo2LiBSZWFsaXphciBsYXMgdHJlcyB0w6ljbmljYXMgY29uIGxhcyBtZWRpZGFzIGFtYmllbnRhbGVzLCBpbmNsdXllbmRvIFNTVCB5IGNvbXBhcmFyIGNvbiBlc3RvcyByZXN1bHRhZG9zLg==</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("c13_no_sup.Rmd");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
